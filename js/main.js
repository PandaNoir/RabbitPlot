'use strict';(function(V,t){function D(a,e){return a-e}function M(a,e,b){var c=new Date(a,e,b);return c.getFullYear()===q(a)&&c.getMonth()===q(e)&&c.getDate()===q(b)}function q(a){return parseInt(a,10)}function R(a){return a.replace(/[\uff21-\uff3a\uff41-\uff5a\uff10-\uff19]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})}function N(a){return 0===a%400||0===a%4&&0!==a%100}function E(){var a="",e,b;for(e=0;32>e;e++){b=16*Math.random()|0;if(8==e||12==e||16==e||20==e)a+="-";a+=(12==
e?4:16==e?b&3|8:b).toString(16)}return a}var S=Array.prototype.slice;angular.module("lodash",[]).factory("_",function(){return _});angular.module("rabbit","ngTouch ngAnimate ngMaterial ngMessages LocalStorageModule lodash".split(" ")).constant("OVER_MONTH",64).constant("MEMO_LIMIT",1950).constant("IS_SMART_PHONE",0<navigator.userAgent.indexOf("iPhone")&&-1==navigator.userAgent.indexOf("iPad")||0<navigator.userAgent.indexOf("iPod")||0<navigator.userAgent.indexOf("Android")).constant("ATTRIBUTE",{OPERATOR:0,
OTHERS:1,LPARENTHESES:2,RPARENTHESES:3});angular.module("rabbit").controller("mainCtrl",["$scope","_","calendar","eventCal","mode","$mdSidenav",function(a,e,b,c,g,h){a._=e;a.mode=g;g.editsEvent=!1;g.editsGroup=!1;a.splitSelector=c.splitSelector;a.openNav=function(){h("left").toggle()};b.selected=b.date;a.eventCalendar=c.eventCalendar}]).config(["$httpProvider",function(a){a.defaults.transformRequest=function(a){if(a===t)return a;if(angular.isObject(a)){var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var g=
a[c];b[b.length]=encodeURIComponent(c)+"="+encodeURIComponent(null==g?"":g)}a=b.join("&").replace(/%20/g,"+")}else a=null==a?"":a.toString();return a};a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]).filter("format",["group","user",function(a,e){return function(b,c){b=b.split(":");var g="",g="private"==b[1]?e["private"][b[2]][b[0]].name:0===q(b[1])&&-1===q(b[0])?"[mes]\u632f\u66ff\u4f11\u65e5":0===q(b[1])&&-2===q(b[0])?"[mes]\u56fd\u6c11\u306e\u4f11\u65e5":a[b[1]][b[2]][b[0]].name;
!1!==c&&0===g.indexOf("[mes]")&&(g=g.replace(/^\[mes\]/,""));return g}}]).run(["_","db","group","$rootScope","localStorageService",function(a,e,b,c,g){var h=a.clone(b)[0];g.get("group")&&(b.length=0,Array.prototype.push.apply(b,angular.fromJson(g.get("group"))),b[0]=a.clone(h));e.list().then(function(f){f=f.data;for(var m=0,A=f.length;m<A;m++){for(var n in f[m])f[m][n]=angular.fromJson(f[m][n]);f[m].updated=!0}f.sort(function(a,c){return a.id-c.id});m=b.length=0;for(A=f.length;m<A;m++)b[f[m].id]=
f[m];b[0]=a.clone(h);c.$broadcast("updated");g.set("group",angular.toJson(b));e.getNameList().then(function(c){for(var e=0,f=c.data[0].length;e<f;e++)b[e]||(b[e]={name:angular.fromJson(c.data[0][e])},c.data[1][e]&&(b[e].parents=angular.fromJson(c.data[1][e])));b[0]=a.clone(h);g.set("group",angular.toJson(b))})})}]);angular.module("rabbit").controller("calendarCtrl",["$scope","calendar","mode","MEMO_LIMIT",function(a,e,b,c){a.calendar=e;a.nextMonth=function(){e.month++;e.selected=null;12<e.month+1&&
(e.year+=1,e.month-=12);b.editsEvent=!1};a.lastMonth=function(){e.month--;e.selected=null;1>e.month+1&&(e.year-1<c?(alert(c+"\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"),e.month+=1):(e.month+=12,--e.year));b.editsEvent=!1};a.nextYear=function(){e.year++;e.selected=null;b.editsEvent=!1};a.lastYear=function(){e.year-1<c?alert(c+"\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"):
(e.year--,e.selected=null);b.editsEvent=!1};a.dates="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")}]);angular.module("rabbit").controller("eventEditorCtrl",["$scope","group","user","eventForm","calendar","db","mode","$mdToast",function(a,e,b,c,g,h,f,m){function A(g,k){var u=c.type;if(""===c.name||"event"===u&&(null===c.year||null===c.month||null===c.date)||"habit"===u&&""===c.rule||c.selectedGroup===t||null===c.selectedGroup)m.show(m.simple().content("\u5165\u529b\u304c\u4e0d\u9069\u5207\u3067\u3059").position("top right").hideDelay(3E3));
else if("event"!==u||M(c.year,c.month-1,c.date)){c.isMessage&&(c.name="[mes]"+c.name);var r;"private"===k?(b["private"][u][g]||(b["private"][u][g]={}),r=b["private"][u][g],b.updated=!0):(e[c.selectedGroup][u][g]||(e[c.selectedGroup][u][g]={}),r=e[c.selectedGroup][u][g],e[c.selectedGroup].updated=!0);"event"===u?(r.year=c.year,r.month=c.month-1,r.date=c.date,r.name=c.name):"habit"===u&&(r.selector=c.rule,r.name=c.name);m.show(m.simple().content("\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));
f.editsEvent=!1;u=c.selectedGroup;"private"===u?b.save():h.post(a.group[u],u,"update")}else m.show(m.simple().content("\u5165\u529b\u304c\u4e0d\u9069\u5207\u3067\u3059").position("top right").hideDelay(3E3))}var n=[],k=[];a.mode=f;a.group=e;a.user=b;a.eventForm=c;a.calendar=g;a.ruleWriterFase="";a.ruleInput="";a.eventEditor={rules:"",selectedGroup:""};a.ruleGuide={day:[[":sun","\u65e5\u66dc\u65e5"],[":mon","\u6708\u66dc\u65e5"],[":tue","\u706b\u66dc\u65e5"],[":wed","\u6c34\u66dc\u65e5"],[":thu","\u6728\u66dc\u65e5"],
[":fri","\u91d1\u66dc\u65e5"],[":sat","\u571f\u66dc\u65e5"]],month:[[":1","1\u6708"],[":2","2\u6708"],[":3","3\u6708"],[":4","4\u6708"],[":5","5\u6708"],[":6","6\u6708"],[":7","7\u6708"],[":8","8\u6708"],[":9","9\u6708"],[":10","10\u6708"],[":11","11\u6708"],[":12","12\u6708"]],selector:[["month","\u4f55\u6708"],["date","\u4f55\u65e5"],["day","\u4f55\u66dc\u65e5"],["not","\u9664\u304f"],["range","\u7bc4\u56f2"]]};a.addEvent=function(){var e=c.type;"private"===c.selectedGroup?A(a.user["private"][e].length,
c.selectedGroup):null!==c.selectedGroup&&A(a.group[c.selectedGroup][e].length,c.selectedGroup)};a.editEvent=function(){A(c.id,c.selectedGroup)};a.cancel=function(){f.editsEvent=!1};a.goFase=function(e,b){n[n.length]=a.ruleWriterFase;k[k.length]=b||e;a.ruleWriterFase=e;c.rule=k.join("")};a.cancelFase=function(){a.ruleWriterFase=n.pop();k.pop();c.rule=k.join("")};a.finishWritingRule=function(){a.ruleWriterFase="";n=[];c.rule=k.join("");k=[]};a.startWritingRule=function(){a.ruleWriterFase="selector";
n=[];k=[]}}]);angular.module("rabbit").controller("groupEditorCtrl",["$scope","group","groupForm","db","$mdToast","mode",function(a,e,b,c,g,h){a.groupForm=b;b.parentGroup=[null];b.mode="add";a.group=e;a.finishMakingGroup=function(){h.editsGroup=!1};a.addGroup=function(){var f=b.parentGroup.reduce(function(a,c){-1===a.indexOf(c)&&(a[a.length]=angular.isNumber(c)?q(c):"");return a},[]),h={event:[],habit:[],name:b.name,updated:!0};""!==f.join("")&&(h.parents=f);e[e.length]=h;c.post(h,e.length-1,"insert").success(a.finishMakingGroup);
g.show(g.simple().content("\u30b0\u30eb\u30fc\u30d7 "+b.name+" \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));b.name=""};a.cancel=function(){h.editsGroup=!1}}]);angular.module("rabbit").controller("detailCtrl",["$scope","eventCal","calendar","user","mode",function(a,e,b,c,g){a.mode=g;a.calendar=b;a.eventCalendar=e.eventCalendar;a.user=c;a.isToday=function(){return b.selected===b.today.date&&b.month===b.today.month&&b.year===b.today.year}}]);angular.module("rabbit").controller("settingCtrl",
["$scope","_","group","user","db","eventListToEdit","groupForm","mode","$mdSidenav","$mdToast","$mdDialog",function(a,e,b,c,g,h,f,m,A,n,k){function q(c){return-1!==a.user.following.indexOf(c)}function w(a){if(!b[a].parents)return[];for(var c=b[a].parents,e=0,f=b[a].parents.length;e<f;e++)c=w(b[a].parents[e]).concat(c);return c}a.group=b;a.user=c;a.groupForm=f;a.search_keyword="";a.searchResult=[];a.hide=function(a){c.hiddenGroup[c.hiddenGroup.length]=a;c.hiddenGroup.sort(D);c.save()};a.show=function(b){c.hiddenGroup=
e.without(a.user.hiddenGroup,b);c.save()};a.followsParent=function(a){a=w(a);for(var c=0,e=a.length;c<e;c++)if(!q(a[c]))return a[c];return!0};a.toggleNav=function(){A("left").close()};a.follows=q;a.follow=function(e){a.user.following[a.user.following.length]=e;a.user.following.sort(D);c.save();n.show(n.simple().content(b[e].name+"\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3))};a.unfollow=function(e){var f=[];f[f.length]=a.user.following.indexOf(e);for(var g=
0,h=a.user.following.length;g<h;g++)if(b[a.user.following[g]].parents&&-1!=w(a.user.following[g]).indexOf(e)){if(!confirm("\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u306e\u5b50\u30b0\u30eb\u30fc\u30d7("+b[a.user.following[g]].name+")\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u30d5\u30a9\u30ed\u30fc\u89e3\u9664\u3059\u308b\u3068\u3053\u3061\u3089\u3082\u89e3\u9664\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b?"))return;
f[f.length]=g}f.sort(function(a,c){return c-a});g=0;for(h=f.length;g<h;g++)a.user.following.splice(f[g],1);c.save()};a.showEventList=function(a){h.id=a;m.showsEventList=!0};a.makeGroup=function(){m.editsGroup=!0;A("left").close()};a.search=function(){var c=[];if(""==a.search_keyword||!b)return c;for(var e=0,f=b.length;e<f&&!(30<c.length);e++)b[e]&&b[e].name&&-1!==b[e].name.indexOf(a.search_keyword)&&(c[c.length]=e);a.searchResult=c};a.randomSearch=function(){var c=[];if(5>b.length)Array.prototype.push.apply(c,
b);else for(;5>c.length;){var f=Math.random()*b.length|0;-1===e.indexOf(c,f)&&(c[c.length]=f)}a.searchResult=c};a.hideAll=function(){c.hiddenGroup.length=0;c.hiddenGroup=e.clone(c.following);c.hiddenGroup[c.hiddenGroup.length]=-1;c.hiddenGroup.sort(D);c.save()};a.showAll=function(){c.hiddenGroup=[];c.save()};a.importSetting=function(){k.show({controller:["$scope","$mdDialog",function(a,c){a.text="";a.answer=function(a){c.hide(a)}}],template:'<md-dialog><md-content>\u30b3\u30d4\u30fc\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002<br><input ng-model="text"><md-button ng-click="answer(text)">ok</md-button></md-content></md-dialog>'}).then(function(a){a=
JSON.parse(a);for(var e in a)c[e]=a[e];c.save()})};a.exportSetting=function(){k.show(k.alert().title("").content("\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u79fb\u884c\u5148\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002"+angular.toJson(c)).ok("ok"))}}]);angular.module("rabbit").controller("eventListCtrl",["$scope","group","user","eventListToEdit","mode",function(a,e,b,c,g){a.eventListToEdit=c;a.group=e;a.user=b;"private"!==c.id&&""!==c.id?(a.habitList=e[c.id].habit,a.eventList=
e[c.id].event):(a.habitList=b["private"].habit,a.eventList=b["private"].event);a.mode=g}]);angular.module("rabbit").factory("user",["_","$rootScope","$mdDialog","group","localStorageService",function(a,e,b,c,g){if(g.get("private")){var h=angular.fromJson(g.get("private"));h.id||(h.id=E());h.updated=!0}else h={following:[],"private":{event:[],habit:[],name:"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8"},hiddenGroup:[],id:E()},b.show(b.alert().title("[\u91cd\u8981]\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u751f\u6210\u3057\u307e\u3057\u305f\u3002").content("\u3053\u308c\u306f\u3042\u306a\u305f\u306eID\u3067\u3059\u3002\u5927\u5207\u306a\u306e\u3067\u30e1\u30e2\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002"+
angular.toJson(h)+" \u3053\u308c\u306f\u8a2d\u5b9a\u753b\u9762\u306e\u8a2d\u5b9a\u3092\u4fdd\u5b58\u304b\u3089\u3082\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002").ok("ok"));h.isHiddenGroup=function(c){return-1!==a.indexOf(this.hiddenGroup,c,!0)};h.save=function(){e.$broadcast("updated");g.set("private",angular.toJson(this))};h.hasPermission=function(e){return"private"===e||-1!==a.indexOf(c[e].permission,h.id)};h.save();return h}]).factory("eventForm",function(){return{name:"",year:(new Date).getFullYear(),
month:(new Date).getMonth()+1,date:(new Date).getDate(),type:"event",rule:""}}).factory("groupForm",function(){return{name:""}}).factory("group",["_","$http",function(a,e){return[{id:0,event:[],habit:[{name:"[mes]\u5143\u65e6",selector:"range:1948/7/20.. month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"range:1948/7/20..1999/12/31 month:1 date:15"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"range:2000/1/1.. month:1 day:2nd-mon"},{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u306e\u65e5",
selector:"range:1967/1/1.. month:2 date:11"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"range:1948/7/20..1988/12/31 month:4 date:29"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"range:1989/1/1..2006/12/31 month:4 date:29"},{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"range:2007/1/1.. month:4 date:29"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"range:1948/7/20.. month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"range:2007/1/1.. month:5 date:4"},
{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",selector:"range:1948/7/20.. month:5 date:5"},{name:"[mes]\u6d77\u306e\u65e5",selector:"range:1996/1/1..2002/12/31 month:7 date:20"},{name:"[mes]\u6d77\u306e\u65e5",selector:"range:2003/1/1.. month:7 day:3rd-mon"},{name:"[mes]\u5c71\u306e\u65e5",selector:"range:2016/1/1.. month:8 date:11"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"range:1966/1/1..2002/12/31 month:9 date:15"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"range:2003/1/1.. month:9 day:3rd-mon"},
{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"range:1966/1/1..1999/12/31 month:10 date:10"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"range:2000/1/1.. month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",selector:"range:1948/7/20.. month:11 date:3"},{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"range:1948/7/20.. month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"range:1989/1/1.. month:12 date:23"},{name:"[mes]\u6625\u5206\u306e\u65e5",selector:"range:1949/1/1.. date:vernal-equinox-day"},
{name:"[mes]\u79cb\u5206\u306e\u65e5",selector:"range:1948/1/1.. date:autumnal-equinox-day"},{name:"[mes]\u5341\u4e94\u591c",selector:"range:1901/1/1.. date:full-moon-night"}],name:"\u795d\u65e5",updated:!0}]}]).factory("calendar",["OVER_MONTH","MEMO_LIMIT","IS_SMART_PHONE",function(a,e,b){a===t&&(a=64);e===t&&(e=1950);b===t&&(b=!1);var c=new Date,g=[];return{year:c.getFullYear(),month:c.getMonth(),date:c.getDate(),calendar:function(c,b,m){m=m||!1;if(!m)if(g[c-e]){if(g[c-e][b])return g[c-e][b]}else g[c-
e]=[];var q=[31,28,31,30,31,30,31,31,30,31,30,31][b];1===b&&N(c)&&(q=29);var n=[],k=0,B=(new Date(c,b,1)).getDay(),w=[];if(m)for(k=1;k<=q;k++)n[n.length]=k;else{for(k=B;0<k;k--)w[w.length]=0;for(k=1;k<=q;k++)6<B&&(B=0,n[n.length]=w,w=[]),w[w.length]=k,B++;for(k=B;7>k;k++)w[w.length]=a}0<w.length&&(n[n.length]=w);return m?n:g[c-e][b]=n},today:{year:c.getFullYear(),month:c.getMonth(),date:c.getDate()},selected:c.getDate(),selectedDay:function(){return null==this.selected?"":"\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")[(new Date(this.year,
this.month,this.selected)).getDay()]},disableHoverEvent:b}}]).factory("eventCal",["_","group","user","calendar","error","MEMO_LIMIT","ATTRIBUTE",function(a,e,b,c,g,h,f){function m(c,g,f){if("private"!==c&&!e[c])return[];var h=[],x=[];"private"===c?(a.each(b.following,function(a){x=x.concat(m(a,g,f))}),h=h.concat(A(b["private"].event,g,f,"private")),x=x.concat(h),h=h.concat(n(b["private"].habit,g,f,"private",x)),b.updated=!1):(e[c].parents&&a.each(e[c].parents,function(a){x=x.concat(m(a,g,f))}),h=
h.concat(A(e[c].event,g,f,c)),x=x.concat(h),h=h.concat(n(e[c].habit,g,f,c,x)),e[c].updated=!1);if(0===c){if(!(1973>g||1973==g&&4>f)){var l=a.map(h,function(a){return a.date});c=a.intersection(l,k("day:sun",g,f,[]));h.push.apply(h,a.map(c,function(c){for(var e=1;-1!==a.indexOf(l,c+e,!0);)e+=1;return{year:g,month:f,date:c+e,name:"[mes]\u632f\u66ff\u4f11\u65e5",group:0,id:-1,type:"habit"}}));h.sort()}if(1985<=g||1985==g&&12==f&&27<=d){var l=a.map(h,function(a){return a.date}),C=0;a.each(l,function(a){2===
a-C&&h.push({year:g,month:f,date:a-1,name:"[mes]\u56fd\u6c11\u306e\u4f11\u65e5",group:0,id:-2,type:"habit"});C=a});h.sort()}}return h}function A(c,e,b,g){var f=[];if(!c)return f;for(var h=0,C=c.length;h<C;h++)if(c[h].year===e&&c[h].month===b){var J=a.clone(c[h]);J.group=g;J.type="event";J.id=h;f[f.length]=J}return f}function n(c,e,b,g,f){if(!c)return[];for(var h=[],C=0,J=c.length;C<J;C++){c[C].type="habit";c[C].group=g;var m=k(c[C].selector,e,b,f);a.each(m,function(a,f){m[f]={year:e,month:b,date:a,
name:c[C].name,group:g,id:C,type:"habit"}});h=h.concat(m)}return h}function k(b,f,h,k){function x(b,f,h,k){var z=function(){return c.calendar(f,h,!0)},l=function(a){a=a.toLowerCase();return"public-holiday"===a||"publicholiday"===a||"\u795d\u65e5"===a},n=function(a){a=a.toLowerCase();return"vernal-equinox-day"===a||"vernalequinoxday"===a||"\u6625\u5206"===a||"\u6625\u5206\u306e\u65e5"===a},T=function(a){a=a.toLowerCase();return"autumnal-equinox-day"===a||"autumnalequinoxday"===a||"\u79cb\u5206"===
a||"\u79cb\u5206\u306e\u65e5"===a},U=function(a){a=a.toLowerCase();return"full-moon-night"===a||"fullmoonnight"===a||"\u5341\u4e94\u591c"===a||"\u4e2d\u79cb\u306e\u540d\u6708"===a},w=c.calendar(f,h),A={sunday:0,sun:0,"\u65e5\u66dc\u65e5":0,"\u65e5":0,monday:1,mon:1,"\u6708\u66dc\u65e5":1,"\u6708":1,tuesday:2,tue:2,"\u706b\u66dc\u65e5":2,"\u706b":2,wednesday:3,wed:3,"\u6c34\u66dc\u65e5":3,"\u6c34":3,thursday:4,thu:4,"\u6728\u66dc\u65e5":4,"\u6728":4,friday:5,fri:5,"\u91d1\u66dc\u65e5":5,"\u91d1":5,
saturday:6,sat:6,"\u571f\u66dc\u65e5":6,"\u571f":6},u={january:0,jan:0,"\u7766\u6708":0,february:1,feb:1,"\u5982\u6708":1,march:2,mar:2,"\u5f25\u751f":2,april:3,apr:3,"\u536f\u6708":3,may:4,"\u7690\u6708":4,june:5,jun:5,"\u6c34\u7121\u6708":5,july:6,jul:6,"\u6587\u6708":6,august:7,aug:7,"\u8449\u6708":7,september:8,sep:8,"\u9577\u6708":8,october:9,oct:9,"\u795e\u7121\u6708":9,november:10,nov:10,"\u971c\u6708":10,december:11,dec:11,"\u5e2b\u8d70":11},v=b.split(":")[0];b=b.split(":").slice(1).join(":");
var p=[],F=[],t=[],B=[],y,r,G,H=[];if("not"===v)if(p=z(),l(b)){b=m(0,f,h);l=0;for(v=b.length;l<v;l++)b[l]=b[l].date;p=a.difference(p,b)}else if(0===b.indexOf("year")||0===b.indexOf("month")||0===b.indexOf("date")||0===b.indexOf("day"))b=b.replace(/=/,":"),p=a.difference(z(),x(b,f,h));else{var D=b.split("=")[0],E=b.replace(/^.+?=/,""),E=E.replace(/^"(.+)"$/,"$1");a.each(k,function(b){if(b[D]===E||0===b[D].indexOf("[mes]")&&b[D].slice(5)===E)p=a.without(p,b.date)})}else if("is"===v)if(p=z(),l(b)){b=
m(0,f,h);l=0;for(v=b.length;l<v;l++)b[l]=b[l].date;p=a.intersection(p,b)}else{if("last"===b)return b=[31,28,31,30,31,30,31,31,30,31,30,31][h],N(f)&&1===h&&(b=29),[b];throw g("unexpected a value of a yesterday selector."+b);}else if("yesterday"===v)if(p=z(),v=b.split(":")[0],b.split(":").slice(1).join(":"),l(b))p=a.intersection(p,a.map(x("is:"+b,f,h),function(a){return a+1}));else if("day"===v||"date"===v)p=a.intersection(z(),a.map(x(b,f,h),function(a){return a+1}));else throw g("unexpected a value of a yesterday selector."+
b);else if("range"===v)if(".."===b.slice(0,2)){b="..."===b.slice(0,3)?b.slice(3):b.slice(2);b=a.map(b.split("/"),q);y=new Date(b[0],b[1]-1,b[2]);if(!M(b[0],b[1]-1,b[2]))throw g("invalid range selector."+v+":"+b);y.getFullYear()<f||y.getFullYear()==f&&y.getMonth()<h?p=[]:y.getFullYear()==f&&y.getMonth()==h?(p=z(),p=p.slice(0,a.lastIndexOf(p,y.getDate(),!0)+1)):p=z()}else if(".."===b.slice(-2)){b="..."===b.slice(-3)?b.slice(0,-3):b.slice(0,-2);b=a.map(b.split("/"),q);l=new Date(b[0],b[1]-1,b[2]);if(!M(b[0],
b[1]-1,b[2]))throw g("invalid range selector."+v+":"+b);l.getFullYear()>f||l.getFullYear()==f&&l.getMonth()>h?p=[]:l.getFullYear()==f&&l.getMonth()==h?(p=z(),p=p.slice(a.indexOf(p,l.getDate(),!0))):p=z()}else if(-1!==b.indexOf(".."))p=[],b=b.split("..."),1===b.length&&(b=b[0].split("..")),F=[],t=[],B=[],l=b[0],H=[],y=b[1],r=y.substr(y.length-4,4),G=y.substr(y.length-5,5),l=a.map(l.split("/"),q),3===l.length?H.push(new Date(l[0],l[1]-1,l[2])):2===l.length&&H.push(new Date(f-1,l[0]-1,l[1]),new Date(f,
l[0]-1,l[1])),a.each(H,function(b){b.getFullYear()>f||b.getFullYear()==f&&b.getMonth()>h?F=[]:b.getFullYear()==f&&b.getMonth()==h?(F=z(),F=F.slice(a.indexOf(F,b.getDate(),!0))):F=z();B.push(F)}),H=a.zip(H,B),a.each(H,function(b){var c=b[0];b=b[1];var e;if("date"===r||"week"===r||"year"===r||"dates"===G||"weeks"===G||"years"===G){var g;g="date"===r||"week"===r||"year"===r?q(y.substring(0,y.length-4)):q(y.substring(0,y.length-5));e=new Date(c.getTime());"date"===r||"dates"===G?e.setDate(e.getDate()+
g):"week"===r||"weeks"===G?e.setDate(e.getDate()+7*g):"year"!==r&&"years"!==G||e.setFullYear(e.getFullYear()+g)}else e=y.split("/"),e=a.map(e,q),3===e.length?e=new Date(e[0],e[1]-1,e[2]):(e=new Date(c.getFullYear(),e[0]-1,e[1]),e.getTime()<c.getTime()&&e.setFullYear(e.getFullYear()+1));e.getFullYear()<f||e.getFullYear()==f&&e.getMonth()<h?t=[]:e.getFullYear()==f&&e.getMonth()==h?(t=z(),t=t.slice(0,a.lastIndexOf(t,e.getDate(),!0)+1)):t=z();a.isEmpty(a.intersection(b,t))||(p=a.intersection(b,t))});
else throw g('invalid selector "'+v+":"+b+'" in '+e[groupID].name+".");else if("date"===v)T(b)?p=1948>f||2030<f?[]:8!==h?[]:[[23,23,23,24,23,23,23,24,23,23,23,24,23,23,23,24,23,23,23,24,23,23,23,24,23,23,23,24,23,23,23,24,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,22,23,23,23,22,23,23,23,22,23,23,23,22,23,23,23,22,23,23][f-1948]]:n(b)?p=1949>f||2030<f?[]:2!==h?[]:[[21,21,21,21,21,21,21,21,21,21,21,20,21,21,21,20,21,21,21,20,21,21,21,20,21,21,21,
20,21,21,21,20,21,21,21,20,21,21,21,20,21,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,20,21,20,20,20][f-1949]]:U(b)?(b=[{date:27},{date:16},{month:9,date:5},{date:24},{date:13},{month:9,date:2},{date:22},{date:10},{date:29},{date:18},{month:9,date:6},{date:25},{date:15},{month:9,date:4},{date:23},{date:12},{date:30},{date:19},{month:9,date:8},{date:26},{date:16},{month:9,date:5},{date:25},{date:13},{month:9,date:2},{date:21},{date:10},
{date:28},{date:17},{month:9,date:6},{date:26},{date:15},{month:9,date:4},{date:23},{date:12},{date:30},{date:19},{month:9,date:8},{date:27},{date:16},{month:9,date:5},{date:25},{date:14},{month:9,date:1},{date:20},{date:10},{date:29},{date:17},{month:9,date:6},{date:26},{date:15},{month:9,date:3},{date:22},{date:11},{date:30},{date:19},{date:8},{date:27},{date:17},{month:9,date:5},{date:24},{date:13},{month:9,date:2},{date:20},{date:10},{date:29},{date:18},{month:9,date:6},{date:26},{date:15},{month:9,
date:3},{date:22},{date:11},{date:30},{date:20},{date:8},{date:27},{date:17},{month:9,date:5},{date:23},{date:12},{month:9,date:1},{date:21},{date:10},{date:29},{date:18},{month:9,date:7},{date:25},{date:14},{month:9,date:3},{date:22},{date:11},{date:30},{date:20},{date:9},{date:27},{date:16},{month:9,date:5},{date:24},{date:12},{month:9,date:1},{date:21},{date:11},{date:28},{date:18},{month:9,date:6},{date:25},{date:14},{month:9,date:3},{date:22},{date:12},{date:30},{date:19},{date:8},{date:27},
{date:15},{month:9,date:4},{date:24},{date:13},{month:9,date:1},{date:21},{date:10},{date:29},{date:17},{month:9,date:6},{date:25},{date:15},{month:9,date:3},{date:22},{date:12}],p=1901>f||2030<f?[]:!b[f-1901].month&&8===h||b[f-1901].month===h?[b[f-1901].date]:[]):p=[q(b)];else if("month"===v)p=!u[b.toLowerCase()]&&q(b)!==h+1||u[b.toLowerCase()]&&u[b.toLowerCase()]!=h?[]:z();else if("day"===v)if(b.match(/^\d/))b=b.toLowerCase().match(/^(\d+)(?:st|[nr]d|th)-?(.+)$/),l=q(b[1]),p=[(x("day:"+b[2],f,h)||
[])[l-1]];else if("last"===b.slice(0,4).toLowerCase()){b=b.toLowerCase();var I=b.slice(4);"-"===I.charAt(0)&&(I=I.slice(1));p=[a.last(x("day:"+I,f,h))]}else I=A[b.toLowerCase()],a.some(w,function(a){""!==a[I]&&(p[p.length]=a[I])});else if("year"===v)p="leap-year"===b||"leap_year"===b||"\u3046\u308b\u3046\u5e74"===b||"\u958f\u5e74"===b?N(f)?z():[]:q(b)!==f?[]:z();else throw g('undefined key "'+v+'".');return p}if(""===b)throw g("cannot exec empty selector.");b=w(B(b));k=k||[];var l=[];a.each(b,function(b){if(b[1]===
t)l[l.length]=x(b[0],f,h,k);else if(b[1]===r)if("&&"===b[0])l.push(a.intersection(l.pop(),l.pop()));else if("||"===b[0])l.push(a.union(l.pop(),l.pop()));else throw g("undefined operator "+b[0]);});if(1!=l.length)throw console.log(l,b),g("unexpected error in execSelectors().");return l.pop()}function B(a){function b(a){""!==a[0]&&(c[c.length]=a)}if(O[a])return O[a];for(var c=[],e=!1,f=0,g=0,h=a.length;g<h;g++){var m=a.charAt(g);if(e)'"'===m?e=!1:"\\"===m&&(g+=1);else if('"'===m)e=!0;else if(" "===
m)b([a.substring(f,g),t]),m=a.substr(g).match(/^ (?:and|&&|\u304b\u3064|or|\|\||\u307e\u305f\u306f) |^ /)[0],b([{" ":"&&"," and ":"&&"," \u304b\u3064 ":"&&"," && ":"&&"," or ":"||"," \u307e\u305f\u306f ":"||"," || ":"||"}[m],r]),f=g+m.length,g+=m.length;else if("("===m||")"===m)b([a.substring(f,g),t]),b([m,"("===m?L:D]),f=g+1}""!==a.substring(f)&&b([a.substring(f),t]);return O[a]=c}function w(a){for(var b=[],c=[],e={"||":0,"&&":1},f=0,h=a.length;f<h;f++)if(a[f][1]===t)c[c.length]=a[f].concat();else if(a[f][1]===
r){var m=a[f][0];b[b.length-1]&&e[m]<=e[b[b.length-1][0]]&&(c[c.length]=b.pop());b[b.length]=a[f]}else if(a[f][1]===L)b[b.length]=a[f];else if(a[f][1]===D){for(;b[b.length-1][1]!=L;)if(c[c.length]=b.pop(),0===b.length)throw g("found mismatched parentheses");b.pop()}for(;0<b.length;){if(b[b.length-1][1]===L)throw g("found mismatched parentheses.");c[c.length]=b.pop()}return c}for(var u in f);var r=f.OPERATOR,t=f.OTHERS,L=f.LPARENTHESES,D=f.RPARENTHESES,O={},K=[],P="",E=-1,Q=-1;return{eventCalendar:function(e){var f=
[],g=[],h=a.difference(b.following,b.hiddenGroup);if(c.year!==E||c.month!==Q)E=c.year,Q=c.month,K=[];else if(h.join(",")!==P||b.updated||a.any(h,function(a){return!0===a.updated}))K=[],P=h.join(",");else return K[e]||[];for(var k=0,l=h.length;k<l;k++)f[f.length]=m(h[k],c.year,c.month);b.isHiddenGroup(-1)||(f[f.length]=m("private",c.year,c.month));k=0;for(l=f.length;k<l;k++)for(var n=0,q=f[k].length;n<q;n++){var r=f[k][n].date;g[r]||(g[r]=[]);g[r][g[r].length]=f[k][n].id+":"+f[k][n].group+":"+f[k][n].type}K=
a.clone(g);P=h.join(",");return K[e]||[]},splitSelector:B,execSelectors:k}}]).factory("eventListToEdit",function(){return{id:""}}).factory("error",["$mdToast",function(a){var e=e||Error;return function(b){a.show(a.simple().content(b).position("top right").hideDelay(3E3));return new e(b)}}]).factory("mode",["_","eventForm","$mdSidenav","user","group",function(a,e,b,c,g){return{editsEvent:!1,editsGroup:!1,showsEventList:!1,switchToEdit:function(){var h=S.call(arguments);if(1===h.length||2===h.length&&
!0===h[1]){var f=h[0].split(":");e.mode=1===h.length?"edit":"add";a.extend(e,{type:f[2],id:1===h.length?q(f[0]):0});e.selectedGroup="private"!==f[1]?q(f[1]):"private";"event"===f[2]?(a.map(["year","month","date","name"],function(a){e[a]="private"===f[1]?c["private"].event[f[0]][a]:g[f[1]].event[f[0]][a]}),e.month+=1):"habit"===f[2]&&("private"===f[1]?(e.rule=c["private"].habit[f[0]].selector,e.name=c["private"].habit[f[0]].name):(e.rule=g[f[1]].habit[f[0]].selector,e.name=g[f[1]].habit[f[0]].name));
e.isMessage="[mes]"===e.name.slice(0,5);e.isMessage&&(e.name=e.name.slice(5))}else 3===h.length&&a.extend(e,{mode:"add",type:"event",rule:"",id:0,name:"",year:h[0],month:h[1]+1,date:h[2]});this.editsEvent=!0;b("left").close()}}}]).factory("db",["_","group","user","$http","$rootScope","$log",function(a,e,b,c,g,h){return{post:function(b,e,q){b=a.clone(b);b.id=e;b.permission=b.permission||[];b.parents=b.parents||"";delete b.updated;for(var n in b)b[n]=R(angular.toJson(b[n]));b.type=q;g.$broadcast("updated");
return c.post("http://www40.atpages.jp/chatblanc/genderC/database.php",b).success(function(a){h.log("updated");h.log(a)}).error(function(a){h.log(a)})},list:function(){return c.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"list",groupID:b.following.join(",")}).success(function(a){return a}).error(function(a){h.log(a)})},getNameList:function(){return c.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"namelist"}).success(function(a){return a})}}}]).run(["calendar",
"$timeout",function(a,e){function b(){var c=new Date;c.setDate(c.getDate()+1);c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);var h=new Date;a.today.year=h.getFullYear();a.today.month=h.getMonth();a.today.date=h.getDate();e(b,c-new Date)}var c=new Date;c.setDate(c.getDate()+1);c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);e(b,c-new Date)}]);angular.module("rabbit").directive("appDate",function(){return{scope:{row:"=appRow"},restrict:"A",template:'<span class="date"></span>',
replace:!0,controller:["$scope","calendar","eventCal","$filter","OVER_MONTH","IS_SMART_PHONE",function(a,e,b,c,g,h){a.OVER_MONTH=g;a.IS_SMART_PHONE=h;a.calendar=e;a.dateClass=function(a){if(0!==a&&32!==a){var g=[];e.selected===a&&(g[g.length]="selected");for(var h=g.length,n=b.eventCalendar(a),k=0,q=0,t=n.length;q<t;q++)0!==c("format")(n[q],!1).indexOf("[mes]")&&k++;g[h]="booked-"+(5>k?k:5);a===e.today.date&&e.month===e.today.month&&e.year===e.today.year&&(g[g.length]="today");return g}return[]}}],
link:function(a,e,b){function c(){e.removeClass("selected booked-0 booked-1 booked-2 booked-3 booked-4 booked-5 today");e.addClass(a.dateClass(g).join(" "))}var g=a.row[b.appDate];0!==g&&g!==a.OVER_MONTH&&g!==t&&(e.append(angular.element("<span>").addClass("inner").text(g)),a.$on("updated",c),c(),e.on("mouseenter",function(){!a.calendar.disableHoverEvent&&g&&(a.calendar.selected=g,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),c(),a.$apply())}),e.on("mouseleave",function(){a.calendar.disableHoverEvent||
(a.calendar.selected=null,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),a.$apply())}),e.on("click",function(){a.IS_SMART_PHONE||(a.calendar.disableHoverEvent=a.calendar.selected===g?!a.calendar.disableHoverEvent:!0);a.calendar.selected=g;angular.element(document.querySelectorAll(".selected")).removeClass("selected");c();a.$apply()}))}}}).directive("eventItem",function(){return{restrict:"A",scope:{event:"=appEvent"},template:'<div class="md-item-content event-item" layout="row"><div flex>{{event|format}}</div><div flex><md-button ng-click="mode.switchToEdit(event)">\u7de8\u96c6</md-button><md-button ng-click="mode.switchToEdit(event,true)">\u30b3\u30d4\u30fc</md-button><md-button ng-click="deleteEvent(event)" ng-if="user.hasPermission(event.split(\':\')[1])">\u524a\u9664</md-button></div></div>',
replace:!0,controller:["$scope","mode","user","db",function(a,e,b,c){a.mode=e;a.user=b;a.deleteEvent=function(a){var e=a.split(":")[0],f=a.split(":")[1];a=a.split(":")[2];b.hasPermission(f)&&("private"===f?(b["private"][a].splice(e,1),b.updated=!0,b.save()):(group[f][a].splice(e,1),group[f].updated=!0,c.post(group[f],f,"update")))}}],link:function(a,e,b){}}})})(window);
