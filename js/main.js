'use strict';(function(R,D){function K(a,c){return a-c}function r(a){return parseInt(a,10)}function P(a){a.replace(/[\uff21-\uff3a\uff41-\uff5a\uff10-\uff19]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})}function M(a){return 0===a%400||0===a%4&&0!==a%100}function N(){var a="",c,d;for(c=0;32>c;c++){d=16*Math.random()|0;if(8==c||12==c||16==c||20==c)a+="-";a+=(12==c?4:16==c?d&3|8:d).toString(16)}return a}var O=0<navigator.userAgent.indexOf("iPhone")&&-1==navigator.userAgent.indexOf("iPad")||
0<navigator.userAgent.indexOf("iPod")||0<navigator.userAgent.indexOf("Android"),Q=Array.prototype.slice;angular.module("rabbit",["ngTouch","ngAnimate","ngMaterial","ngMessages"]).controller("mainCtrl",["$scope","_","calendar","eventCal","mode","$mdSidenav",function(a,c,d,b,f,h){a._=c;a.mode=f;f.editsEventForm=!1;f.editsGroupForm=!1;a.splitSelector=b.splitSelector;a.openNav=function(){h("left").toggle()};d.selected=d.date;a.eventCalendar=b.eventCalendar}]).config(["$httpProvider",function(a){a.defaults.transformRequest=
function(a){if(a===D)return a;if(angular.isObject(a)){var d=[],b;for(b in a)if(a.hasOwnProperty(b)){var f=a[b];d[d.length]=encodeURIComponent(b)+"="+encodeURIComponent(null==f?"":f)}a=d.join("&").replace(/%20/g,"+")}else a=null==a?"":a.toString();return a};a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]).filter("format",["group","user",function(a,c){return function(d,b){d=d.split(":");var f="",f="private"==d[1]?c["private"][d[2]][d[0]].name:0===r(d[1])&&-1===r(d[0])?
"[mes]\u632f\u66ff\u4f11\u65e5":a[d[1]][d[2]][d[0]].name;!1!==b&&0===f.indexOf("[mes]")&&(f=f.replace(/^\[mes\]/,""));return f}}]).run(["_","db","group","$rootScope",function(a,c,d,b){var f=a.clone(d)[0];localStorage&&localStorage.getItem("group")&&(d.length=0,Array.prototype.push.apply(d,angular.fromJson(localStorage.getItem("group"))),d[0]=a.clone(f));c.list().then(function(h){h=h.data;for(var e=0,q=h.length;e<q;e++){for(var l in h[e])h[e][l]=angular.fromJson(h[e][l]);h[e].updated=!0}h.sort(function(a,
b){return a.id-b.id});e=d.length=0;for(q=h.length;e<q;e++)d[h[e].id]=h[e];d[0]=a.clone(f);b.$broadcast("updated");localStorage.setItem("group",angular.toJson(d));c.getNameList().then(function(b){for(var c=0,e=b.data[0].length;c<e;c++)d[c]||(d[c]={name:angular.fromJson(b.data[0][c])},b.data[1][c]&&(d[c].parents=angular.fromJson(b.data[1][c])));d[0]=a.clone(f);localStorage.setItem("group",angular.toJson(d))})})}]).directive("eventItem",function(){return{restrict:"A",scope:{event:"=appEvent"},template:'<div class="md-item-content event-item" layout="row"><div flex>{{event|format}}</div><div flex><md-button ng-click="mode.switchToEdit(event)">\u7de8\u96c6</md-button><md-button ng-click="mode.switchToEdit(event,true)">\u30b3\u30d4\u30fc</md-button><md-button ng-click="deleteEvent(event)" ng-if="user.hasPermission(event.split(\':\')[1])">\u524a\u9664</md-button></div></div>',
replace:!0,controller:["$scope","mode","user","db",function(a,c,d,b){a.mode=c;a.user=d;a.deleteEvent=function(a){var c=a.split(":")[0],e=a.split(":")[1];a=a.split(":")[2];d.hasPermission(e)&&("private"===e?(d["private"][a].splice(c,1),d.updated=!0,d.save()):(group[e][a].splice(c,1),group[e].updated=!0,b.post(group[e],e,"update")))}}],link:function(a,c,d){}}});angular.module("rabbit").controller("calendarCtrl",["$scope","calendar","mode",function(a,c,d){a.calendar=c;a.nextMonth=function(){a.calendar.month++;
a.calendar.selected=null;12<a.calendar.month+1&&(a.calendar.year+=1,a.calendar.month-=12);d.editsEventForm=!1};a.lastMonth=function(){a.calendar.month--;a.calendar.selected=null;1>a.calendar.month+1&&(1950>a.calendar.year-1?(alert("1950\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"),a.calendar.month+=1):(a.calendar.month+=12,--a.calendar.year));d.editsEventForm=!1};a.nextYear=function(){a.calendar.year++;
a.calendar.selected=null;d.editsEventForm=!1};a.lastYear=function(){1950>a.calendar.year-1?alert("1950\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"):(a.calendar.year--,a.calendar.selected=null);d.editsEventForm=!1};a.dates="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")}]).directive("appDate",function(){return{scope:{row:"=appRow"},restrict:"A",template:'<span class="date"></span>',replace:!0,
controller:["$scope","calendar","eventCal","$filter",function(a,c,d,b){a.calendar=c;a.bookedClass=function(a){a=d.eventCalendar(a);for(var c=0,e=0,q=a.length;e<q;e++)0!==b("format")(a[e],!1).indexOf("[mes]")&&c++;return 5>c?"booked-"+c:"booked-5"};a.dateClass=function(b){if(0!==b&&32!==b){var d=a.calendar,c=[];d.selected===b&&(c[c.length]="selected");c[c.length]=a.bookedClass(b);b===d.today.date&&d.month===d.today.month&&d.year===d.today.year&&(c[c.length]="today");return c}return[]}}],link:function(a,
c,d){function b(){c.removeClass("selected booked-0 booked-1 booked-2 booked-3 booked-4 booked-5 today");c.addClass(a.dateClass(f).join(" "))}var f=a.row[d.appDate];0!==f&&64!==f&&f!==D&&(c.append(angular.element("<span>").addClass("inner").text(f)),a.$on("updated",b),b(),c.on("mouseenter",function(){!a.calendar.disableHoverEvent&&f&&(a.calendar.selected=f,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),b(),a.$apply())}),c.on("mouseleave",function(){a.calendar.disableHoverEvent||
(a.calendar.selected=null,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),a.$apply())}),c.on("click",function(){O||(a.calendar.disableHoverEvent=a.calendar.selected===f?!a.calendar.disableHoverEvent:!0);a.calendar.selected=f;angular.element(document.querySelectorAll(".selected")).removeClass("selected");b();a.$apply()}))}}});angular.module("rabbit").controller("eventEditorCtrl",["$scope","group","user","eventForm","calendar","db","mode","$mdToast",function(a,c,d,b,
f,h,e,q){function l(f,l){var k=b.type,B=""===b.name||"event"===k&&(null===b.year||null===b.month||null===b.date)||"habit"===k&&""===b.rule||b.selectedGroup===D||null===b.selectedGroup;if(B)q.show(q.simple().content("\u5165\u529b\u304c\u4e0d\u9069\u5207\u3067\u3059").position("top right").hideDelay(3E3));else{if("event"===k&&(B=new Date(b.year,b.month-1,b.date),B=B.getFullYear()!==r(b.year)||B.getMonth()!==r(b.month)-1||B.getDate()!==r(b.date)))return;b.isMessage&&(b.name="[mes]"+b.name);"private"===
l?(d["private"][k][f]||(d["private"][k][f]={}),"event"===k?(d["private"][k][f].year=b.year,d["private"][k][f].month=b.month-1,d["private"][k][f].date=b.date,d["private"][k][f].name=b.name,d.updated=!0):"habit"===k&&(d["private"][k][f].selector=b.rule,d["private"][k][f].name=b.name,d.updated=!0)):(c[b.selectedGroup][k][f]||(c[b.selectedGroup][k][f]={}),"event"===k?(c[b.selectedGroup][k][f].year=b.year,c[b.selectedGroup][k][f].month=b.month-1,c[b.selectedGroup][k][f].date=b.date,c[b.selectedGroup][k][f].name=
b.name,c[b.selectedGroup].updated=!0):"habit"===k&&(c[b.selectedGroup][k][f].selector=b.rule,c[b.selectedGroup][k][f].name=b.name,c[b.selectedGroup].updated=!0));q.show(q.simple().content("\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));e.editsEventForm=!1;k=b.selectedGroup;"private"===k?d.save():h.post(a.group[k],k,"update")}}var z=[],t=[];a.mode=e;a.group=c;a.user=d;a.eventForm=b;a.calendar=f;a.ruleWriterFase="";a.ruleInput="";a.eventEditor=
{rules:"",selectedGroup:""};a.ruleGuide={day:[[":sun","\u65e5\u66dc\u65e5"],[":mon","\u6708\u66dc\u65e5"],[":tue","\u706b\u66dc\u65e5"],[":wed","\u6c34\u66dc\u65e5"],[":thu","\u6728\u66dc\u65e5"],[":fri","\u91d1\u66dc\u65e5"],[":sat","\u571f\u66dc\u65e5"]],month:[[":1","1\u6708"],[":2","2\u6708"],[":3","3\u6708"],[":4","4\u6708"],[":5","5\u6708"],[":6","6\u6708"],[":7","7\u6708"],[":8","8\u6708"],[":9","9\u6708"],[":10","10\u6708"],[":11","11\u6708"],[":12","12\u6708"]],selector:[["month","\u4f55\u6708"],
["date","\u4f55\u65e5"],["day","\u4f55\u66dc\u65e5"],["not","\u9664\u304f"],["range","\u7bc4\u56f2"]]};a.addEvent=function(){var d=b.type;"private"===b.selectedGroup?l(a.user["private"][d].length,b.selectedGroup):null!==b.selectedGroup&&l(a.group[b.selectedGroup][d].length,b.selectedGroup)};a.editEvent=function(){l(b.id,b.selectedGroup)};a.cancel=function(){e.editsEventForm=!1};a.goFase=function(d,c){z[z.length]=a.ruleWriterFase;t[t.length]=c||d;a.ruleWriterFase=d;b.rule=t.join("")};a.cancelFase=
function(){a.ruleWriterFase=z.pop();t.pop();b.rule=t.join("")};a.finishWritingRule=function(){a.ruleWriterFase="";z=[];b.rule=t.join("");t=[]};a.startWritingRule=function(){a.ruleWriterFase="selector";z=[];t=[]}}]);angular.module("rabbit").controller("groupEditorCtrl",["$scope","group","groupForm","db","$mdToast","mode",function(a,c,d,b,f,h){a.groupForm=d;a.groupForm.parentGroup=[null];a.groupForm.mode="add";a.group=c;a.finishMakingAGroup=function(){h.editsGroupForm=!1};a.addGroup=function(){var d=
a.groupForm.parentGroup.reduce(function(a,b){-1===a.indexOf(b)&&(a[a.length]=angular.isNumber(b)?r(b):"");return a},[]),h={event:[],habit:[],name:a.groupForm.name,updated:!0};""!==d.join("")&&(h.parents=d);c[c.length]=h;b.post(h,a.group.length-1,"insert").success(a.finishMakingAGroup);f.show(f.simple().content("\u30b0\u30eb\u30fc\u30d7 "+a.groupForm.name+" \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));a.groupForm.name=""};a.cancel=function(){h.editsGroupForm=!1}}]);
angular.module("rabbit").controller("detailCtrl",["$scope","eventCal","calendar","user","mode",function(a,c,d,b,f){a.mode=f;a.calendar=d;a.eventCalendar=c.eventCalendar;a.user=b;a.isToday=function(){return d.selected===d.today.date&&d.month===d.today.month&&d.year===d.today.year}}]);angular.module("rabbit").controller("settingCtrl",["$scope","_","group","user","db","eventListToEdit","groupForm","mode","$mdSidenav","$mdToast","$mdDialog",function(a,c,d,b,f,h,e,q,l,r,t){function A(b){return-1!==a.user.following.indexOf(b)}
function E(a){if(!d[a].parents)return[];for(var b=d[a].parents,c=0,f=d[a].parents.length;c<f;c++)b=E(d[a].parents[c]).concat(b);return b}a.group=d;a.user=b;a.groupForm=e;a.search_keyword="";a.searchResult=[];a.hide=function(a){b.hiddenGroup[b.hiddenGroup.length]=a;b.hiddenGroup.sort(K);b.save()};a.show=function(d){b.hiddenGroup=c.without(a.user.hiddenGroup,d);b.save()};a.followsParent=function(a){a=E(a);for(var b=0,d=a.length;b<d;b++)if(!A(a[b]))return a[b];return!0};a.toggleNav=function(){l("left").close()};
a.follows=A;a.follow=function(c){a.user.following[a.user.following.length]=c;a.user.following.sort(K);b.save();r.show(r.simple().content(d[c].name+"\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3))};a.unfollow=function(c){var f=[];f[f.length]=a.user.following.indexOf(c);for(var e=0,h=a.user.following.length;e<h;e++)if(d[a.user.following[e]].parents&&-1!=E(a.user.following[e]).indexOf(c)){if(!confirm("\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u306e\u5b50\u30b0\u30eb\u30fc\u30d7("+
d[a.user.following[e]].name+")\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u30d5\u30a9\u30ed\u30fc\u89e3\u9664\u3059\u308b\u3068\u3053\u3061\u3089\u3082\u89e3\u9664\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b?"))return;f[f.length]=e}f.sort(function(a,b){return b-a});e=0;for(h=f.length;e<h;e++)a.user.following.splice(f[e],1);b.save()};a.showEventList=function(a){h.id=a;q.showsEventList=!0};a.makeAGroup=
function(){q.editsGroupForm=!0;l("left").close()};a.search=function(){var b=[];if(""==a.search_keyword||!d)return b;for(var c=0,f=d.length;c<f&&!(30<b.length);c++)d[c]&&d[c].name&&-1!==d[c].name.indexOf(a.search_keyword)&&(b[b.length]=c);a.searchResult=b};a.randomSearch=function(){var b=[];if(5>d.length)Array.prototype.push.apply(b,d);else for(;5>b.length;){var f=Math.random()*d.length|0;-1===c.indexOf(b,f)&&(b[b.length]=f)}a.searchResult=b};a.hideAll=function(){b.hiddenGroup.length=0;b.hiddenGroup=
c.clone(b.following);b.hiddenGroup[b.hiddenGroup.length]=-1;b.hiddenGroup.sort(K);b.save()};a.showAll=function(){b.hiddenGroup=[];b.save()};a.importSetting=function(){t.show({controller:["$scope","$mdDialog",function(a,b){a.text="";a.answer=function(a){b.hide(a)}}],template:'<md-dialog><md-content>\u30b3\u30d4\u30fc\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002<br><input ng-model="text"><md-button ng-click="answer(text)">ok</md-button></md-content></md-dialog>'}).then(function(a){a=
JSON.parse(a);for(var d in a)b[d]=a[d];b.save()})};a.exportSetting=function(){t.show(t.alert().title("").content("\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u79fb\u884c\u5148\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002"+angular.toJson(b)).ok("ok"))}}]);angular.module("rabbit").controller("eventListCtrl",["$scope","group","user","eventListToEdit","mode",function(a,c,d,b,f){a.eventListToEdit=b;a.group=c;a.user=d;"private"!==b.id&&""!==b.id?(a.habitList=c[b.id].habit,a.eventList=
c[b.id].event):(a.habitList=d["private"].habit,a.eventList=d["private"].event);a.mode=f}]);angular.module("rabbit").factory("_",function(){return _}).factory("user",["_","$rootScope","$mdDialog","group",function(a,c,d,b){if(localStorage&&angular.fromJson(localStorage.getItem("private"))){var f=angular.fromJson(localStorage.getItem("private"));f.id||(f.id=N());f.updated=!0}else f={following:[],"private":{event:[],habit:[],name:"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8"},hiddenGroup:[],id:N()},d.show(d.alert().title("[\u91cd\u8981]\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u751f\u6210\u3057\u307e\u3057\u305f\u3002").content("\u3053\u308c\u306f\u3042\u306a\u305f\u306e\u30d1\u30bd\u30b3\u30f3\u306b\u306e\u307f\u4fdd\u5b58\u3055\u308c\u308b\u3082\u306e\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u767b\u9332\u3055\u308c\u305f\u308a\u3001\u3069\u3053\u304b\u3078\u9001\u3089\u308c\u305f\u308a\u3057\u307e\u305b\u3093\u3002\u305f\u3060\u3057\u3001\u306a\u306b\u304b\u306e\u62cd\u5b50\u306b\u30c7\u30fc\u30bf\u304c\u6d88\u53bb\u3055\u308c\u3066id\u304c\u5909\u66f4\u3055\u308c\u3066\u3057\u307e\u3046\u3068\u30b0\u30eb\u30fc\u30d7\u306e\u6a29\u9650\u304c\u6d88\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3060\u304b\u3089\u3001\u6b21\u306e\u6587\u5b57\u5217\u3092\u4fdd\u5b58\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002"+
angular.toJson(f)).ok("ok"));f.isHiddenGroup=function(b){return-1!==a.indexOf(this.hiddenGroup,b,!0)};f.save=function(){c.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))};f.hasPermission=function(d){return"private"===d||-1!==a.indexOf(b[d].permission,f.id)};f.save();return f}]).factory("eventForm",function(){return{name:"",year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),type:"event",rule:""}}).factory("groupForm",function(){return{name:""}}).factory("group",
["$http",function(a){var c=[{id:0,event:[{name:"[mes]\u5341\u4e94\u591c",year:2E3,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2001,month:9,date:1},{name:"[mes]\u5341\u4e94\u591c",year:2002,month:8,date:21},{name:"[mes]\u5341\u4e94\u591c",year:2003,month:8,date:11},{name:"[mes]\u5341\u4e94\u591c",year:2004,month:8,date:28},{name:"[mes]\u5341\u4e94\u591c",year:2005,month:8,date:18},{name:"[mes]\u5341\u4e94\u591c",year:2006,month:9,date:6},{name:"[mes]\u5341\u4e94\u591c",year:2007,month:8,
date:25},{name:"[mes]\u5341\u4e94\u591c",year:2008,month:8,date:14},{name:"[mes]\u5341\u4e94\u591c",year:2009,month:9,date:3},{name:"[mes]\u5341\u4e94\u591c",year:2010,month:8,date:22},{name:"[mes]\u5341\u4e94\u591c",year:2011,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2012,month:8,date:30},{name:"[mes]\u5341\u4e94\u591c",year:2013,month:8,date:19},{name:"[mes]\u5341\u4e94\u591c",year:2014,month:8,date:8},{name:"[mes]\u5341\u4e94\u591c",year:2015,month:8,date:27},{name:"[mes]\u5341\u4e94\u591c",
year:2016,month:8,date:15}],habit:[{name:"[mes]\u5143\u65e6",selector:"month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"month:1 day:2nd-mon"},{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"month:4 date:29"},{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u65e5",selector:"month:2 date:11"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"month:5 date:4"},{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",selector:"month:5 date:5"},
{name:"[mes]\u6d77\u306e\u65e5",selector:"month:7 day:3rd-mon"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"month:9 day:3rd-mon"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",selector:"month:11 date:3"},{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"month:12 date:23"}],name:"\u795d\u65e5",updated:!0}],d={name:"[mes]\u79cb\u5206\u306e\u65e5",month:8};
_.each([23,23,23,23,23,23,23,23,23,23,23,23,22,23,23,23,22,23,23,23,22,23,23,23,22,23,23,23,22,23,23],function(a,b){c[0].event[c[0].event.length]=_.extend(_.clone(d),{year:2E3+b,date:a})});var b={name:"[mes]\u6625\u5206\u306e\u65e5",month:2};_.each([20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,21,21,20,20,20,21,20,20,20],function(a,d){c[0].event[c[0].event.length]=_.extend(_.clone(b),{year:2E3+d,date:a})});return c}]).factory("calendar",function(){var a=new Date,c=[];return{year:a.getFullYear(),
month:a.getMonth(),date:a.getDate(),calendar:function(a,b){if(c[a-1950]){if(c[a-1950][b])return c[a-1950][b]}else c[a-1950]=[];var f=(new Date(a,b,1)).getDay(),h=[31,28,31,30,31,30,31,31,30,31,30,31][b];1===b&&M(a)&&(h=29);var e=[];e.year=a;e.month=b;for(var q=0;0===q||_.last(e[q-1])<h;){e[q]=[];for(var l=1;7>=l;l++)e[q][e[q].length]=0<7*q+l-f?7*q+l-f<=h?7*q+l-f:64:0;q++}return c[a-1950][b]=e},today:{year:a.getFullYear(),month:a.getMonth(),date:a.getDate()},selected:a.getDate(),selectedDay:function(){return null==
this.selected?"":"\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")[(new Date(this.year,this.month,this.selected)).getDay()]},disableHoverEvent:O}}).factory("eventListToEdit",function(){return{id:""}}).factory("error",["$mdToast",function(a){var c=c||Error;return function(d){a.show(a.simple().content(d).position("top right").hideDelay(3E3));return new c(d)}}]).factory("mode",["_","eventForm","$mdSidenav","user","group",function(a,c,d,b,f){return{editsEventForm:!1,editsGroupForm:!1,showsEventList:!1,
switchToEdit:function(){var h=Q.call(arguments);if(1===h.length||2===h.length&&!0===h[1]){var e=h[0].split(":");c.mode=1===h.length?"edit":"add";a.extend(c,{type:e[2],id:1===h.length?e[0]:0});c.selectedGroup="private"!==e[1]?r(e[1]):"private";"event"===e[2]?(a.map(["year","month","date","name"],function(a){c[a]="private"===e[1]?b["private"].event[e[0]][a]:f[e[1]].event[e[0]][a]}),c.month+=1):"habit"===e[2]&&("private"===e[1]?(c.rule=b["private"].habit[e[0]].selector,c.name=b["private"].habit[e[0]].name):
(c.rule=f[e[1]].habit[e[0]].selector,c.name=f[e[1]].habit[e[0]].name));c.isMessage="[mes]"===c.name.slice(0,5);c.isMessage&&(c.name=c.name.slice(5))}else 3===h.length&&a.extend(c,{mode:"add",type:"event",rule:"",id:0,name:"",year:h[0],month:h[1]+1,date:h[2]});this.editsEventForm=!0;d("left").close()}}}]).factory("db",["_","group","user","$http","$rootScope","$log",function(a,c,d,b,f,h){return{post:function(c,d,l){c=a.clone(c);c.id=d;c.permission=c.permission||[];c.parents=c.parents||"";delete c.updated;
for(var r in c)c[r]=P(angular.toJson(c[r]));c.type=l;f.$broadcast("updated");return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",c).success(function(a){h.log("updated");h.log(a)}).error(function(a){h.log(a)})},list:function(){return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"list",groupID:d.following.join(",")}).success(function(a){return a}).error(function(a){h.log(a)})},getNameList:function(){return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",
{type:"namelist"}).success(function(a){return a})}}}]).factory("eventCal",["_","group","user","calendar","error",function(a,c,d,b,f){function h(b,f,F){if("private"!==b&&!c[b])return[];var n=[],w=[];"private"===b?(a.each(d.following,function(a){w=w.concat(h(a,f,F))}),n=n.concat(e(d["private"].event,f,F,"private")),w=w.concat(n),n=n.concat(q(d["private"].habit,f,F,"private",w)),d.updated=!1):(c[b].parents&&a.each(c[b].parents,function(a){w=w.concat(h(a,f,F))}),n=n.concat(e(c[b].event,f,F,b)),w=w.concat(n),
n=n.concat(q(c[b].habit,f,F,b,w)),c[b].updated=!1);if(0===b){var x=a.map(n,function(a){return a.date});b=a.intersection(x,l("day:sun",f,F,[]));n.push.apply(n,a.map(b,function(b){for(var c=1;-1!==a.indexOf(x,b+c,!0);)c+=1;return{year:f,month:F,date:b+c,name:"[mes]\u632f\u66ff\u4f11\u65e5",group:0,id:-1,type:"habit"}}));n.sort()}return n}function e(b,c,d,f){var e=[];if(!b)return e;for(var h=0,H=b.length;h<H;h++)if(b[h].year===c&&b[h].month===d){var L=a.clone(b[h]);L.group=f;L.type="event";L.id=h;e[e.length]=
L}return e}function q(b,c,d,f,e){if(!b)return[];for(var h=[],H=0,L=b.length;H<L;H++){b[H].type="habit";b[H].group=f;var p=l(b[H].selector,c,d,e);a.each(p,function(a,e){p[e]={year:c,month:d,date:a,name:b[H].name,group:f,id:H,type:"habit"}});h=h.concat(p)}return h}function l(d,e,k,n){function w(d,e,p,k){var v=function(){return a.flatten(x)},n=function(a){a=a.toLowerCase();return"public-holiday"===a||"publicholiday"===a||"\u795d\u65e5"===a},x=b.calendar(e,p),F={sunday:0,sun:0,"\u65e5\u66dc\u65e5":0,
monday:1,mon:1,"\u6708\u66dc\u65e5":1,tuesday:2,tue:2,"\u706b\u66dc\u65e5":2,wednesday:3,wed:3,"\u6c34\u66dc\u65e5":3,thursday:4,thu:4,"\u6728\u66dc\u65e5":4,friday:5,fri:5,"\u91d1\u66dc\u65e5":5,saturday:6,sat:6,"\u571f\u66dc\u65e5":6},q={january:0,jan:0,"\u7766\u6708":0,february:1,feb:1,"\u5982\u6708":1,march:2,mar:2,"\u5f25\u751f":2,april:3,apr:3,"\u536f\u6708":3,may:4,"\u7690\u6708":4,june:5,jun:5,"\u6c34\u7121\u6708":5,july:6,jul:6,"\u6587\u6708":6,august:7,aug:7,"\u8449\u6708":7,september:8,
sep:8,"\u9577\u6708":8,october:9,oct:9,"\u795e\u7121\u6708":9,november:10,nov:10,"\u971c\u6708":10,december:11,dec:11,"\u5e2b\u8d70":11};if(A[e-1950])if(A[e-1950][p]){if(A[e-1950][p][d])return a.clone(A[e-1950][p][d])}else A[e-1950][p]={};else A[e-1950]=[],A[e-1950][p]={};var l=d.split(":")[0],g=d.split(":").slice(1).join(":"),m=[],I=[],t=[],B=[],u,y,G,z,C=[];if("not"===l)if(m=v(),n(g)){g=h(0,e,p);n=0;for(C=g.length;n<C;n++)g[n]=g[n].date;m=a.difference(m,g);A[e-1950][p][d]=a.clone(m)}else if(0===
g.indexOf("year")||0===g.indexOf("month")||0===g.indexOf("date")||0===g.indexOf("day"))g=g.replace(/=/,":"),m=a.difference(v(),w(g,e,p));else{var E=g.split("=")[0],D=g.replace(/^.+?=/,""),D=D.replace(/^"(.+)"$/,"$1");a.each(k,function(b){if(b[E]===D||0===b[E].indexOf("[mes]")&&b[E].slice(5)===D)m=a.without(m,b.date)})}else if("is"===l){m=v();if(n(g)){g=h(0,e,p);n=0;for(C=g.length;n<C;n++)g[n]=g[n].date;m=a.intersection(m,g)}else{if("last"===g)return d=[31,28,31,30,31,30,31,31,30,31,30,31][p],M(e)&&
1===p&&(d=29),[d];throw f("unexpected a value of a yesterday selector."+g);}A[e-1950][p][d]=a.clone(m)}else if("yesterday"===l){m=v();C=g.split(":")[0];g.split(":").slice(1).join(":");if(n(g))m=a.intersection(m,a.map(w("is:"+g,e,p),function(a){return a+1})),A[e-1950][p][d]=a.clone(m);else if("day"===C||"date"===C)m=a.intersection(v(),a.map(w(g,e,p),function(a){return a+1}));else throw f("unexpected a value of a yesterday selector."+g);A[e-1950][p][d]=a.clone(m)}else if("range"===l)if(".."===g.slice(0,
2))g="..."===g.slice(0,3)?g.slice(3):g.slice(2),m=v(),g=g.split("/"),g=a.map(g,r),y=new Date(g[0],g[1]-1,g[2]),y.getFullYear()<e||y.getFullYear()==e&&y.getMonth()<p?m=[]:y.getFullYear()==e&&y.getMonth()==p?(m=v(),m=a.filter(m,function(a){return a<=y.getDate()})):m=v();else if(".."===g.slice(-2))g="..."===g.slice(-3)?g.slice(0,-3):g.slice(0,-2),g=g.split("/"),g=a.map(g,r),u=new Date(g[0],g[1]-1,g[2]),u.getFullYear()>e||u.getFullYear()==e&&u.getMonth()>p?m=[]:u.getFullYear()==e&&u.getMonth()==p?(m=
v(),m=a.filter(m,function(a){return a>=u.getDate()})):m=v();else if(-1!==g.indexOf(".."))m=[],g=g.split("..."),1===g.length&&(g=g[0].split("..")),I=[],t=[],B=[],u=g[0],y=g[1],G=y.substr(y.length-4,4),z=y.substr(y.length-5,5),C=[],u=u.split("/"),u=a.map(u,r),3===u.length?(g=new Date(u[0],u[1]-1,u[2]),C.push(g)):2===u.length&&(g=new Date(e-1,u[0]-1,u[1]),C.push(g,new Date(e,u[0]-1,u[1]))),a.each(C,function(b){b.getFullYear()>e||b.getFullYear()==e&&b.getMonth()>p?I=[]:b.getFullYear()==e&&b.getMonth()==
p?(I=v(),I=a.filter(I,function(a){return a>=b.getDate()})):I=v();B.push(I)}),C=a.zip(C,B),a.each(C,function(b){var d=b[0];b=b[1];var c;if("date"===G||"week"===G||"year"===G||"dates"===z||"weeks"===z||"years"===z){var f;f="date"===G||"week"===G||"year"===G?r(y.substring(0,y.length-4)):r(y.substring(0,y.length-5));c=new Date(d.getTime());"date"===G||"dates"===z?c.setDate(c.getDate()+f):"week"===G||"weeks"===z?c.setDate(c.getDate()+7*f):"year"!==G&&"years"!==z||c.setFullYear(c.getFullYear()+f)}else c=
y.split("/"),c=a.map(c,r),3===c.length?c=new Date(c[0],c[1]-1,c[2]):(c=new Date(d.getFullYear(),c[0]-1,c[1]),c.getTime()<d.getTime()&&c.setFullYear(c.getFullYear()+1));c.getFullYear()<e||c.getFullYear()==e&&c.getMonth()<p?t=[]:c.getFullYear()==e&&c.getMonth()==p?(t=v(),t=a.filter(t,function(a){return a<=c.getDate()})):t=v();a.isEmpty(a.intersection(b,t))||(m=a.intersection(b,t))});else throw f('invalid selector "'+l+":"+g+'" in '+c[groupID].name+".");else if("date"===l)m[m.length]=r(g);else if("month"===
l)m=!q[g.toLowerCase()]&&r(g)!==p+1||q[g.toLowerCase()]&&q[g.toLowerCase()]!=p?[]:v();else if("day"===l)if(g.match(/^\d/))g=g.toLowerCase().match(/^(\d+)(?:st|[nr]d|th)-?(.+)$/),n=r(g[1]),m=[(w("day:"+g[2],e,p)||[])[n-1]];else if("last"===g.slice(0,4).toLowerCase()){var g=g.toLowerCase(),J=g.slice(4);"-"===J.charAt(0)&&(J=J.slice(1));m=[a.last(w("day:"+J,e,p))]}else J=F[g.toLowerCase()],a.some(x,function(a){""!==a[J]&&(m[m.length]=a[J])});else if("year"===l)m="leap-year"===g||"leap_year"===g||"\u3046\u308b\u3046\u5e74"===
g||"\u958f\u5e74"===g?M(e)?v():[]:r(g)!==e?[]:v();else throw f('undefined key "'+l+'".');for(;64===m[m.length-1];)m.pop();"day"===l&&(A[e-1950][p][d]=a.clone(m));return m}if(""===d)throw f("cannot exec empty selector.");d=t(z(d));n=n||[];var x=[];a.each(d,function(b){if(1===b[1])x[x.length]=w(b[0],e,k,n);else if(0===b[1])if("&&"===b[0])x.push(a.intersection(x.pop(),x.pop()));else if("||"===b[0])x.push(a.union(x.pop(),x.pop()));else throw f("undefined operator "+b[0]);});if(1!=x.length)throw console.log(x,
d),f("unexpected error in execSelectors().");return x.pop()}function z(a){function b(a){""!==a[0]&&(c[c.length]=a)}if(E[a])return E[a];for(var c=[],d=!1,f=0,e=0,h=a.length;e<h;e++){var k=a.charAt(e);if(d)'"'===k?d=!1:"\\"===k&&(e+=1);else if('"'===k)d=!0;else if(" "===k)b([a.substring(f,e),1]),k=a.substr(e).match(/^ (?:and|&&|\u304b\u3064|or|\|\||\u307e\u305f\u306f) |^ /)[0],b([{" ":"&&"," and ":"&&"," \u304b\u3064 ":"&&"," && ":"&&"," or ":"||"," \u307e\u305f\u306f ":"||"," || ":"||"}[k],0]),f=e+
k.length,e+=k.length;else if("("===k||")"===k)b([a.substring(f,e),1]),b([k,"("===k?2:3]),f=e+1}""!==a.substring(f)&&b([a.substring(f),1]);return E[a]=c}function t(a){for(var b=[],c=[],d={"||":0,"&&":1},e=0,h=a.length;e<h;e++)if(1===a[e][1])c[c.length]=a[e].concat();else if(0===a[e][1]){var k=a[e][0];b[b.length-1]&&d[k]<=d[b[b.length-1][0]]&&(c[c.length]=b.pop());b[b.length]=a[e]}else if(2===a[e][1])b[b.length]=a[e];else if(3===a[e][1]){for(;2!=b[b.length-1][1];)if(c[c.length]=b.pop(),0===b.length)throw f("found mismatched parentheses");
b.pop()}for(;0<b.length;){if(2===b[b.length-1][1])throw f("found mismatched parentheses.");c[c.length]=b.pop()}return c}var A=[],E={},k=[],B="",D=-1,K=-1;return{eventCalendar:function(c){var e=[],f=[],n=a.difference(d.following,d.hiddenGroup);if(b.year!==D||b.month!==K)D=b.year,K=b.month,k=[];else if(n.join(",")!==B||d.updated||a.any(n,function(a){return!0===a.updated}))k=[],B=n.join(",");else return k[c]||[];for(var l=0,q=n.length;l<q;l++)e[e.length]=h(n[l],b.year,b.month);d.isHiddenGroup(-1)||(e[e.length]=
h("private",b.year,b.month));l=0;for(q=e.length;l<q;l++)for(var r=0,t=e[l].length;r<t;r++){var p=e[l][r].date;f[p]||(f[p]=[]);f[p][f[p].length]=e[l][r].id+":"+e[l][r].group+":"+e[l][r].type}k=a.clone(f);B=n.join(",");return k[c]||[]},splitSelector:z,execSelectors:l}}]).run(["calendar","$timeout",function(a,c){function d(){var b=new Date;b.setDate(b.getDate()+1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);var h=new Date;a.today.year=h.getFullYear();a.today.month=h.getMonth();
a.today.date=h.getDate();c(d,b-new Date)}var b=new Date;b.setDate(b.getDate()+1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);c(d,b-new Date)}])})(window);
