'use strict';(function(M,D){function E(a,e){return a-e}function k(a){return parseInt(a,10)}function L(a){a.replace(/[\uff21-\uff3a\uff41-\uff5a\uff10-\uff19]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})}var F=0<navigator.userAgent.indexOf("iPhone")&&-1==navigator.userAgent.indexOf("iPad")||0<navigator.userAgent.indexOf("iPod")||0<navigator.userAgent.indexOf("Android");angular.module("rabbit",["ngTouch","ngAnimate","ngMaterial","ngMessages"]).controller("mainCtrl",["$scope","_",
"calF","eventCal","mode","$mdSidenav",function(a,e,c,b,f,g){a._=e;a.mode=f;f.editsEventForm=!1;f.editsGroupForm=!1;a.splitSelector=b.splitSelector;a.openNav=function(){g("left").toggle()};c.selected=c.date;a.eventCalendar=b.eventCalendar}]).config(["$httpProvider",function(a){a.defaults.transformRequest=function(a){if(a===D)return a;if(angular.isObject(a)){var c=[],b;for(b in a)if(a.hasOwnProperty(b)){var f=a[b];c[c.length]=encodeURIComponent(b)+"="+encodeURIComponent(null==f?"":f)}a=c.join("&").replace(/%20/g,
"+")}else a=null==a?"":a.toString();return a};a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]).filter("format",["group","user",function(a,e){return function(c,b){c=c.split(":");var f="",f="private"==c[1]?e["private"][c[2]][c[0]].name:0===k(c[1])&&-1===k(c[0])?"[mes]\u632f\u66ff\u4f11\u65e5":a[c[1]][c[2]][c[0]].name;!1!==b&&0===f.indexOf("[mes]")&&(f=f.replace(/^\[mes\]/,""));return f}}]).run(["_","db","group","$rootScope",function(a,e,c,b){var f=a.clone(c)[0];localStorage&&
localStorage.getItem("group")&&(c.length=0,Array.prototype.push.apply(c,angular.fromJson(localStorage.getItem("group"))),c[0]=a.clone(f));e.list().then(function(g){g=g.data;for(var d=0,l=g.length;d<l;d++){for(var w in g[d])g[d][w]=angular.fromJson(g[d][w]);g[d].updated=!0}g.sort(function(a,b){return a.id-b.id});d=c.length=0;for(l=g.length;d<l;d++)c[g[d].id]=g[d];c[0]=a.clone(f);b.$broadcast("updated");localStorage.setItem("group",angular.toJson(c));e.getNameList().then(function(b){for(var d=0,e=b.data[0].length;d<
e;d++)c[d]||(c[d]={name:angular.fromJson(b.data[0][d])},b.data[1][d]&&(c[d].parents=angular.fromJson(b.data[1][d])));c[0]=a.clone(f);localStorage.setItem("group",angular.toJson(c))})})}]).directive("appDate",[function(){return{scope:{row:"=appRow"},restrict:"A",template:'<span class="date" ng-transclude></span>',transclude:!0,replace:!0,controller:["$scope","calF","eventCal","$filter",function(a,e,c,b){a.calendar=e;a.bookedClass=function(a){a=c.eventCalendar(a);for(var e=0,d=0,l=a.length;d<l;d++)0!==
b("format")(a[d],!1).indexOf("[mes]")&&e++;return 5>e?"booked-"+e:"booked-5"};a.dateClass=function(b){if(0!==b&&32!==b){var c=a.calendar,d=[];c.selected===b&&(d[d.length]="selected");d[d.length]=a.bookedClass(b);b===c.today.date&&c.month===c.today.month&&c.year===c.today.year&&(d[d.length]="today");return d}return[]}}],link:function(a,e,c){function b(){e.removeClass("selected booked-0 booked-1 booked-2 booked-3 booked-4 booked-5 today");e.addClass(a.dateClass(f).join(" "))}var f=a.row[c.appDate];
""!==f&&f!==D&&(a.$on("updated",b),b(),e.on("mouseenter",function(){!a.calendar.disableHoverEvent&&f&&(a.calendar.selected=f,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),b(),a.$apply())}),e.on("mouseleave",function(){a.calendar.disableHoverEvent||(a.calendar.selected=null,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),a.$apply())}),e.on("click",function(){F||(a.calendar.disableHoverEvent=a.calendar.selected===f?!a.calendar.disableHoverEvent:
!0);a.calendar.selected=f;angular.element(document.querySelectorAll(".selected")).removeClass("selected");b();a.$apply()}))}}}]);angular.module("rabbit").controller("calendarCtrl",["$scope","calF","mode",function(a,e,c){a.calF=e;a.nextMonth=function(){a.calF.month++;a.calF.selected=null;12<a.calF.month+1&&(a.calF.year+=1,a.calF.month-=12);c.editsEventForm=!1};a.lastMonth=function(){a.calF.month--;a.calF.selected=null;1>a.calF.month+1&&(1950>a.calF.year-1?(alert("1950\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"),
a.calF.month+=1):(a.calF.month+=12,--a.calF.year));c.editsEventForm=!1};a.nextYear=function(){a.calF.year++;a.calF.selected=null;c.editsEventForm=!1};a.lastYear=function(){1950>a.calF.year-1?alert("1950\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"):(a.calF.year--,a.calF.selected=null);c.editsEventForm=!1};a.dates="\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")}]);angular.module("rabbit").controller("eventEditorCtrl",
["$scope","group","user","eventForm","calF","db","mode","$mdToast",function(a,e,c,b,f,g,d,l){function w(b){"private"===b?c.save():g.post(a.group[b],b,"update")}var m=[],q=[];a.mode=d;a.group=e;a.user=c;a.eventForm=b;a.calF=f;a.ruleWriterFase="";a.ruleInput="";a.eventEditor={rules:"",selectedGroup:""};a.ruleGuide={day:[[":sun","\u65e5\u66dc\u65e5"],[":mon","\u6708\u66dc\u65e5"],[":tue","\u706b\u66dc\u65e5"],[":wed","\u6c34\u66dc\u65e5"],[":thu","\u6728\u66dc\u65e5"],[":fri","\u91d1\u66dc\u65e5"],[":sat",
"\u571f\u66dc\u65e5"]],month:[[":1","1\u6708"],[":2","2\u6708"],[":3","3\u6708"],[":4","4\u6708"],[":5","5\u6708"],[":6","6\u6708"],[":7","7\u6708"],[":8","8\u6708"],[":9","9\u6708"],[":10","10\u6708"],[":11","11\u6708"],[":12","12\u6708"]],selector:[["month","\u4f55\u6708"],["date","\u4f55\u65e5"],["day","\u4f55\u66dc\u65e5"],["not","\u9664\u304f"],["range","\u7bc4\u56f2"]]};a.addEvent=function(){var c=a.eventForm.type;if(""!==b.name&&b.selectedGroup!==D&&null!==b.selectedGroup){var e=new Date(b.year,
b.month-1,b.date);if(e.getFullYear()===k(b.year)&&e.getMonth()===k(b.month)-1&&e.getDate()===k(b.date)){if("event"==c)var u={year:b.year,month:b.month-1,date:b.date,name:b.name};else"habit"==c&&(u={selector:b.rule,name:b.name});"private"===b.selectedGroup?(a.user["private"][c][a.user["private"][c].length]=u,a.user.updated=!0):null!==b.selectedGroup&&(a.group[b.selectedGroup][c][a.group[b.selectedGroup][c].length]=u,a.group[b.selectedGroup].updated=!0);l.show(l.simple().content("\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));
d.editsEventForm=!1;w(b.selectedGroup)}}};a.saveEvent=function(){var c=b.type;if(null!==b.year&&null!==b.month&&null!==b.date&&""!==b.name){var e=new Date(b.year,b.month-1,b.date);if(e.getFullYear()===k(b.year)&&e.getMonth()===k(b.month)-1&&e.getDate()===k(b.date)){if("private"===b.selectedGroup)var u=a.user["private"][c][b.id];else null!==b.selectedGroup&&(u=a.group[b.selectedGroup][c][b.id],a.group[b.selectedGroup].updated=!0);"event"==c?(u.year=b.year,u.month=b.month-1,u.date=b.date,u.name=b.name):
"habit"==c&&(u.selector=b.rule,u.name=b.name);d.editsEventForm=!1;w(b.selectedGroup)}}};a.cancel=function(){d.editsEventForm=!1};a.goFase=function(c,d){m[m.length]=a.ruleWriterFase;q[q.length]=d||c;a.ruleWriterFase=c;b.rule=q.join("")};a.cancelFase=function(){a.ruleWriterFase=m.pop();q.pop();b.rule=q.join("")};a.finishWritingRule=function(){a.ruleWriterFase="";m=[];b.rule=q.join("");q=[]};a.startWritingRule=function(){a.ruleWriterFase="selector";m=[];q=[]}}]);angular.module("rabbit").controller("groupEditorCtrl",
["$scope","group","groupForm","db","$mdToast","mode",function(a,e,c,b,f,g){a.groupForm=c;a.groupForm.parentGroup=[null];a.groupForm.mode="add";a.group=e;a.finishMakingAGroup=function(){g.editsGroupForm=!1};a.addGroup=function(){var c=a.groupForm.parentGroup.reduce(function(a,b){-1===a.indexOf(b)&&(a[a.length]=angular.isNumber(b)?k(b):"");return a},[]),g={event:[],habit:[],name:a.groupForm.name,updated:!0};""!==c.join("")&&(g.parents=c);e[e.length]=g;b.post(g,a.group.length-1,"insert").success(a.finishMakingAGroup);
f.show(f.simple().content("\u30b0\u30eb\u30fc\u30d7 "+a.groupForm.name+" \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));a.groupForm.name=""}}]);angular.module("rabbit").controller("detailCtrl",["$scope","eventCal","calF","mode",function(a,e,c,b){a.mode=b;a.calF=c;a.eventCalendar=e.eventCalendar;a.isToday=function(){return c.selected===c.today.date&&c.month===c.today.month&&c.year===c.today.year}}]);angular.module("rabbit").controller("settingCtrl",["$scope","_",
"group","user","db","eventListToEdit","groupForm","mode","$mdSidenav","$mdToast","$mdDialog",function(a,e,c,b,f,g,d,l,k,m,q){function C(b){return-1!==a.user.following.indexOf(b)}function A(a){if(!c[a].parents)return[];for(var b=c[a].parents,d=0,e=c[a].parents.length;d<e;d++)b=A(c[a].parents[d]).concat(b);return b}a.group=c;a.user=b;a.groupForm=d;a.search_keyword="";a.searchResult=[];a.hide=function(a){b.hiddenGroup[b.hiddenGroup.length]=a;b.hiddenGroup.sort(E);b.save()};a.show=function(c){b.hiddenGroup=
e.without(a.user.hiddenGroup,c);b.save()};a.followsParent=function(a){a=A(a);for(var b=0,c=a.length;b<c;b++)if(!C(a[b]))return a[b];return!0};a.toggleNav=function(){k("left").close()};a.follows=C;a.follow=function(d){a.user.following[a.user.following.length]=d;a.user.following.sort(E);b.save();m.show(m.simple().content(c[d].name+"\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3))};a.unfollow=function(d){var e=[];e[e.length]=a.user.following.indexOf(d);for(var f=
0,g=a.user.following.length;f<g;f++)if(c[a.user.following[f]].parents&&-1!=A(a.user.following[f]).indexOf(d)){if(!confirm("\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u306e\u5b50\u30b0\u30eb\u30fc\u30d7("+c[a.user.following[f]].name+")\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u30d5\u30a9\u30ed\u30fc\u89e3\u9664\u3059\u308b\u3068\u3053\u3061\u3089\u3082\u89e3\u9664\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b?"))return;
e[e.length]=f}e.sort(function(a,b){return b-a});f=0;for(g=e.length;f<g;f++)a.user.following.splice(e[f],1);b.save()};a.showEventList=function(a){g.id=a;l.showsEventList=!0};a.makeAGroup=function(){d.isEditMode=!0;k("left").close()};a.search=function(){var b=[];if(""==a.search_keyword||!c)return b;for(var d=0,e=c.length;d<e&&!(30<b.length);d++)c[d]&&c[d].name&&-1!==c[d].name.indexOf(a.search_keyword)&&(b[b.length]=d);a.searchResult=b};a.randomSearch=function(){var b=[];if(5>c.length)Array.prototype.push.apply(b,
c);else for(;5>b.length;){var d=Math.random()*c.length|0;-1===e.indexOf(b,d)&&(b[b.length]=d)}a.searchResult=b};a.hideAll=function(){b.hiddenGroup.length=0;b.hiddenGroup=e.clone(b.following);b.hiddenGroup[b.hiddenGroup.length]=-1;b.hiddenGroup.sort(E);b.save()};a.showAll=function(){b.hiddenGroup=[];b.save()};a.importSetting=function(){q.show({controller:["$scope","$mdDialog",function(a,b){a.text="";a.answer=function(a){b.hide(a)}}],template:'<md-dialog><md-content>\u30b3\u30d4\u30fc\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002<br><input ng-model="text"><md-button ng-click="answer(text)">ok</md-button></md-content></md-dialog>'}).then(function(a){a=
JSON.parse(a);for(var c in a)b[c]=a[c];b.save()})};a.exportSetting=function(){q.show(q.alert().title("").content("\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u79fb\u884c\u5148\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002"+angular.toJson(b)).ok("ok"))}}]);angular.module("rabbit").controller("eventListCtrl",["$scope","group","user","eventListToEdit","eventForm","mode",function(a,e,c,b,f,g){a.eventListToEdit=b;a.group=e;a.user=c;"private"!==b.id&&""!==b.id?(a.habitList=e[b.id].habit,
a.eventList=e[b.id].event):(a.habitList=c["private"].habit,a.eventList=c["private"].event);a.mode=g}]);angular.module("rabbit").factory("_",function(){return _}).factory("user",["_","$rootScope",function(a,e){if(localStorage&&angular.fromJson(localStorage.getItem("private"))){var c=angular.fromJson(localStorage.getItem("private"));c.isHiddenGroup=function(b){return-1!==a.indexOf(this.hiddenGroup,b,!0)};c.save=function(){e.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))};
c.updated=!0}else c={following:[],"private":{event:[],habit:[],name:"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8"},hiddenGroup:[],isHiddenGroup:function(b){return-1!==a.indexOf(this.hiddenGroup,b,!0)},save:function(){e.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))}};c.save();return c}]).factory("eventForm",function(){return{name:"",year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),type:"event",rule:""}}).factory("groupForm",function(){return{name:""}}).factory("group",
["$http",function(a){return[{id:0,event:[{name:"[mes]\u6625\u5206\u306e\u65e5",year:2E3,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2E3,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2001,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2001,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2002,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2002,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2003,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2003,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2004,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2004,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2005,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2005,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2006,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2006,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2007,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2007,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2008,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2008,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2009,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2009,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2010,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2010,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2011,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2011,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2012,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2012,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2013,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2013,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2014,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2014,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2015,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2015,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2016,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2016,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2017,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2017,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2018,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2018,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2019,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2019,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2020,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2020,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2021,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2021,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2022,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2022,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2023,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2023,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2024,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2024,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2025,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2025,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2026,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2026,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2027,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2027,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2028,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2028,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2029,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2029,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2030,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2030,month:8,date:23},{name:"[mes]\u5341\u4e94\u591c",year:2E3,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",
year:2001,month:9,date:1},{name:"[mes]\u5341\u4e94\u591c",year:2002,month:8,date:21},{name:"[mes]\u5341\u4e94\u591c",year:2003,month:8,date:11},{name:"[mes]\u5341\u4e94\u591c",year:2004,month:8,date:28},{name:"[mes]\u5341\u4e94\u591c",year:2005,month:8,date:18},{name:"[mes]\u5341\u4e94\u591c",year:2006,month:9,date:6},{name:"[mes]\u5341\u4e94\u591c",year:2007,month:8,date:25},{name:"[mes]\u5341\u4e94\u591c",year:2008,month:8,date:14},{name:"[mes]\u5341\u4e94\u591c",year:2009,month:9,date:3},{name:"[mes]\u5341\u4e94\u591c",
year:2010,month:8,date:22},{name:"[mes]\u5341\u4e94\u591c",year:2011,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2012,month:8,date:30},{name:"[mes]\u5341\u4e94\u591c",year:2013,month:8,date:19},{name:"[mes]\u5341\u4e94\u591c",year:2014,month:8,date:8},{name:"[mes]\u5341\u4e94\u591c",year:2015,month:8,date:27},{name:"[mes]\u5341\u4e94\u591c",year:2016,month:8,date:15}],habit:[{name:"[mes]\u5143\u65e6",selector:"month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"month:1 day:2nd-mon"},
{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"month:4 date:29"},{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u65e5",selector:"month:2 date:11"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"month:5 date:4"},{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",selector:"month:5 date:5"},{name:"[mes]\u6d77\u306e\u65e5",selector:"month:7 day:3rd-mon"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"month:9 day:3rd-mon"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",
selector:"month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",selector:"month:11 date:3"},{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"month:12 date:23"}],name:"\u795d\u65e5",updated:!0}]}]).factory("calF",function(){var a=new Date,e=[];return{year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),calendar:function(a,b){if(e[a-1950]){if(e[a-1950][b])return e[a-1950][b]}else e[a-1950]=[];var f=(new Date(a,
b,1)).getDay(),g=[31,28,31,30,31,30,31,31,30,31,30,31][b];1===b&&(0==a%400||0!=a%100&&0==a%4)&&(g=29);var d=[];d.year=a;d.month=b;var l=0;for(;;){d[l]=[];for(var k=1;7>=k;k++)d[l][d[l].length]=0<7*l+k-f?7*l+k-f<=g?7*l+k-f:32:0;if(d[l][d[l].length-1]>=g)break;l++}return e[a-1950][b]=d},today:{year:a.getFullYear(),month:a.getMonth(),date:a.getDate()},selected:a.getDate(),selectedDay:function(){return null==this.selected?"":"\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")[(new Date(this.year,this.month,
this.selected)).getDay()]},disableHoverEvent:F}}).factory("eventListToEdit",function(){return{id:""}}).factory("error",["$mdToast",function(a){var e=e||Error;return function(c){a.show(a.simple().content(c).position("top right").hideDelay(3E3));return new e(c)}}]).factory("mode",["_","eventForm","$mdSidenav","user","group",function(a,e,c,b,f){return{editsEventForm:!1,editsGroupForm:!1,showsEventList:!1,switchToEdit:function(){var g=Array.prototype.slice.call(arguments);if(1===g.length||2===g.length&&
!0===g[1]){var d=g[0];e.mode=1===g.length?"edit":"add";d=d.split(":");a.extend(e,{type:d[2],id:1===g.length?d[0]:0});e.selectedGroup="private"!==d[1]?k(d[1]):d[1];"event"===d[2]?(a.map(["year","month","date","name"],function(a){e[a]="private"===d[1]?b["private"].event[d[0]][a]:f[d[1]].event[d[0]][a]}),e.month+=1):"habit"===d[2]&&("private"===d[1]?(e.rule=b["private"].habit[d[0]].selector,e.name=b["private"].habit[d[0]].name):(e.rule=f[d[1]].habit[d[0]].selector,e.name=f[d[1]].habit[d[0]].name))}else 3===
g.length&&a.extend(e,{mode:"add",type:"event",rule:"",id:0,name:"",year:g[0],month:g[1]+1,date:g[2]});this.editsEventForm=!0;c("left").close()}}}]).factory("db",["_","group","user","$http","$rootScope","$log",function(a,e,c,b,f,g){return{post:function(c,e,k){c=a.clone(c);c.id=e;c.permission=c.permission||[];c.parents=c.parents||"";delete c.updated;for(var m in c)c[m]=L(angular.toJson(c[m]));c.type=k;f.$broadcast("updated");return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",c).success(function(a){g.log("updated");
g.log(a)}).error(function(a){g.log(a)})},list:function(){return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"list",groupID:c.following.join(",")}).success(function(a){return a}).error(function(a){g.log(a)})},getNameList:function(){return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"namelist"}).success(function(a){return a})}}}]).run(["calF","$timeout",function(a,e){function c(){var b=new Date;b.setDate(b.getDate()+1);b.setHours(0);b.setMinutes(0);
b.setSeconds(0);b.setMilliseconds(0);var g=new Date;a.today.year=g.getFullYear();a.today.month=g.getMonth();a.today.date=g.getDate();e(c,b-new Date)}var b=new Date;b.setDate(b.getDate()+1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);e(c,b-new Date)}]);angular.module("rabbit").factory("eventCal",["_","group","user","calF","error",function(a,e,c,b,f){function g(b,f,r){if("private"!==b&&!e[b])return[];var p=[],B=[];"private"===b?(a.each(c.following,function(a){B=B.concat(g(a,f,
r))}),p=p.concat(d(c["private"].event,f,r,"private")),B=B.concat(p),p=p.concat(l(c["private"].habit,f,r,"private",B)),c.updated=!1):(e[b].parents&&a.each(e[b].parents,function(a){B=B.concat(g(a,f,r))}),p=p.concat(d(e[b].event,f,r,b)),B=B.concat(p),p=p.concat(l(e[b].habit,f,r,b,B)),e[b].updated=!1);if(0===b){var z=a.map(p,function(a){return a.date});b=a.intersection(z,w(m("day:sun"),f,r,[]));p.push.apply(p,a.map(b,function(b){for(var c=1;-1!==a.indexOf(z,b+c,!0);)c+=1;return{year:f,month:r,date:b+
c,name:"[mes]\u632f\u66ff\u4f11\u65e5",group:0,id:-1,type:"habit"}}));p.sort()}return p}function d(b,c,e,d){var f=[];if(!b)return f;for(var g=0,k=b.length;g<k;g++)if(b[g].year===c&&b[g].month===e){var I=a.clone(b[g]);I.group=d;I.type="event";I.id=g;f[f.length]=I}return f}function l(b,c,e,d,f){if(!b)return[];for(var g=[],k=0,I=b.length;k<I;k++){b[k].type="habit";b[k].group=d;var K=w(m(b[k].selector),c,e,f);a.each(K,function(a,f){K[f]={year:c,month:e,date:a,name:b[k].name,group:d,id:k,type:"habit"}});
g=g.concat(K)}return g}function w(c,d,r,p){function B(c,d,t,z){var r=function(){return a.clone(l)},p=b.calendar(d,t),y={sunday:0,sun:0,"\u65e5\u66dc\u65e5":0,monday:1,mon:1,"\u6708\u66dc\u65e5":1,tuesday:2,tue:2,"\u706b\u66dc\u65e5":2,wednesday:3,wed:3,"\u6c34\u66dc\u65e5":3,thursday:4,thu:4,"\u6728\u66dc\u65e5":4,friday:5,fri:5,"\u91d1\u66dc\u65e5":5,saturday:6,sat:6,"\u571f\u66dc\u65e5":6},u={January:0,Jan:0,"\u7766\u6708":0,February:1,Feb:1,"\u5982\u6708":1,March:2,Mar:2,"\u5f25\u751f":2,April:3,
Apr:3,"\u536f\u6708":3,May:4,"\u7690\u6708":4,June:5,Jun:5,"\u6c34\u7121\u6708":5,July:6,Jul:6,"\u6587\u6708":6,August:7,Aug:7,"\u8449\u6708":7,September:8,Sep:8,"\u9577\u6708":8,October:9,Oct:9,"\u795e\u7121\u6708":9,November:10,Nov:10,"\u971c\u6708":10,December:11,Dec:11,"\u5e2b\u8d70":11};if(C[d-1950])if(C[d-1950][t]){if(C[d-1950][t][c])return a.clone(C[d-1950][t][c])}else C[d-1950][t]={};else C[d-1950]=[],C[d-1950][t]={};var m=c.split(":")[0],h=c.split(":").slice(1).join(":"),n=[],q=[],w=[],D=
[],v,x,G,A,H=[];if("not"===m)if(n=r(),"public-holiday"===h||"\u795d\u65e5"===h){p=g(0,d,t);y=0;for(h=p.length;y<h;y++)p[y]=p[y].date;n=a.difference(n,p);C[d-1950][t][c]=a.clone(n)}else if(0===h.indexOf("year")||0===h.indexOf("month")||0===h.indexOf("date")||0===h.indexOf("day"))h=h.replace(/=/,":"),n=a.difference(r(),B(h,d,t));else{var E=h.split("=")[0],F=h.replace(/^.+?=/,""),F=F.replace(/^"(.+)"$/,"$1");a.each(z,function(b){if(b[E]===F||0===b[E].indexOf("[mes]")&&b[E].slice(5)===F)n=a.without(n,
b.date)})}else if("is"!==m)if("yesterday"===m)if(n=r(),"public-holiday"===h||"\u795d\u65e5"===h){p=g(0,d,t);y=0;for(h=p.length;y<h;y++)p[y]=p[y].date+1;n=a.intersection(n,p);C[d-1950][t][c]=a.clone(n)}else if("day"===m||"date"===m)n=a.intersection(r(),a.map(B(h,d,t),function(a){return a+1}));else throw f("unexpected a value of a yesterday selector."+h);else if("range"===m)if(".."===h.slice(0,2))h="..."===h.slice(0,3)?h.slice(3):h.slice(2),n=r(),h=h.split("/"),h=a.map(h,k),x=new Date(h[0],h[1]-1,h[2]),
x.getFullYear()<d||x.getFullYear()==d&&x.getMonth()<t?n=[]:x.getFullYear()==d&&x.getMonth()==t?(n=r(),n=a.filter(n,function(a){return a<=x.getDate()})):n=r();else if(".."===h.slice(-2))h="..."===h.slice(-3)?h.slice(0,-3):h.slice(0,-2),h=h.split("/"),h=a.map(h,k),v=new Date(h[0],h[1]-1,h[2]),v.getFullYear()>d||v.getFullYear()==d&&v.getMonth()>t?n=[]:v.getFullYear()==d&&v.getMonth()==t?(n=r(),n=a.filter(n,function(a){return a>=v.getDate()})):n=r();else if(-1!==h.indexOf(".."))n=[],h=h.split("..."),
1===h.length&&(h=h[0].split("..")),q=[],w=[],D=[],v=h[0],x=h[1],G=x.substr(x.length-4,4),A=x.substr(x.length-5,5),H=[],v=v.split("/"),v=a.map(v,k),3===v.length?(p=new Date(v[0],v[1]-1,v[2]),H.push(p)):2===v.length&&(p=new Date(d-1,v[0]-1,v[1]),H.push(p,new Date(d,v[0]-1,v[1]))),a.each(H,function(b){b.getFullYear()>d||b.getFullYear()==d&&b.getMonth()>t?q=[]:b.getFullYear()==d&&b.getMonth()==t?(q=r(),q=a.filter(q,function(a){return a>=b.getDate()})):q=r();D.push(q)}),H=a.zip(H,D),a.each(H,function(b){var c=
b[0];b=b[1];var e;if("date"===G||"week"===G||"year"===G||"dates"===A||"weeks"===A||"years"===A){var f;f="date"===G||"week"===G||"year"===G?k(x.substring(0,x.length-4)):k(x.substring(0,x.length-5));e=new Date(c.getTime());"date"===G||"dates"===A?e.setDate(e.getDate()+f):"week"===G||"weeks"===A?e.setDate(e.getDate()+7*f):"year"!==G&&"years"!==A||e.setFullYear(e.getFullYear()+f)}else e=x.split("/"),e=a.map(e,k),3===e.length?e=new Date(e[0],e[1]-1,e[2]):(e=new Date(c.getFullYear(),e[0]-1,e[1]),e.getTime()<
c.getTime()&&e.setFullYear(e.getFullYear()+1));e.getFullYear()<d||e.getFullYear()==d&&e.getMonth()<t?w=[]:e.getFullYear()==d&&e.getMonth()==t?(w=r(),w=a.filter(w,function(a){return a<=e.getDate()})):w=r();a.isEmpty(a.intersection(b,w))||(n=a.intersection(b,w))});else throw f('invalid selector "'+m+":"+h+'" in '+e[groupID].name+".");else if("date"===m)n[n.length]=k(h);else if("month"===m)if(!u[h]&&k(h)!=t+1||u[h]&&u[h]!=t)n=[];else{if(!u[h]&&k(h)==t+1||u[h]&&u[h]==t)n=r()}else if("day"===m)if(h.match(/^\d/)){for(var h=
h.match(/^(\d+)(?:st|nd|rd|th)-?(.+)$/),H=k(h[1]),J=y[h[2]],y=0;""===p[y][J];)y++;n[n.length]=p[y-1+H][J]}else J=y[h],a.some(p,function(a){""!==a[J]&&(n[n.length]=a[J])});else if("year"===m)n="leap-year"===h||"leap_year"===h||"\u3046\u308b\u3046\u5e74"===h||"\u958f\u5e74"===h?0===d%400||0===d%4&&0!==d%100?r():[]:k(h)!==d?[]:r();else throw f('undefined key "'+m+'".');"day"===m&&(C[d-1950][t][c]=a.clone(n));return n}var z=[],l=a.flatten(b.calendar(d,r));a.each(c,function(b){if(1===b[1])z[z.length]=
B(b[0],d,r,p);else if(0===b[1])if("&&"===b[0])z.push(a.intersection(z.pop(),z.pop()));else if("||"===b[0])z.push(a.union(z.pop(),z.pop()));else throw f("undefined operator "+b[0]);});if(1!=z.length)throw console.log(z,c),f("unexpected error in execSelectors().");return z.pop()}function m(a){function b(a){""!==a[0]&&(c[c.length]=a)}if(A[a])return A[a];for(var c=[],d=!1,e=0,f=0,g=a.length;f<g;f++){var k=a.charAt(f);if(d)'"'===k?d=!1:"\\"===k&&(f+=1);else if('"'===k)d=!0;else if(" "===k){b([a.substring(e,
f),1]);var k={" and ":"&&"," \u304b\u3064 ":"&&"," && ":"&&"," or ":"||"," \u307e\u305f\u306f ":"||"," || ":"||"},m=!1,l;a:for(l in k)if(a.substr(f,l.length)===l){b([k[l],0]);e=f+l.length;f+=l.length;m=!0;break a}m||(b(["&&",0]),e=f+1,f+=1)}else if("("===k||")"===k)b([a.substring(e,f),1]),b([k,"("===k?2:3]),e=f+1}""!==a.substring(e)&&b([a.substring(e),1]);return A[a]=q(c)}function q(a){for(var b=[],c=[],d={"||":0,"&&":1},e=0,g=a.length;e<g;e++)if(1===a[e][1])c[c.length]=a[e].concat();else if(0===
a[e][1]){var k=a[e][0];b[b.length-1]&&d[k]<=d[b[b.length-1][0]]&&(c[c.length]=b.pop());b[b.length]=a[e]}else if(2===a[e][1])b[b.length]=a[e];else if(3===a[e][1]){for(;2!=b[b.length-1][1];)if(c[c.length]=b.pop(),0===b.length)throw f("found mismatched parentheses");b.pop()}for(;0<b.length;){if(2===b[b.length-1][1])throw f("found mismatched parentheses.");c[c.length]=b.pop()}return c}var C=[],A={},u=[],D="",E=-1,F=-1;return{eventCalendar:function(e){var d=[],f=[],k=a.difference(c.following,c.hiddenGroup);
if(b.year!==E||b.month!==F)E=b.year,F=b.month,u=[];else if(k.join(",")!==D||a.any(k,function(a){return!0===a.updated})||c.updated)u=[],D=k.join(",");else return u[e]||[];for(var l=0,m=k.length;l<m;l++)d[d.length]=g(k[l],b.year,b.month);c.isHiddenGroup(-1)||(d[d.length]=g("private",b.year,b.month));l=0;for(m=d.length;l<m;l++)for(var q=0,w=d[l].length;q<w;q++)f[d[l][q].date]||(f[d[l][q].date]=[]),f[d[l][q].date][f[d[l][q].date].length]=d[l][q].id+":"+d[l][q].group+":"+d[l][q].type;u=a.clone(f);D=k.join(",");
return u[e]||[]},splitSelector:m}}])})(window);
