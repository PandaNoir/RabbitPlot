var appName="rabbit",MEMO_LIMIT=1950,QUOTATION=0,isSmartPhone=0<navigator.userAgent.indexOf("iPhone")&&-1==navigator.userAgent.indexOf("iPad")||0<navigator.userAgent.indexOf("iPod")||0<navigator.userAgent.indexOf("Android");
angular.module(appName,["ngTouch","ngAnimate","ngMaterial","ngMessages"]).controller("mainCtrl",["$scope","eventForm","calF","eventCal","eventListToEdit","mode","$timeout","$filter","$sce","$mdSidenav",function(a,c,d,b,e,f,g,h,m,q){a._=_;a.eventForm=c;a.calF=d;a.eventListToEdit=e;a.mode=f;f.editsEventForm=!1;f.editsGroupForm=!1;f.showsHowToWrite=!1;a.showHowToWrite=function(){f.showsHowToWrite=!f.showsHowToWrite};a.splitSelector=b.splitSelector;a.openNav=function(){q("left").toggle()};a.calF.selected=
a.calF.date;a.eventCalendar=b.eventCalendar}]).config(["$httpProvider",function(a){a.defaults.transformRequest=function(a){if(void 0===a)return a;if(angular.isObject(a)){var d=[],b;for(b in a)if(a.hasOwnProperty(b)){var e=a[b];d[d.length]=encodeURIComponent(b)+"="+encodeURIComponent(null==e?"":e)}a=d.join("&").replace(/%20/g,"+")}else a=null==a?"":a.toString();return a};a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]).filter("format",["group","user",function(a,c){return function(d,
b){d=d.split(":");var e="",e="private"==d[1]?c["private"][d[2]][d[0]].name:a[d[1]][d[2]][d[0]].name;!1!==b&&0===e.indexOf("[mes]")&&(e=e.replace(/^\[mes\]/,""));return e}}]).run(["db","group","$rootScope",function(a,c,d){var b={id:0,event:[{name:"[mes]\u6625\u5206\u306e\u65e5",year:2E3,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2E3,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2001,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2001,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2002,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2002,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2003,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2003,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2004,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2004,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2005,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2005,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2006,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2006,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2007,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2007,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2008,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2008,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2009,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2009,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2010,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2010,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2011,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2011,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2012,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2012,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2013,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2013,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2014,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2014,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2015,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2015,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2016,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2016,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2017,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2017,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2018,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2018,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2019,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2019,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2020,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2020,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2021,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2021,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2022,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2022,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2023,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2023,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2024,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2024,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2025,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2025,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2026,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2026,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2027,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2027,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2028,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2028,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2029,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2029,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2030,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2030,month:8,date:23},{name:"[mes]\u5341\u4e94\u591c",year:2E3,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2001,month:9,date:1},{name:"[mes]\u5341\u4e94\u591c",year:2002,month:8,date:21},{name:"[mes]\u5341\u4e94\u591c",year:2003,month:8,date:11},{name:"[mes]\u5341\u4e94\u591c",year:2004,month:8,date:28},{name:"[mes]\u5341\u4e94\u591c",year:2005,month:8,date:18},{name:"[mes]\u5341\u4e94\u591c",year:2006,month:9,date:6},
{name:"[mes]\u5341\u4e94\u591c",year:2007,month:8,date:25},{name:"[mes]\u5341\u4e94\u591c",year:2008,month:8,date:14},{name:"[mes]\u5341\u4e94\u591c",year:2009,month:9,date:3},{name:"[mes]\u5341\u4e94\u591c",year:2010,month:8,date:22},{name:"[mes]\u5341\u4e94\u591c",year:2011,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2012,month:8,date:30},{name:"[mes]\u5341\u4e94\u591c",year:2013,month:8,date:19},{name:"[mes]\u5341\u4e94\u591c",year:2014,month:8,date:8},{name:"[mes]\u5341\u4e94\u591c",
year:2015,month:8,date:27},{name:"[mes]\u5341\u4e94\u591c",year:2016,month:8,date:15}],habit:[{name:"[mes]\u5143\u65e6",selector:"month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"month:1 day:2nd-mon"},{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"month:4 date:29"},{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u65e5",selector:"month:2 date:11"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"month:5 date:4"},{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",
selector:"month:5 date:5"},{name:"[mes]\u6d77\u306e\u65e5",selector:"month:7 day:3rd-mon"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"month:9 day:3rd-mon"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",selector:"month:11 date:3"},{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"month:12 date:23"}],name:"\u795d\u65e5",updated:!0};localStorage&&localStorage.getItem("group")&&
(c.length=0,Array.prototype.push.apply(c,angular.fromJson(localStorage.getItem("group"))),c[0]=_.clone(b));a.list().then(function(e){e=e.data;for(var f=0,g=e.length;f<g;f++){for(var h in e[f])e[f][h]=angular.fromJson(e[f][h]);e[f].updated=!0}e.sort(function(a,b){return a.id-b.id});f=c.length=0;for(g=e.length;f<g;f++)c[e[f].id]=e[f];c[0]=_.clone(b);d.$broadcast("updated");localStorage.setItem("group",angular.toJson(c));a.getNameList().then(function(a){for(var d=0,e=a.data[0].length;d<e;d++)c[d]||(c[d]=
{name:angular.fromJson(a.data[0][d])},a.data[1][d]&&(c[d].parents=angular.fromJson(a.data[1][d])));c[0]=_.clone(b);localStorage.setItem("group",angular.toJson(c))})})}]).directive("appDate",[function(){return{scope:{row:"=appRow"},restrict:"A",template:'<span class="date" ng-transclude></span>',transclude:!0,replace:!0,controller:["$scope","calF","eventCal","$filter",function(a,c,d,b){a.calendar=c;a.bookedClass=function(a){a=d.eventCalendar(a);for(var c=0,g=0,h=a.length;g<h;g++)0!==b("format")(a[g],
!1).indexOf("[mes]")&&c++;return 5>c?"booked-"+c:"booked-5"};a.dateClass=function(b){if(0!==b&&32!==b){var c=a.calendar,d=[];c.selected===b&&(d[d.length]="selected");d[d.length]=a.bookedClass(b);b===c.today.date&&c.month===c.today.month&&c.year===c.today.year&&(d[d.length]="today");return d}return[]}}],link:function(a,c,d){var b=a.row[d.appDate];if(""!==b&&void 0!==b){var e=function(){c.removeClass("selected booked-0 booked-1 booked-2 booked-3 booked-4 booked-5 today");c.addClass(a.dateClass(b).join(" "))};
a.$on("updated",e);e();c.on("mouseenter",function(){!a.calendar.disableHoverEvent&&b&&(a.calendar.selected=b,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),e(),a.$apply())});c.on("mouseleave",function(){a.calendar.disableHoverEvent||(a.calendar.selected=null,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),a.$apply())});c.on("click",function(){isSmartPhone||(a.calendar.disableHoverEvent=a.calendar.selected===b?!a.calendar.disableHoverEvent:
!0);a.calendar.selected=b;angular.element(document.querySelectorAll(".selected")).removeClass("selected");e();a.$apply()})}}}}]);angular.module(appName).controller("calendarCtrl",["$scope","calF","mode",function(a,c,d){a.calF=c;a.nextMonth=function(){a.calF.month++;a.calF.selected=null;12<a.calF.month+1&&(a.calF.year+=1,a.calF.month-=12);d.editsEventForm=!1};a.lastMonth=function(){a.calF.month--;a.calF.selected=null;1>a.calF.month+1&&(a.calF.year-1<MEMO_LIMIT?(alert(MEMO_LIMIT+"\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"),
a.calF.month+=1):(a.calF.month+=12,--a.calF.year));d.editsEventForm=!1};a.nextYear=function(){a.calF.year++;a.calF.selected=null;d.editsEventForm=!1};a.lastYear=function(){a.calF.year-1<MEMO_LIMIT?alert(MEMO_LIMIT+"\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"):(a.calF.year--,a.calF.selected=null);d.editsEventForm=!1}}]);angular.module(appName).controller("eventEditorCtrl",["$scope","group","user","eventForm","calF","db","$mdToast","mode",function(a,c,d,b,e,f,g,h){function m(b){"private"===b?d.save():f.post(a.group[b],b,"update")}var q=[],p=[];a.mode=h;a.group=c;a.user=d;a.eventForm=b;a.calF=e;a.ruleWriterFase="";a.ruleInput="";a.eventEditor={rules:"",selectedGroup:""};a.addEvent=function(){var c=a.eventForm.type;if(""!==b.name&&void 0!==b.selectedGroup&&null!==b.selectedGroup){var d=new Date(b.year,b.month-1,b.date);
if(d.getFullYear()===parseInt(b.year,10)&&d.getMonth()===parseInt(b.month,10)-1&&d.getDate()===parseInt(b.date,10)){if("event"==c)var e={year:b.year,month:b.month-1,date:b.date,name:b.name};else"habit"==c&&(e={selector:b.rule,name:b.name});"private"===b.selectedGroup?(a.user["private"][c][a.user["private"][c].length]=e,a.user.updated=!0):null!==b.selectedGroup&&(a.group[b.selectedGroup][c][a.group[b.selectedGroup][c].length]=e,a.group[b.selectedGroup].updated=!0);g.show(g.simple().content("\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));
h.editsEventForm=!1;m(b.selectedGroup)}}};a.saveEvent=function(){var c=b.type;if(null!==b.year&&null!==b.month&&null!==b.date&&""!==b.name){var d=new Date(b.year,b.month-1,b.date);if(d.getFullYear()===parseInt(b.year,10)&&d.getMonth()===parseInt(b.month,10)-1&&d.getDate()===parseInt(b.date,10)){if("private"===b.selectedGroup)var e=a.user["private"][c][b.id];else null!==b.selectedGroup&&(e=a.group[b.selectedGroup][c][b.id],a.group[b.selectedGroup].updated=!0);"event"==c?(e.year=b.year,e.month=b.month-
1,e.date=b.date,e.name=b.name):"habit"==c&&(e.selector=b.rule,e.name=b.name);h.editsEventForm=!1;m(b.selectedGroup)}}};a.cancel=function(){h.editsEventForm=!1};a.goFase=function(c,d){q[q.length]=a.ruleWriterFase;p[p.length]=d||c;a.ruleWriterFase=c;b.rule=p.join("")};a.cancelFase=function(){a.ruleWriterFase=q.pop();p.pop();b.rule=p.join("")};a.finishWritingRule=function(){a.ruleWriterFase="";q=[];b.rule=p.join("");p=[]};a.startWritingRule=function(){a.ruleWriterFase="selector";q=[];p=[]}}]);angular.module(appName).controller("groupEditorCtrl",["$scope","group","groupForm","db","$mdToast","mode",function(a,c,d,b,e,f){a.groupForm=d;a.groupForm.parentGroup=[null];a.groupForm.mode="add";a.group=c;a.finishMakingAGroup=function(){f.editsGroupForm=!1};a.addGroup=function(){var d=a.groupForm.parentGroup.reduce(function(a,c){-1===a.indexOf(c)&&(a[a.length]=angular.isNumber(c)?parseInt(c,10):"");return a},[]),f={event:[],habit:[],name:a.groupForm.name,updated:!0};""!==d.join("")&&(f.parents=d);
c[c.length]=f;b.post(f,a.group.length-1,"insert").success(a.finishMakingAGroup);e.show(e.simple().content("\u30b0\u30eb\u30fc\u30d7 "+a.groupForm.name+" \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));a.groupForm.name=""}}]);angular.module(appName).controller("detailCtrl",["$scope","eventForm","user","group","mode",function(a,c,d,b,e){a.mode=e}]);angular.module(appName).controller("settingCtrl",["$scope","group","user","db","eventListToEdit","groupForm","$mdSidenav","$mdToast","$mdDialog",function(a,c,d,b,e,f,g,h,m){function q(a,c){return a-c}function p(c){return-1!==a.user.following.indexOf(c)}function u(a){if(!c[a].parents)return[];for(var d=c[a].parents,b=0,e=c[a].parents.length;b<e;b++)d=u(c[a].parents[b]).concat(d);return d}a.group=c;a.user=d;a.groupForm=f;a.search_keyword="";a.searchResult=[];a.hide=function(a){d.hiddenGroup[d.hiddenGroup.length]=
a;d.hiddenGroup.sort(q);d.save()};a.show=function(c){d.hiddenGroup=_.without(a.user.hiddenGroup,c);d.save()};a.followsParent=function(a){a=u(a);for(var c=0,d=a.length;c<d;c++)if(!p(a[c]))return a[c];return!0};a.toggleNav=function(){console.log("called");g("left").close()};a.follows=p;a.follow=function(b){a.user.following[a.user.following.length]=b;a.user.following.sort(q);d.save();h.show(h.simple().content(c[b].name+"\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3))};
a.unfollow=function(b){var e=[];e[e.length]=a.user.following.indexOf(b);for(var f=0,F=a.user.following.length;f<F;f++)if(c[a.user.following[f]].parents&&-1!=u(a.user.following[f]).indexOf(b)){if(!confirm("\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u306e\u5b50\u30b0\u30eb\u30fc\u30d7("+c[a.user.following[f]].name+")\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u30d5\u30a9\u30ed\u30fc\u89e3\u9664\u3059\u308b\u3068\u3053\u3061\u3089\u3082\u89e3\u9664\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b?"))return;
e[e.length]=f}e.sort(function(a,c){return c-a});f=0;for(F=e.length;f<F;f++)a.user.following.splice(e[f],1);d.save()};a.showEventList=function(a){e.id=a};a.makeAGroup=function(){f.isEditMode=!0;g("left").close()};a.search=function(){var d=[];if(""==a.search_keyword)return d;for(var b=0,e=c.length;b<e&&!(30<d.length);b++)-1!==c[b].name.indexOf(a.search_keyword)&&(d[d.length]=b);a.searchResult=d};a.randomSearch=function(){var d=[];if(5>c.length)Array.prototype.push.apply(d,c);else for(;5>d.length;){var b=
Math.random()*c.length|0;-1===_.indexOf(d,b)&&(d[d.length]=b)}a.searchResult=d};a.hideAll=function(){d.hiddenGroup.length=0;d.hiddenGroup=_.clone(d.following);d.hiddenGroup[d.hiddenGroup.length]=-1;d.hiddenGroup.sort(q);d.save()};a.showAll=function(){d.hiddenGroup=[];d.save()};a.importSetting=function(){m.show({controller:["$scope","$mdDialog",function(a,c){a.text="";a.answer=function(a){c.hide(a)}}],template:'<md-dialog><md-content>\u30b3\u30d4\u30fc\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002<br><input ng-model="text"><md-button ng-click="answer(text)">ok</md-button></md-content></md-dialog>'}).then(function(a){a=
JSON.parse(a);for(var c in a)d[c]=a[c];d.save()})};a.exportSetting=function(){m.show(m.alert().title("").content("\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u79fb\u884c\u5148\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002"+angular.toJson(d)).ok("ok"))}}]).directive("autoFocus",function(){return{link:function(a,c,d){a.$watch("focus",function(d){!0===a.focus&&c[0].focus()})}}});angular.module(appName).controller("eventListCtrl",["$scope","group","user","eventListToEdit","eventForm","mode",function(a,c,d,b,e,f){a.eventListToEdit=b;a.group=c;a.user=d;a.habitList="private"!==b.id?c[b.id].habit:d["private"].habit;a.eventList="private"!==b.id?c[b.id].event:d["private"].event;a.mode=f}]);angular.module(appName).factory("user",["$rootScope",function(a){if(localStorage&&angular.fromJson(localStorage.getItem("private"))){var c=angular.fromJson(localStorage.getItem("private"));c.isHiddenGroup=function(a){return-1!==_.indexOf(this.hiddenGroup,a,!0)};c.save=function(){a.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))};c.updated=!0}else c={following:[],"private":{event:[],habit:[],name:"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8"},hiddenGroup:[],isHiddenGroup:function(a){return-1!==
_.indexOf(this.hiddenGroup,a,!0)},save:function(){a.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))}};c.save();return c}]).factory("eventForm",function(){return{name:"",year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),type:"event",rule:""}}).factory("groupForm",function(){return{name:""}}).factory("group",["$http",function(a){return[{id:0,event:[{name:"[mes]\u6625\u5206\u306e\u65e5",year:2E3,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2E3,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2001,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2001,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2002,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2002,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2003,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2003,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2004,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2004,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2005,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2005,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2006,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2006,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2007,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2007,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2008,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2008,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2009,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2009,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2010,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2010,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2011,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2011,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2012,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2012,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2013,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2013,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2014,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2014,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2015,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2015,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2016,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2016,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2017,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2017,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2018,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2018,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2019,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2019,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2020,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2020,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2021,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2021,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2022,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2022,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2023,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2023,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2024,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2024,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2025,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2025,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2026,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2026,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2027,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2027,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2028,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",
year:2028,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2029,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2029,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2030,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2030,month:8,date:23},{name:"[mes]\u5341\u4e94\u591c",year:2E3,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2001,month:9,date:1},{name:"[mes]\u5341\u4e94\u591c",year:2002,month:8,date:21},{name:"[mes]\u5341\u4e94\u591c",year:2003,
month:8,date:11},{name:"[mes]\u5341\u4e94\u591c",year:2004,month:8,date:28},{name:"[mes]\u5341\u4e94\u591c",year:2005,month:8,date:18},{name:"[mes]\u5341\u4e94\u591c",year:2006,month:9,date:6},{name:"[mes]\u5341\u4e94\u591c",year:2007,month:8,date:25},{name:"[mes]\u5341\u4e94\u591c",year:2008,month:8,date:14},{name:"[mes]\u5341\u4e94\u591c",year:2009,month:9,date:3},{name:"[mes]\u5341\u4e94\u591c",year:2010,month:8,date:22},{name:"[mes]\u5341\u4e94\u591c",year:2011,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",
year:2012,month:8,date:30},{name:"[mes]\u5341\u4e94\u591c",year:2013,month:8,date:19},{name:"[mes]\u5341\u4e94\u591c",year:2014,month:8,date:8},{name:"[mes]\u5341\u4e94\u591c",year:2015,month:8,date:27},{name:"[mes]\u5341\u4e94\u591c",year:2016,month:8,date:15}],habit:[{name:"[mes]\u5143\u65e6",selector:"month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"month:1 day:2nd-mon"},{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"month:4 date:29"},{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u65e5",
selector:"month:2 date:11"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"month:5 date:4"},{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",selector:"month:5 date:5"},{name:"[mes]\u6d77\u306e\u65e5",selector:"month:7 day:3rd-mon"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"month:9 day:3rd-mon"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",selector:"month:11 date:3"},
{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"month:12 date:23"}],name:"\u795d\u65e5",updated:!0}]}]).factory("calF",function(){var a=new Date,c=[];return{year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),calendar:function(a,b){if(c[a-MEMO_LIMIT]){if(c[a-MEMO_LIMIT][b])return c[a-MEMO_LIMIT][b]}else c[a-MEMO_LIMIT]=[];var e=(new Date(a,b,1)).getDay(),f=[31,28,31,30,31,30,31,31,30,31,30,31][b];1===b&&(0==
a%400||0!=a%100&&0==a%4)&&(f=29);var g=[];g.year=a;g.month=b;var h=0;for(;;){g[h]=[];for(var m=1;7>=m;m++)g[h][g[h].length]=0<7*h+m-e?7*h+m-e<=f?7*h+m-e:32:0;if(g[h][g[h].length-1]>=f)break;h++}return c[a-MEMO_LIMIT][b]=g},today:{year:a.getFullYear(),month:a.getMonth(),date:a.getDate()},selected:a.getDate(),selectedDay:function(){return null==this.selected?"":"\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")[(new Date(this.year,this.month,this.selected)).getDay()]},disableHoverEvent:isSmartPhone}}).factory("eventListToEdit",
function(){return{id:""}}).factory("error",["$mdToast",function(a){var c=c||Error;return function(d){a.show(a.simple().content(d).position("top right").hideDelay(3E3));return new c(d)}}]).factory("mode",["eventForm",function(a){return{editsEventForm:!1,editsGroupForm:!1,switchToEdit:function(){arguments=Array.prototype.slice.call(arguments);if(1===arguments.length||2===arguments.length&&!0===arguments[1]){var c=arguments[0];a.mode=1===arguments.length?"edit":"add";c=c.split(":");_.extend(a,{type:c[2],
id:1===arguments.length?c[0]:0});a.selectedGroup="private"!==c[1]?parseInt(c[1],10):c[1];"event"===c[2]?(_.map(["year","month","date","name"],function(d){a[d]="private"===c[1]?user["private"].event[c[0]][d]:group[c[1]].event[c[0]][d]}),a.month+=1):"habit"===c[2]&&("private"===c[1]?(a.rule=user["private"].habit[c[0]].selector,a.name=user["private"].habit[c[0]].name):(a.rule=group[c[1]].habit[c[0]].selector,a.name=group[c[1]].habit[c[0]].name))}else 3===arguments.length&&_.extend(a,{mode:"add",type:"event",
rule:"",id:0,name:"",year:arguments[0],month:arguments[1]+1,date:arguments[2]});this.editsEventForm=!0}}}]).run(["calF","$timeout",function(a,c){function d(){var b=new Date;b.setDate(b.getDate()+1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);var f=new Date;a.today.year=f.getFullYear();a.today.month=f.getMonth();a.today.date=f.getDate();c(d,b-new Date)}var b=new Date;b.setDate(b.getDate()+1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);b.setMilliseconds(0);c(d,b-new Date)}]).factory("db",
["group","user","$http","$rootScope",function(a,c,d,b){return{post:function(a,c,g){a=_.clone(a);a.id=c;a.permission=a.permission||[];a.parents=a.parents||"";delete a.updated;for(var h in a)a[h]=angular.toJson(a[h]);a.type=g;b.$broadcast("updated");return d.post("http://www40.atpages.jp/chatblanc/genderC/database.php",a).success(function(a){console.log("updated");console.log(a)}).error(function(a){console.log(a)})},list:function(){return d.post("http://www40.atpages.jp/chatblanc/genderC/database.php",
{type:"list",groupID:c.following.join(",")}).success(function(a){return a}).error(function(a){console.log(a)})},getNameList:function(){return d.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"namelist"}).success(function(a){return a})}}}]);angular.module(appName).factory("eventCal",["group","user","calF","error",function(a,c,d,b){function e(a){return parseInt(a,10)}function f(b,d,e){if("private"!==b&&!a[b])return[];var w=[],x=[];"private"===b?(_.each(c.following,function(a){x=x.concat(f(a,d,e))}),w=w.concat(g(c["private"].event,d,e,"private")),x=x.concat(w),w=w.concat(h(c["private"].habit,d,e,"private",x)),c.updated=!1):(a[b].parents&&_.each(a[b].parents,function(a){x=x.concat(f(a,d,e))}),w=w.concat(g(a[b].event,d,e,b)),x=x.concat(w),
w=w.concat(h(a[b].habit,d,e,b,x)),a[b].updated=!1);return w}function g(a,b,c,d){var e=[];if(!a)return e;for(var f=0,h=a.length;f<h;f++)if(a[f].year===b&&a[f].month===c){var g=_.clone(a[f]);g.group=d;g.type="event";g.id=f;e[e.length]=g}return e}function h(c,l,g,w,x){function h(c,l,g){function F(c,l,g){var h=function(){return _.clone(C)},r=d.calendar(l,g),y={sunday:0,sun:0,"\u65e5\u66dc\u65e5":0,monday:1,mon:1,"\u6708\u66dc\u65e5":1,tuesday:2,tue:2,"\u706b\u66dc\u65e5":2,wednesday:3,wed:3,"\u6c34\u66dc\u65e5":3,
thursday:4,thu:4,"\u6728\u66dc\u65e5":4,friday:5,fri:5,"\u91d1\u66dc\u65e5":5,saturday:6,sat:6,"\u571f\u66dc\u65e5":6},q={January:0,Jan:0,"\u7766\u6708":0,February:1,Feb:1,"\u5982\u6708":1,March:2,Mar:2,"\u5f25\u751f":2,April:3,Apr:3,"\u536f\u6708":3,May:4,"\u7690\u6708":4,June:5,Jun:5,"\u6c34\u7121\u6708":5,July:6,Jul:6,"\u6587\u6708":6,August:7,Aug:7,"\u8449\u6708":7,September:8,Sep:8,"\u9577\u6708":8,October:9,Oct:9,"\u795e\u7121\u6708":9,November:10,Nov:10,"\u971c\u6708":10,December:11,Dec:11,
"\u5e2b\u8d70":11};if(p[l-MEMO_LIMIT])if(p[l-MEMO_LIMIT][g]){if(p[l-MEMO_LIMIT][g][c])return _.clone(p[l-MEMO_LIMIT][g][c])}else p[l-MEMO_LIMIT][g]={};else p[l-MEMO_LIMIT]=[],p[l-MEMO_LIMIT][g]={};var m=c.split(":")[0],k=c.split(":").slice(1).join(":"),n=[],z=[],u=[],B=[],t,v,A,E,D=[];if("not"===m)if(n=h(),"public-holiday"===k||"\u795d\u65e5"===k){r=f(0,l,g);y=0;for(k=r.length;y<k;y++)r[y]=r[y].date;n=_.difference(n,r);p[l-MEMO_LIMIT][g][c]=_.clone(n)}else if(0===k.indexOf("year")||0===k.indexOf("month")||
0===k.indexOf("date")||0===k.indexOf("day"))k=k.replace(/=/,":"),n=_.difference(h(),F(k,l,g));else{var I=k.split("=")[0],H=k.replace(/^.+?=/,""),H=H.replace(/^"(.+)"$/,"$1");_.each(x,function(a){if(a[I]===H||0===a[I].indexOf("[mes]")&&a[I].slice(5)===H)n=_.without(n,a.date)})}else if("range"===m)if(".."===k.slice(0,2))k="..."===k.slice(0,3)?k.slice(3):k.slice(2),n=h(),k=k.split("/"),k=_.map(k,e),v=new Date(k[0],k[1]-1,k[2]),v.getFullYear()<l||v.getFullYear()==l&&v.getMonth()<g?n=[]:v.getFullYear()==
l&&v.getMonth()==g?(n=h(),n=_.filter(n,function(a){return a<=v.getDate()})):n=h();else if(".."===k.slice(-2))k="..."===k.slice(-3)?k.slice(0,-3):k.slice(0,-2),k=k.split("/"),k=_.map(k,e),t=new Date(k[0],k[1]-1,k[2]),t.getFullYear()>l||t.getFullYear()==l&&t.getMonth()>g?n=[]:t.getFullYear()==l&&t.getMonth()==g?(n=h(),n=_.filter(n,function(a){return a>=t.getDate()})):n=h();else if(-1!==k.indexOf(".."))n=[],k=k.split("..."),1===k.length&&(k=k[0].split("..")),z=[],u=[],B=[],t=k[0],v=k[1],A=v.substr(v.length-
4,4),E=v.substr(v.length-5,5),D=[],t=t.split("/"),t=_.map(t,e),3===t.length?(r=new Date(t[0],t[1]-1,t[2]),D.push(r)):2===t.length&&(r=new Date(l-1,t[0]-1,t[1]),D.push(r,new Date(l,t[0]-1,t[1]))),_.each(D,function(a){a.getFullYear()>l||a.getFullYear()==l&&a.getMonth()>g?z=[]:a.getFullYear()==l&&a.getMonth()==g?(z=h(),z=_.filter(z,function(c){return c>=a.getDate()})):z=h();B.push(z)}),D=_.zip(D,B),_.each(D,function(a){var c=a[0];a=a[1];var b;if("date"===A||"week"===A||"year"===A||"dates"===E||"weeks"===
E||"years"===E){var d;d="date"===A||"week"===A||"year"===A?e(v.substring(0,v.length-4)):e(v.substring(0,v.length-5));b=new Date(c.getTime());"date"===A||"dates"===E?b.setDate(b.getDate()+d):"week"===A||"weeks"===E?b.setDate(b.getDate()+7*d):"year"!==A&&"years"!==E||b.setFullYear(b.getFullYear()+d)}else b=v.split("/"),b=_.map(b,e),3===b.length?b=new Date(b[0],b[1]-1,b[2]):(b=new Date(c.getFullYear(),b[0]-1,b[1]),b.getTime()<c.getTime()&&b.setFullYear(b.getFullYear()+1));b.getFullYear()<l||b.getFullYear()==
l&&b.getMonth()<g?u=[]:b.getFullYear()==l&&b.getMonth()==g?(u=h(),u=_.filter(u,function(a){return a<=b.getDate()})):u=h();_.isEmpty(_.intersection(a,u))||(n=_.intersection(a,u))});else throw b('invalid selector "'+m+":"+k+'" in '+a[w].name+".");else if("date"===m)n[n.length]=e(k);else if("month"===m)if(!q[k]&&e(k)!=g+1||q[k]&&q[k]!=g)n=[];else{if(!q[k]&&e(k)==g+1||q[k]&&q[k]==g)n=h()}else if("day"===m)if(k.match(/^\d/)){for(var k=k.match(/^(\d+)(?:st|nd|rd|th)-?(.+)$/),D=e(k[1]),G=y[k[2]],y=0;""===
r[y][G];)y++;n[n.length]=r[y-1+D][G]}else G=y[k],_.some(r,function(a){""!==a[G]&&(n[n.length]=a[G])});else if("year"===m)n="leap-year"===k||"leap_year"===k||"\u3046\u308b\u3046\u5e74"===k||"\u958f\u5e74"===k?0===l%400||0===l%4&&0!==l%100?h():[]:e(k)!==l?[]:h();else throw b('undefined key "'+m+'".');"day"===m&&(p[l-MEMO_LIMIT][g][c]=_.clone(n));return n}var r=[],C=_.flatten(d.calendar(l,g));_.each(c,function(a){if(1===a[1])r[r.length]=F(a[0],l,g);else if(0===a[1])if("&&"===a[0])r.push(_.intersection(r.pop(),
r.pop()));else if("||"===a[0])r.push(_.union(r.pop(),r.pop()));else throw b("undefined operator "+a[0]);});if(1!=r.length)throw b("unexpected error in execSelectors().");return r.pop()}if(!c)return[];for(var q=[],C=0,u=c.length;C<u;C++){c[C].type="habit";c[C].group=w;var z=h(m(c[C].selector),l,g);_.each(z,function(a,b){z[b]={year:l,month:g,date:a,name:c[C].name,group:w,id:C,type:"habit"}});q=q.concat(z)}return q}function m(a){function b(a){""!==a[0]&&(c[c.length]=a)}if(u[a])return u[a];for(var c=
[],d=!1,e=0,f=0,g=a.length;f<g;f++){var h=a.charAt(f);if(d)'"'===h?d=!1:"\\"===h&&(f+=1);else if('"'===h)d=!0;else if(" "===h){b([a.substring(e,f),1]);var h={" and ":"&&"," \u304b\u3064 ":"&&"," && ":"&&"," or ":"||"," \u307e\u305f\u306f ":"||"," || ":"||"},m=!1,p;a:for(p in h)if(a.substr(f,p.length)===p){b([h[p],0]);e=f+p.length;f+=p.length;m=!0;break a}m||(b(["&&",0]),e=f+1,f+=1)}else if("("===h||")"===h)b([a.substring(e,f),1]),b([h,"("===h?2:3]),e=f+1}""!==a.substring(e)&&b([a.substring(e),1]);
return u[a]=q(c)}function q(a){for(var c=[],d=[],e={"||":0,"&&":1},f=0,g=a.length;f<g;f++)if(1===a[f][1])d[d.length]=a[f].concat();else if(0===a[f][1]){var h=a[f][0];c[c.length-1]&&e[h]<=e[c[c.length-1][0]]&&(d[d.length]=c.pop());c[c.length]=a[f]}else if(2===a[f][1])c[c.length]=a[f];else if(3===a[f][1]){for(;2!=c[c.length-1][1];)if(d[d.length]=c.pop(),0===c.length)throw b("found mismatched parentheses");c.pop()}for(;0<c.length;){if(2===c[c.length-1][1])throw b("found mismatched parentheses.");d[d.length]=
c.pop()}return d}var p=[],u={},B=[],J=-1,K=-1;return{eventCalendar:function(a){var b=[],e=[],g=_.difference(c.following,c.hiddenGroup);if(d.year!==J||d.month!==K)J=d.year,K=d.month,B=[];else if(_.any(g,function(a){return!0===a.updated})||c.updated)B=[];else return B[a]||[];for(var h=0,m=g.length;h<m;h++)b[b.length]=f(g[h],d.year,d.month);c.isHiddenGroup(-1)||(b[b.length]=f("private",d.year,d.month));h=0;for(m=b.length;h<m;h++)for(var g=0,p=b[h].length;g<p;g++)e[b[h][g].date]||(e[b[h][g].date]=[]),
e[b[h][g].date][e[b[h][g].date].length]=b[h][g].id+":"+b[h][g].group+":"+b[h][g].type;B=_.clone(e);return B[a]||[]},splitSelector:m}}]);
