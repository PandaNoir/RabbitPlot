var appName="rabbit",MEMO_LIMIT=1950,QUOTATION=0,isSmartPhone=0<navigator.userAgent.indexOf("iPhone")&&-1==navigator.userAgent.indexOf("iPad")||0<navigator.userAgent.indexOf("iPod")||0<navigator.userAgent.indexOf("Android");
angular.module(appName,["ngTouch","ngAnimate","ngMaterial","ngMessages"]).controller("mainCtrl",["$scope","eventForm","calF","eventCal","eventListToEdit","$timeout","$filter","$sce","$mdSidenav",function(a,e,d,c,b,f,k,l,h){a._=_;a.eventForm=e;a.calF=d;a.eventListToEdit=b;a.eventForm.isEditMode=!1;a.showsHowToWrite=!1;a.showHowToWrite=function(){a.showsHowToWrite=!a.showsHowToWrite};a.splitSelector=c.splitSelector;a.openNav=function(){h("left").toggle()};a.calF.selected=a.calF.date;a.eventCalendar=
c.eventCalendar}]).config(["$httpProvider",function(a){a.defaults.transformRequest=function(a){if(void 0===a)return a;if(angular.isObject(a)){var d=[],c;for(c in a)if(a.hasOwnProperty(c)){var b=a[c];d[d.length]=encodeURIComponent(c)+"="+encodeURIComponent(null==b?"":b)}a=d.join("&").replace(/%20/g,"+")}else a=null==a?"":a.toString();return a};a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]).filter("format",["group","user",function(a,e){return function(d,c){d=d.split(":");
var b="",b="private"==d[1]?e["private"][d[2]][d[0]].name:a[d[1]][d[2]][d[0]].name;!1!==c&&0===b.indexOf("[mes]")&&(b=b.replace(/^\[mes\]/,""));return b}}]).run(["db","group","$rootScope",function(a,e,d){var c={id:0,event:[{name:"[mes]\u6625\u5206\u306e\u65e5",year:2E3,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2E3,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2001,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2001,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2002,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2002,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2003,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2003,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2004,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2004,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2005,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2005,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2006,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2006,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2007,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2007,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2008,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2008,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2009,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2009,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2010,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2010,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2011,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2011,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2012,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2012,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2013,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2013,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2014,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2014,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2015,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2015,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2016,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2016,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2017,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2017,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2018,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2018,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2019,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2019,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2020,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2020,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2021,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2021,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2022,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2022,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2023,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2023,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2024,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2024,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2025,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2025,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2026,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2026,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2027,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2027,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2028,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2028,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2029,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2029,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2030,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2030,month:8,date:23},{name:"[mes]\u5341\u4e94\u591c",year:2E3,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2001,month:9,date:1},{name:"[mes]\u5341\u4e94\u591c",year:2002,month:8,date:21},{name:"[mes]\u5341\u4e94\u591c",year:2003,month:8,date:11},{name:"[mes]\u5341\u4e94\u591c",year:2004,month:8,date:28},{name:"[mes]\u5341\u4e94\u591c",year:2005,month:8,date:18},{name:"[mes]\u5341\u4e94\u591c",year:2006,month:9,date:6},
{name:"[mes]\u5341\u4e94\u591c",year:2007,month:8,date:25},{name:"[mes]\u5341\u4e94\u591c",year:2008,month:8,date:14},{name:"[mes]\u5341\u4e94\u591c",year:2009,month:9,date:3},{name:"[mes]\u5341\u4e94\u591c",year:2010,month:8,date:22},{name:"[mes]\u5341\u4e94\u591c",year:2011,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2012,month:8,date:30},{name:"[mes]\u5341\u4e94\u591c",year:2013,month:8,date:19},{name:"[mes]\u5341\u4e94\u591c",year:2014,month:8,date:8},{name:"[mes]\u5341\u4e94\u591c",
year:2015,month:8,date:27},{name:"[mes]\u5341\u4e94\u591c",year:2016,month:8,date:15}],habit:[{name:"[mes]\u5143\u65e6",selector:"month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"month:1 day:2nd-mon"},{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"month:4 date:29"},{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u65e5",selector:"month:2 date:11"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"month:5 date:4"},{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",
selector:"month:5 date:5"},{name:"[mes]\u6d77\u306e\u65e5",selector:"month:7 day:3rd-mon"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"month:9 day:3rd-mon"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",selector:"month:11 date:3"},{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"month:12 date:23"}],name:"\u795d\u65e5",updated:!0};localStorage&&localStorage.getItem("group")&&
(e.length=0,Array.prototype.push.apply(e,angular.fromJson(localStorage.getItem("group"))),e[0]=_.clone(c));a.list().then(function(b){b=b.data;for(var f=0,k=b.length;f<k;f++){for(var l in b[f])b[f][l]=angular.fromJson(b[f][l]);b[f].updated=!0}b.sort(function(a,b){return a.id-b.id});f=e.length=0;for(k=b.length;f<k;f++)e[b[f].id]=b[f];e[0]=_.clone(c);d.$broadcast("updated");localStorage.setItem("group",angular.toJson(e));a.getNameList().then(function(a){for(var b=0,d=a.data[0].length;b<d;b++)e[b]||(e[b]=
{name:angular.fromJson(a.data[0][b])},a.data[1][b]&&(e[b].parents=angular.fromJson(a.data[1][b])));e[0]=_.clone(c);localStorage.setItem("group",angular.toJson(e))})})}]).directive("appDate",[function(){return{scope:{row:"=appRow"},restrict:"A",template:'<span class="date" ng-transclude></span>',transclude:!0,replace:!0,controller:["$scope","calF","eventCal","$filter",function(a,e,d,c){a.calendar=e;a.bookedClass=function(a){a=d.eventCalendar(a);for(var e=0,k=0,l=a.length;k<l;k++)0!==c("format")(a[k],
!1).indexOf("[mes]")&&e++;return 5>e?"booked-"+e:"booked-5"};a.dateClass=function(b){if(0!==b&&32!==b){var e=a.calendar,d=[];e.selected===b&&(d[d.length]="selected");d[d.length]=a.bookedClass(b);b===e.today.date&&e.month===e.today.month&&e.year===e.today.year&&(d[d.length]="today");return d}return[]}}],link:function(a,e,d){var c=a.row[d.appDate];if(""!==c&&void 0!==c){var b=function(){e.removeClass("selected booked-0 booked-1 booked-2 booked-3 booked-4 booked-5 today");e.addClass(a.dateClass(c).join(" "))};
a.$on("updated",b);b();e.on("mouseenter",function(){!a.calendar.disableHoverEvent&&c&&(a.calendar.selected=c,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),b(),a.$apply())});e.on("mouseleave",function(){a.calendar.disableHoverEvent||(a.calendar.selected=null,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),a.$apply())});e.on("click",function(){isSmartPhone||(a.calendar.disableHoverEvent=a.calendar.selected===c?!a.calendar.disableHoverEvent:
!0);a.calendar.selected=c;angular.element(document.querySelectorAll(".selected")).removeClass("selected");b();a.$apply()})}}}}]);angular.module(appName).controller("calendarCtrl",["$scope","calF","eventForm",function(a,e,d){a.calF=e;a.nextMonth=function(){a.calF.month++;a.calF.selected=null;12<a.calF.month+1&&(a.calF.year+=1,a.calF.month-=12);d.isEditMode=!1};a.lastMonth=function(){a.calF.month--;a.calF.selected=null;1>a.calF.month+1&&(a.calF.year-1<MEMO_LIMIT?(alert(MEMO_LIMIT+"\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"),
a.calF.month+=1):(a.calF.month+=12,a.calF.year-=1));d.isEditMode=!1};a.nextYear=function(){a.calF.year++;a.calF.selected=null;d.isEditMode=!1};a.lastYear=function(){a.calF.year-1<MEMO_LIMIT?alert(MEMO_LIMIT+"\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"):(a.calF.year--,a.calF.selected=null);d.isEditMode=!1}}]);angular.module(appName).controller("eventEditorCtrl",["$scope","group","user","eventForm","calF","db","$mdToast",function(a,e,d,c,b,f,k){function l(b){"private"===b?d.save():f.post(a.group[b],b,"update")}var h=[],m=[];a.group=e;a.user=d;a.eventForm=c;a.calF=b;a.ruleWriterFase="";a.ruleInput="";a.eventEditor={rules:"",selectedGroup:""};a.addEvent=function(){var b=a.eventForm.type;if(""!==c.name&&void 0!==c.selectedGroup&&null!==c.selectedGroup){var e=new Date(c.year,c.month-1,c.date);if(e.getFullYear()===
parseInt(c.year,10)&&e.getMonth()===parseInt(c.month,10)-1&&e.getDate()===parseInt(c.date,10)){if("event"==b)var d={year:c.year,month:c.month-1,date:c.date,name:c.name};else"habit"==b&&(d={selector:c.rule,name:c.name});"private"===c.selectedGroup?(a.user["private"][b][a.user["private"][b].length]=d,a.user.updated=!0):null!==c.selectedGroup&&(a.group[c.selectedGroup][b][a.group[c.selectedGroup][b].length]=d,a.group[c.selectedGroup].updated=!0);k.show(k.simple().content("\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f").position("top right"));
c.isEditMode=!1;l(c.selectedGroup)}}};a.saveEvent=function(){var b=c.type;if(null!==c.year&&null!==c.month&&null!==c.date&&""!==c.name){var e=new Date(c.year,c.month-1,c.date);if(e.getFullYear()===parseInt(c.year,10)&&e.getMonth()===parseInt(c.month,10)-1&&e.getDate()===parseInt(c.date,10)){if("private"===c.selectedGroup)var d=a.user["private"][b][c.id];else null!==c.selectedGroup&&(d=a.group[c.selectedGroup][b][c.id],a.group[c.selectedGroup].updated=!0);"event"==b?(d.year=c.year,d.month=c.month-
1,d.date=c.date,d.name=c.name):"habit"==b&&(d.selector=c.rule,d.name=c.name);c.isEditMode=!1;l(c.selectedGroup)}}};a.cancel=function(){c.isEditMode=!1};a.goFase=function(b,e){h[h.length]=a.ruleWriterFase;m[m.length]=e||b;a.ruleWriterFase=b;c.rule=m.join("")};a.cancelFase=function(){a.ruleWriterFase=h.pop();m.pop();c.rule=m.join("")};a.finishWritingRule=function(){a.ruleWriterFase="";h=[];c.rule=m.join("");m=[]};a.startWritingRule=function(){a.ruleWriterFase="selector";h=[];m=[]}}]);angular.module(appName).controller("groupEditorCtrl",["$scope","group","groupForm","db","$mdToast",function(a,e,d,c,b){a.groupForm=d;a.groupForm.parentGroup=[null];a.groupForm.mode="add";a.group=e;a.finishMakingAGroup=function(){d.isEditMode=!1};a.addGroup=function(){var d=a.groupForm.parentGroup.reduce(function(a,b){-1===a.indexOf(b)&&(a[a.length]=angular.isNumber(b)?parseInt(b,10):"");return a},[]),k={event:[],habit:[],name:a.groupForm.name,updated:!0};""!==d.join("")&&(k.parents=d);e[e.length]=
k;c.post(k,a.group.length-1,"insert").success(a.finishMakingAGroup);b.show(b.simple().content("\u30b0\u30eb\u30fc\u30d7 "+a.groupForm.name+" \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f").position("top right"));a.groupForm.name=""}}]);angular.module(appName).controller("detailCtrl",["$scope","eventForm","user","group",function(a,e,d,c){a.switchToEdit=function(){arguments=Array.prototype.slice.call(arguments);if(1===arguments.length){var b=arguments[0];a.eventForm.mode="edit";b=b.split(":");e.type=b[2];e.id=b[0];e.selectedGroup="private"!==b[1]?parseInt(b[1],10):b[1];"event"===b[2]?"private"===b[1]?(e.year=d["private"].event[b[0]].year,e.month=d["private"].event[b[0]].month+1,e.date=d["private"].event[b[0]].date,e.name=d["private"].event[b[0]].name):
(e.year=c[b[1]].event[b[0]].year,e.month=c[b[1]].event[b[0]].month+1,e.date=c[b[1]].event[b[0]].date,e.name=c[b[1]].event[b[0]].name):"habit"===b[2]&&("private"===b[1]?(e.rule=d["private"].habit[b[0]].selector,e.name=d["private"].habit[b[0]].name):(e.rule=c[b[1]].habit[b[0]].selector,e.name=c[b[1]].habit[b[0]].name))}else 2===arguments.length&&!0===arguments[1]?(b=arguments[0],a.eventForm.mode="add",b=b.split(":"),e.type=b[2],e.id=0,e.selectedGroup="private"!==b[1]?parseInt(b[1],10):b[1],"event"===
b[2]?"private"===b[1]?(e.year=d["private"].event[b[0]].year,e.month=d["private"].event[b[0]].month+1,e.date=d["private"].event[b[0]].date,e.name=d["private"].event[b[0]].name):(e.year=c[b[1]].event[b[0]].year,e.month=c[b[1]].event[b[0]].month+1,e.date=c[b[1]].event[b[0]].date,e.name=c[b[1]].event[b[0]].name):"habit"===b[2]&&("private"===b[1]?(e.rule=d["private"].habit[b[0]].selector,e.name=d["private"].habit[b[0]].name):(e.rule=c[b[1]].habit[b[0]].selector,e.name=c[b[1]].habit[b[0]].name))):3===arguments.length&&
(e.mode="add",e.type="event",e.rule="",e.id=0,e.name="",e.year=arguments[0],e.month=arguments[1]+1,e.date=arguments[2]);a.eventForm.isEditMode=!0}}]);angular.module(appName).controller("settingCtrl",["$scope","group","user","db","eventListToEdit","groupForm","$mdSidenav","$mdToast","$mdDialog",function(a,e,d,c,b,f,k,l,h){function m(a,b){return a-b}function E(b){return-1!==a.user.following.indexOf(b)}function u(a){if(!e[a].parents)return[];for(var b=e[a].parents,d=0,c=e[a].parents.length;d<c;d++)b=u(e[a].parents[d]).concat(b);return b}a.group=e;a.user=d;a.groupForm=f;a.search_keyword="";a.searchResult=[];a.hide=function(a){d.hiddenGroup[d.hiddenGroup.length]=
a;d.hiddenGroup.sort(m);d.save()};a.show=function(b){d.hiddenGroup=_.without(a.user.hiddenGroup,b);d.save()};a.followsParent=function(a){a=u(a);for(var b=0,e=a.length;b<e;b++)if(!E(a[b]))return a[b];return!0};a.toggleNav=function(){console.log("called");k("left").close()};a.follows=E;a.follow=function(b){a.user.following[a.user.following.length]=b;a.user.following.sort(m);d.save();l.show(l.simple().content(e[b].name+"\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u307e\u3057\u305f").position("top right"))};
a.unfollow=function(b){var c=[];c[c.length]=a.user.following.indexOf(b);for(var f=0,k=a.user.following.length;f<k;f++)if(e[a.user.following[f]].parents&&-1!=u(a.user.following[f]).indexOf(b)){if(!confirm("\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u306e\u5b50\u30b0\u30eb\u30fc\u30d7("+e[a.user.following[f]].name+")\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u30d5\u30a9\u30ed\u30fc\u89e3\u9664\u3059\u308b\u3068\u3053\u3061\u3089\u3082\u89e3\u9664\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b?"))return;
c[c.length]=f}c.sort(function(a,b){return b-a});f=0;for(k=c.length;f<k;f++)a.user.following.splice(c[f],1);d.save()};a.showEventList=function(a){b.id=a};a.makeAGroup=function(){f.isEditMode=!0;k("left").close()};a.search=function(){var b=[];if(""==a.search_keyword)return b;for(var d=0,c=e.length;d<c&&!(30<b.length);d++)-1!==e[d].name.indexOf(a.search_keyword)&&(b[b.length]=d);a.searchResult=b};a.randomSearch=function(){var b=[];if(5>e.length)Array.prototype.push.apply(b,e);else for(;5>b.length;){var d=
Math.random()*e.length|0;-1===_.indexOf(b,d)&&(b[b.length]=d)}a.searchResult=b};a.hideAll=function(){d.hiddenGroup.length=0;d.hiddenGroup=_.clone(d.following);d.hiddenGroup[d.hiddenGroup.length]=-1;d.hiddenGroup.sort(m);d.save()};a.showAll=function(){d.hiddenGroup=[];d.save()};a.importSetting=function(){h.show({controller:function(b,a){b.text="";b.answer=function(b){a.hide(b)}},template:'<md-dialog><md-content>\u30b3\u30d4\u30fc\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002<br><input ng-model="text"><md-button ng-click="answer(text)">ok</md-button></md-content></md-dialog>'}).then(function(b){b=
JSON.parse(b);for(var a in b)d[a]=b[a];d.save()})};a.exportSetting=function(){h.show(h.alert().title("").content("\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u79fb\u884c\u5148\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002"+angular.toJson(d)).ok("ok"))}}]).directive("autoFocus",function(){return{link:function(a,e,d){a.$watch("focus",function(d){!0===a.focus&&e[0].focus()})}}});angular.module(appName).controller("eventListCtrl",["$scope","group","user","eventListToEdit","eventForm",function(a,e,d,c,b){a.eventListToEdit=c;a.group=e;a.user=d;a.habitList="private"!==c.id?e[c.id].habit:d["private"].habit;a.eventList="private"!==c.id?e[c.id].event:d["private"].event;a.switchToEdit=function(){arguments=Array.prototype.slice.call(arguments);if(1===arguments.length){var c=arguments[0];a.eventForm.mode="edit";c=c.split(":");b.type=c[2];b.id=c[0];b.selectedGroup="private"!==c[1]?
parseInt(c[1],10):c[1];"event"===c[2]?"private"===c[1]?(b.year=d["private"].event[c[0]].year,b.month=d["private"].event[c[0]].month+1,b.date=d["private"].event[c[0]].date,b.name=d["private"].event[c[0]].name):(b.year=e[c[1]].event[c[0]].year,b.month=e[c[1]].event[c[0]].month+1,b.date=e[c[1]].event[c[0]].date,b.name=e[c[1]].event[c[0]].name):"habit"===c[2]&&("private"===c[1]?(b.rule=d["private"].habit[c[0]].selector,b.name=d["private"].habit[c[0]].name):(b.rule=e[c[1]].habit[c[0]].selector,b.name=
e[c[1]].habit[c[0]].name))}else 2===arguments.length&&!0===arguments[1]?(c=arguments[0],a.eventForm.mode="add",c=c.split(":"),b.type=c[2],b.id=0,b.selectedGroup="private"!==c[1]?parseInt(c[1],10):c[1],"event"===c[2]?"private"===c[1]?(b.year=d["private"].event[c[0]].year,b.month=d["private"].event[c[0]].month+1,b.date=d["private"].event[c[0]].date,b.name=d["private"].event[c[0]].name):(b.year=e[c[1]].event[c[0]].year,b.month=e[c[1]].event[c[0]].month+1,b.date=e[c[1]].event[c[0]].date,b.name=e[c[1]].event[c[0]].name):
"habit"===c[2]&&("private"===c[1]?(b.rule=d["private"].habit[c[0]].selector,b.name=d["private"].habit[c[0]].name):(b.rule=e[c[1]].habit[c[0]].selector,b.name=e[c[1]].habit[c[0]].name))):3===arguments.length&&(b.mode="add",b.type="event",b.rule="",b.id=0,b.name="",b.year=arguments[0],b.month=arguments[1]+1,b.date=arguments[2]);a.eventForm.isEditMode=!0}}]);angular.module(appName).factory("user",["$rootScope",function(a){if(localStorage&&angular.fromJson(localStorage.getItem("private"))){var e=angular.fromJson(localStorage.getItem("private"));e.isHiddenGroup=function(a){return-1!==_.indexOf(this.hiddenGroup,a,!0)};e.save=function(){a.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))};e.updated=!0}else e={following:[],"private":{event:[],habit:[],name:"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8"},hiddenGroup:[],isHiddenGroup:function(a){return-1!==
_.indexOf(this.hiddenGroup,a,!0)},save:function(){a.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))}};e.save();return e}]).factory("eventForm",function(){return{isEditMode:!1,name:"",year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),type:"event",rule:""}}).factory("groupForm",function(){return{isEditMode:!1,name:""}}).factory("group",["$http",function(a){return[{id:0,event:[{name:"[mes]\u6625\u5206\u306e\u65e5",year:2E3,month:2,date:20},
{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2E3,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2001,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2001,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2002,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2002,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2003,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2003,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2004,
month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2004,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2005,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2005,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2006,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2006,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2007,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2007,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2008,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2008,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2009,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2009,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2010,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2010,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2011,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2011,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2012,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2012,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2013,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2013,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2014,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2014,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2015,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2015,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2016,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2016,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2017,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2017,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2018,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2018,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2019,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2019,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2020,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2020,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2021,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2021,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2022,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2022,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2023,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2023,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2024,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2024,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2025,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2025,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2026,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2026,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2027,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2027,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2028,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2028,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2029,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2029,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2030,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2030,month:8,date:23},{name:"[mes]\u5341\u4e94\u591c",year:2E3,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2001,month:9,date:1},{name:"[mes]\u5341\u4e94\u591c",year:2002,
month:8,date:21},{name:"[mes]\u5341\u4e94\u591c",year:2003,month:8,date:11},{name:"[mes]\u5341\u4e94\u591c",year:2004,month:8,date:28},{name:"[mes]\u5341\u4e94\u591c",year:2005,month:8,date:18},{name:"[mes]\u5341\u4e94\u591c",year:2006,month:9,date:6},{name:"[mes]\u5341\u4e94\u591c",year:2007,month:8,date:25},{name:"[mes]\u5341\u4e94\u591c",year:2008,month:8,date:14},{name:"[mes]\u5341\u4e94\u591c",year:2009,month:9,date:3},{name:"[mes]\u5341\u4e94\u591c",year:2010,month:8,date:22},{name:"[mes]\u5341\u4e94\u591c",
year:2011,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2012,month:8,date:30},{name:"[mes]\u5341\u4e94\u591c",year:2013,month:8,date:19},{name:"[mes]\u5341\u4e94\u591c",year:2014,month:8,date:8},{name:"[mes]\u5341\u4e94\u591c",year:2015,month:8,date:27},{name:"[mes]\u5341\u4e94\u591c",year:2016,month:8,date:15}],habit:[{name:"[mes]\u5143\u65e6",selector:"month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"month:1 day:2nd-mon"},{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"month:4 date:29"},
{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u65e5",selector:"month:2 date:11"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"month:5 date:4"},{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",selector:"month:5 date:5"},{name:"[mes]\u6d77\u306e\u65e5",selector:"month:7 day:3rd-mon"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"month:9 day:3rd-mon"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",
selector:"month:11 date:3"},{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"month:12 date:23"}],name:"\u795d\u65e5",updated:!0}]}]).factory("calF",function(){var a=new Date,e=[];return{year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),calendar:function(a,c){if(e[a-MEMO_LIMIT]){if(e[a-MEMO_LIMIT][c])return e[a-MEMO_LIMIT][c]}else e[a-MEMO_LIMIT]=[];var b=(new Date(a,c,1)).getDay(),f=[31,28,31,30,31,30,31,31,
30,31,30,31][c];1===c&&(0==a%400||0!=a%100&&0==a%4)&&(f=29);var k=[];k.year=a;k.month=c;var l=0;for(;;){k[l]=[];for(var h=1;7>=h;h++)k[l][k[l].length]=0<7*l+h-b?7*l+h-b<=f?7*l+h-b:32:0;if(k[l][k[l].length-1]>=f)break;l++}return e[a-MEMO_LIMIT][c]=k},today:{year:a.getFullYear(),month:a.getMonth(),date:a.getDate()},selected:a.getDate(),selectedDay:function(){return null==this.selected?"":"\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")[(new Date(this.year,this.month,this.selected)).getDay()]},
disableHoverEvent:isSmartPhone}}).factory("eventListToEdit",function(){return{id:""}}).run(["$timeout",function(a){function e(){var c=new Date;c.setDate(c.getDate()+1);c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);var b=new Date;$scope.calF.today.year=b.getFullYear();$scope.calF.today.month=b.getMonth();$scope.calF.today.date=b.getDate();a(e,c-new Date)}var d=new Date;d.setDate(d.getDate()+1);d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);a(e,d-new Date)}]).factory("db",
["group","user","$http","$rootScope",function(a,e,d,c){return{post:function(a,e,k){a=_.clone(a);a.id=e;a.permission=a.permission||[];a.parents=a.parents||"";delete a.updated;for(var l in a)a[l]=angular.toJson(a[l]);a.type=k;c.$broadcast("updated");return d.post("http://www40.atpages.jp/chatblanc/genderC/database.php",a).success(function(a){console.log("updated");console.log(a)}).error(function(a){console.log(a)})},list:function(){return d.post("http://www40.atpages.jp/chatblanc/genderC/database.php",
{type:"list",groupID:e.following.join(",")}).success(function(a){return a}).error(function(a){console.log(a)})},getNameList:function(){return d.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"namelist"}).success(function(a){return a})}}}]);angular.module(appName).factory("eventCal",["group","user","calF","$mdToast",function(a,e,d,c){function b(a){return parseInt(a,10)}function f(a){c.show(c.simple().content(a).position("top right"));console&&console.error&&console.error(a)}function k(b,c,d){if("private"!==b&&!a[b])return[];var f=[],w=[];"private"===b?(_.each(e.following,function(a){w=w.concat(k(a,c,d))}),f=f.concat(l(e["private"].event,c,d,"private")),w=w.concat(f),f=f.concat(h(e["private"].habit,c,d,"private",w)),e.updated=!1):(a[b].parents&&
_.each(a[b].parents,function(a){w=w.concat(k(a,c,d))}),f=f.concat(l(a[b].event,c,d,b)),w=w.concat(f),f=f.concat(h(a[b].habit,c,d,b,w)),a[b].updated=!1);return f}function l(a,b,c,e){var d=[];if(!a)return d;for(var f=0,k=a.length;f<k;f++)if(a[f].year===b&&a[f].month===c){var l=_.clone(a[f]);l.group=e;l.type="event";l.id=f;d[d.length]=l}return d}function h(c,e,l,G,w){function s(c,e,p){function l(c,e,p){var h=function(){return _.clone(K)},s=d.calendar(e,p),q={sunday:0,sun:0,"\u65e5\u66dc\u65e5":0,monday:1,
mon:1,"\u6708\u66dc\u65e5":1,tuesday:2,tue:2,"\u706b\u66dc\u65e5":2,wednesday:3,wed:3,"\u6c34\u66dc\u65e5":3,thursday:4,thu:4,"\u6728\u66dc\u65e5":4,friday:5,fri:5,"\u91d1\u66dc\u65e5":5,saturday:6,sat:6,"\u571f\u66dc\u65e5":6},y={January:0,Jan:0,"\u7766\u6708":0,February:1,Feb:1,"\u5982\u6708":1,March:2,Mar:2,"\u5f25\u751f":2,April:3,Apr:3,"\u536f\u6708":3,May:4,"\u7690\u6708":4,June:5,Jun:5,"\u6c34\u7121\u6708":5,July:6,Jul:6,"\u6587\u6708":6,August:7,Aug:7,"\u8449\u6708":7,September:8,Sep:8,"\u9577\u6708":8,
October:9,Oct:9,"\u795e\u7121\u6708":9,November:10,Nov:10,"\u971c\u6708":10,December:11,Dec:11,"\u5e2b\u8d70":11};if(u[e-MEMO_LIMIT])if(u[e-MEMO_LIMIT][p]){if(u[e-MEMO_LIMIT][p][c])return _.clone(u[e-MEMO_LIMIT][p][c])}else u[e-MEMO_LIMIT][p]={};else u[e-MEMO_LIMIT]=[],u[e-MEMO_LIMIT][p]={};var m=c.split(":")[0],g=c.split(":").slice(1).join(":"),n=[];if("not"===m)if(n=h(),"public-holiday"===g||"\u795d\u65e5"===g){s=k(0,e,p);q=0;for(g=s.length;q<g;q++)s[q]=s[q].date;n=_.difference(n,s);u[e-MEMO_LIMIT][p][c]=
_.clone(n)}else if(0===g.indexOf("year")||0===g.indexOf("month")||0===g.indexOf("date")||0===g.indexOf("day"))g=g.replace(/=/,":"),n=_.difference(h(),l(g,e,p));else{var A=g.split("=")[0],v=g.replace(/^.+?=/,""),v=v.replace(/^"(.+)"$/,"$1");_.each(w,function(a){if(a[A]===v||0===a[A].indexOf("[mes]")&&a[A].slice(5)===v)n=_.without(n,a.date)})}else if("range"===m)if(".."===g.slice(0,2))g="..."===g.slice(0,3)?g.slice(3):g.slice(2),n=h(),g=g.split("/"),g=_.map(g,b),t=new Date(g[0],g[1]-1,g[2]),t.getFullYear()<
e||t.getFullYear()==e&&t.getMonth()<p?n=[]:t.getFullYear()==e&&t.getMonth()==p?(n=h(),n=_.filter(n,function(a){return a<=t.getDate()})):n=h();else if(".."===g.slice(-2))g="..."===g.slice(-3)?g.slice(0,-3):g.slice(0,-2),g=g.split("/"),g=_.map(g,b),r=new Date(g[0],g[1]-1,g[2]),r.getFullYear()>e||r.getFullYear()==e&&r.getMonth()>p?n=[]:r.getFullYear()==e&&r.getMonth()==p?(n=h(),n=_.filter(n,function(a){return a>=r.getDate()})):n=h();else if(-1!==g.indexOf("..")){n=[];g=g.split("...");1===g.length&&(g=
g[0].split(".."));var B=[],z=[],J=[],r=g[0],t=g[1],x=t.substr(t.length-4,4),C=t.substr(t.length-5,5),s=[],r=r.split("/"),r=_.map(r,b);3===r.length?(q=new Date(r[0],r[1]-1,r[2]),s.push(q)):2===r.length&&(q=new Date(e-1,r[0]-1,r[1]),s.push(q,new Date(e,r[0]-1,r[1])));_.each(s,function(a){a.getFullYear()>e||a.getFullYear()==e&&a.getMonth()>p?B=[]:a.getFullYear()==e&&a.getMonth()==p?(B=h(),B=_.filter(B,function(b){return b>=a.getDate()})):B=h();J.push(B)});s=_.zip(s,J);_.each(s,function(a){var c=a[0];
a=a[1];var d;if("date"===x||"week"===x||"year"===x||"dates"===C||"weeks"===C||"years"===C){var g;g="date"===x||"week"===x||"year"===x?b(t.substring(0,t.length-4)):b(t.substring(0,t.length-5));d=new Date(c.getTime());"date"===x||"dates"===C?d.setDate(d.getDate()+g):"week"===x||"weeks"===C?d.setDate(d.getDate()+7*g):"year"!==x&&"years"!==C||d.setFullYear(d.getFullYear()+g)}else d=t.split("/"),d=_.map(d,b),3===d.length?d=new Date(d[0],d[1]-1,d[2]):(d=new Date(c.getFullYear(),d[0]-1,d[1]),d.getTime()<
c.getTime()&&d.setFullYear(d.getFullYear()+1));d.getFullYear()<e||d.getFullYear()==e&&d.getMonth()<p?z=[]:d.getFullYear()==e&&d.getMonth()==p?(z=h(),z=_.filter(z,function(a){return a<=d.getDate()})):z=h();console.log(c.toLocaleDateString(),d.toLocaleDateString(),_.intersection(a,z));_.isEmpty(_.intersection(a,z))||(n=_.intersection(a,z))})}else f('invalid selector "'+m+":"+g+'" in '+a[G].name+".");else if("date"===m)n[n.length]=b(g);else if("month"===m)if(!y[g]&&b(g)!=p+1||y[g]&&y[g]!=p)n=[];else{if(!y[g]&&
b(g)==p+1||y[g]&&y[g]==p)n=h()}else if("day"===m)if(g.match(/^\d/)){for(var g=g.match(/^(\d+)(?:st|nd|rd|th)-?(.+)$/),y=b(g[1]),D=q[g[2]],q=0;""===s[q][D];)q++;n[n.length]=s[q-1+y][D]}else D=q[g],_.some(s,function(a){""!==a[D]&&(n[n.length]=a[D])});else"year"===m?n="leap-year"===g||"leap_year"===g||"\u3046\u308b\u3046\u5e74"===g||"\u958f\u5e74"===g?0===e%400||0===e%4&&0!==e%100?h():[]:b(g)!==e?[]:h():f('undefined key "'+m+'".');"day"===m&&(u[e-MEMO_LIMIT][p][c]=_.clone(n));return n}var h=[],K=_.flatten(d.calendar(e,
p));_.each(c,function(a){1===a[1]?h[h.length]=l(a[0],e,p):0===a[1]&&("&&"===a[0]?h.push(_.intersection(h.pop(),h.pop())):"||"===a[0]?h.push(_.union(h.pop(),h.pop())):f("undefined operator "+a[0]))});1!=h.length&&(console.log(h),f("unexpected error in execSelectors()."));return h.pop()}if(!c)return[];for(var h=[],q=0,v=c.length;q<v;q++){c[q].type="habit";c[q].group=G;var A=s(m(c[q].selector),e,l);_.each(A,function(a,b){A[b]={year:e,month:l,date:a,name:c[q].name,group:G,id:q,type:"habit"}});h=h.concat(A)}return h}
function m(a){function b(a){""!==a[0]&&(c[c.length]=a)}if(F[a])return F[a];for(var c=[],e=!1,d=0,f=0,h=a.length;f<h;f++){var k=a.charAt(f);if(e)'"'===k?e=!1:"\\"===k&&(f+=1);else if('"'===k)e=!0;else if(" "===k){b([a.substring(d,f),1]);var k={" and ":"&&"," \u304b\u3064 ":"&&"," && ":"&&"," or ":"||"," \u307e\u305f\u306f ":"||"," || ":"||"},l=!1,m;a:for(m in k)if(a.substr(f,m.length)===m){b([k[m],0]);d=f+m.length;f+=m.length;l=!0;break a}l||(b(["&&",0]),d=f+1,f+=1)}else if("("===k||")"===k)b([a.substring(d,
f),1]),b([k,"("===k?2:3]),d=f+1}""!==a.substring(d)&&b([a.substring(d),1]);return F[a]=E(c)}function E(a){for(var b=[],c=[],e={"||":0,"&&":1},d=0,k=a.length;d<k;d++)if(1===a[d][1])c[c.length]=a[d].concat();else if(0===a[d][1]){var h=a[d][0];b[b.length-1]&&e[h]<=e[b[b.length-1][0]]&&(c[c.length]=b.pop());b[b.length]=a[d]}else if(2===a[d][1])b[b.length]=a[d];else if(3===a[d][1]){for(;2!=b[b.length-1][1];)c[c.length]=b.pop(),0===b.length&&f("found mismatched parentheses");b.pop()}for(;0<b.length;)2===
b[b.length-1][1]&&f("found mismatched parentheses."),c[c.length]=b.pop();return c}var u=[],F={},v=[],H=-1,I=-1;return{eventCalendar:function(a){var b=[],c=[],f=_.difference(e.following,e.hiddenGroup);if(d.year!==H||d.month!==I)H=d.year,I=d.month,v=[];else if(_.any(f,function(a){return!0===a.updated})||e.updated)v=[];else return v[a]||[];for(var h=0,l=f.length;h<l;h++)b[b.length]=k(f[h],d.year,d.month);e.isHiddenGroup(-1)||(b[b.length]=k("private",d.year,d.month));h=0;for(l=b.length;h<l;h++)for(var f=
0,m=b[h].length;f<m;f++)c[b[h][f].date]||(c[b[h][f].date]=[]),c[b[h][f].date][c[b[h][f].date].length]=b[h][f].id+":"+b[h][f].group+":"+b[h][f].type;v=_.clone(c);return v[a]||[]},splitSelector:m}}]);
