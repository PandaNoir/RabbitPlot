'use strict';(function(K,D){function y(a,d){return a-d}function k(a){return parseInt(a,10)}var J=0<navigator.userAgent.indexOf("iPhone")&&-1==navigator.userAgent.indexOf("iPad")||0<navigator.userAgent.indexOf("iPod")||0<navigator.userAgent.indexOf("Android");angular.module("rabbit",["ngTouch","ngAnimate","ngMaterial","ngMessages"]).controller("mainCtrl",["$scope","_","calF","eventCal","mode","$mdSidenav",function(a,d,b,c,e,f){console.log(e,f);a._=d;a.mode=e;e.editsEventForm=!1;e.editsGroupForm=!1;
a.splitSelector=c.splitSelector;a.openNav=function(){f("left").toggle()};b.selected=b.date;a.eventCalendar=c.eventCalendar}]).config(["$httpProvider",function(a){a.defaults.transformRequest=function(a){if(a===D)return a;if(angular.isObject(a)){var b=[],c;for(c in a)if(a.hasOwnProperty(c)){var e=a[c];b[b.length]=encodeURIComponent(c)+"="+encodeURIComponent(null==e?"":e)}a=b.join("&").replace(/%20/g,"+")}else a=null==a?"":a.toString();return a};a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded"}}]).filter("format",
["group","user",function(a,d){return function(b,c){b=b.split(":");var e="",e="private"==b[1]?d["private"][b[2]][b[0]].name:a[b[1]][b[2]][b[0]].name;!1!==c&&0===e.indexOf("[mes]")&&(e=e.replace(/^\[mes\]/,""));return e}}]).run(["db","group","$rootScope",function(a,d,b){var c=_.clone(d)[0];localStorage&&localStorage.getItem("group")&&(d.length=0,Array.prototype.push.apply(d,angular.fromJson(localStorage.getItem("group"))),d[0]=_.clone(c));a.list().then(function(e){e=e.data;for(var f=0,h=e.length;f<
h;f++){for(var l in e[f])e[f][l]=angular.fromJson(e[f][l]);e[f].updated=!0}e.sort(function(a,c){return a.id-c.id});f=d.length=0;for(h=e.length;f<h;f++)d[e[f].id]=e[f];d[0]=_.clone(c);b.$broadcast("updated");localStorage.setItem("group",angular.toJson(d));a.getNameList().then(function(a){for(var b=0,e=a.data[0].length;b<e;b++)d[b]||(d[b]={name:angular.fromJson(a.data[0][b])},a.data[1][b]&&(d[b].parents=angular.fromJson(a.data[1][b])));d[0]=_.clone(c);localStorage.setItem("group",angular.toJson(d))})})}]).directive("appDate",
[function(){return{scope:{row:"=appRow"},restrict:"A",template:'<span class="date" ng-transclude></span>',transclude:!0,replace:!0,controller:["$scope","calF","eventCal","$filter",function(a,d,b,c){a.calendar=d;a.bookedClass=function(a){a=b.eventCalendar(a);for(var d=0,h=0,l=a.length;h<l;h++)0!==c("format")(a[h],!1).indexOf("[mes]")&&d++;return 5>d?"booked-"+d:"booked-5"};a.dateClass=function(c){if(0!==c&&32!==c){var b=a.calendar,d=[];b.selected===c&&(d[d.length]="selected");d[d.length]=a.bookedClass(c);
c===b.today.date&&b.month===b.today.month&&b.year===b.today.year&&(d[d.length]="today");return d}return[]}}],link:function(a,d,b){function c(){d.removeClass("selected booked-0 booked-1 booked-2 booked-3 booked-4 booked-5 today");d.addClass(a.dateClass(e).join(" "))}var e=a.row[b.appDate];""!==e&&e!==D&&(a.$on("updated",c),c(),d.on("mouseenter",function(){!a.calendar.disableHoverEvent&&e&&(a.calendar.selected=e,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),c(),a.$apply())}),
d.on("mouseleave",function(){a.calendar.disableHoverEvent||(a.calendar.selected=null,angular.element(document.querySelectorAll(".selected")).removeClass("selected"),a.$apply())}),d.on("click",function(){J||(a.calendar.disableHoverEvent=a.calendar.selected===e?!a.calendar.disableHoverEvent:!0);a.calendar.selected=e;angular.element(document.querySelectorAll(".selected")).removeClass("selected");c();a.$apply()}))}}}]);angular.module("rabbit").controller("calendarCtrl",["$scope","calF","mode",function(a,
d,b){a.calF=d;a.nextMonth=function(){a.calF.month++;a.calF.selected=null;12<a.calF.month+1&&(a.calF.year+=1,a.calF.month-=12);b.editsEventForm=!1};a.lastMonth=function(){a.calF.month--;a.calF.selected=null;1>a.calF.month+1&&(1950>a.calF.year-1?(alert("1950\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"),a.calF.month+=1):(a.calF.month+=12,--a.calF.year));b.editsEventForm=!1};a.nextYear=function(){a.calF.year++;
a.calF.selected=null;b.editsEventForm=!1};a.lastYear=function(){1950>a.calF.year-1?alert("1950\u5e74\u3088\u308a\u4ee5\u524d\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2\u3067\u8868\u793a\u3067\u304d\u307e\u305b\u3093\u3002"):(a.calF.year--,a.calF.selected=null);b.editsEventForm=!1}}]);angular.module("rabbit").controller("eventEditorCtrl",["$scope","group","user","eventForm","calF","db","mode","$mdToast",function(a,d,b,c,e,f,h,l){function z(c){"private"===c?b.save():f.post(a.group[c],
c,"update")}var m=[],n=[];a.mode=h;a.group=d;a.user=b;a.eventForm=c;a.calF=e;a.ruleWriterFase="";a.ruleInput="";a.eventEditor={rules:"",selectedGroup:""};a.addEvent=function(){var b=a.eventForm.type;if(""!==c.name&&c.selectedGroup!==D&&null!==c.selectedGroup){var d=new Date(c.year,c.month-1,c.date);if(d.getFullYear()===k(c.year)&&d.getMonth()===k(c.month)-1&&d.getDate()===k(c.date)){if("event"==b)var e={year:c.year,month:c.month-1,date:c.date,name:c.name};else"habit"==b&&(e={selector:c.rule,name:c.name});
"private"===c.selectedGroup?(a.user["private"][b][a.user["private"][b].length]=e,a.user.updated=!0):null!==c.selectedGroup&&(a.group[c.selectedGroup][b][a.group[c.selectedGroup][b].length]=e,a.group[c.selectedGroup].updated=!0);l.show(l.simple().content("\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));h.editsEventForm=!1;z(c.selectedGroup)}}};a.saveEvent=function(){var b=c.type;if(null!==c.year&&null!==c.month&&null!==c.date&&""!==c.name){var d=
new Date(c.year,c.month-1,c.date);if(d.getFullYear()===k(c.year)&&d.getMonth()===k(c.month)-1&&d.getDate()===k(c.date)){if("private"===c.selectedGroup)var e=a.user["private"][b][c.id];else null!==c.selectedGroup&&(e=a.group[c.selectedGroup][b][c.id],a.group[c.selectedGroup].updated=!0);"event"==b?(e.year=c.year,e.month=c.month-1,e.date=c.date,e.name=c.name):"habit"==b&&(e.selector=c.rule,e.name=c.name);h.editsEventForm=!1;z(c.selectedGroup)}}};a.cancel=function(){h.editsEventForm=!1};a.goFase=function(b,
d){m[m.length]=a.ruleWriterFase;n[n.length]=d||b;a.ruleWriterFase=b;c.rule=n.join("")};a.cancelFase=function(){a.ruleWriterFase=m.pop();n.pop();c.rule=n.join("")};a.finishWritingRule=function(){a.ruleWriterFase="";m=[];c.rule=n.join("");n=[]};a.startWritingRule=function(){a.ruleWriterFase="selector";m=[];n=[]}}]);angular.module("rabbit").controller("groupEditorCtrl",["$scope","group","groupForm","db","$mdToast","mode",function(a,d,b,c,e,f){a.groupForm=b;a.groupForm.parentGroup=[null];a.groupForm.mode=
"add";a.group=d;a.finishMakingAGroup=function(){f.editsGroupForm=!1};a.addGroup=function(){var b=a.groupForm.parentGroup.reduce(function(a,b){-1===a.indexOf(b)&&(a[a.length]=angular.isNumber(b)?k(b):"");return a},[]),f={event:[],habit:[],name:a.groupForm.name,updated:!0};""!==b.join("")&&(f.parents=b);d[d.length]=f;c.post(f,a.group.length-1,"insert").success(a.finishMakingAGroup);e.show(e.simple().content("\u30b0\u30eb\u30fc\u30d7 "+a.groupForm.name+" \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3));
a.groupForm.name=""}}]);angular.module("rabbit").controller("detailCtrl",["$scope","eventCal","calF","mode",function(a,d,b,c){a.mode=c;a.calF=b;a.eventCalendar=d.eventCalendar}]);angular.module("rabbit").controller("settingCtrl",["$scope","group","user","db","eventListToEdit","groupForm","mode","$mdSidenav","$mdToast","$mdDialog",function(a,d,b,c,e,f,h,l,k,m){function n(b){return-1!==a.user.following.indexOf(b)}function A(a){if(!d[a].parents)return[];for(var b=d[a].parents,c=0,e=d[a].parents.length;c<
e;c++)b=A(d[a].parents[c]).concat(b);return b}a.group=d;a.user=b;a.groupForm=f;a.search_keyword="";a.searchResult=[];a.hide=function(a){b.hiddenGroup[b.hiddenGroup.length]=a;b.hiddenGroup.sort(y);b.save()};a.show=function(c){b.hiddenGroup=_.without(a.user.hiddenGroup,c);b.save()};a.followsParent=function(a){a=A(a);for(var b=0,c=a.length;b<c;b++)if(!n(a[b]))return a[b];return!0};a.toggleNav=function(){console.log("called");l("left").close()};a.follows=n;a.follow=function(c){a.user.following[a.user.following.length]=
c;a.user.following.sort(y);b.save();k.show(k.simple().content(d[c].name+"\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u307e\u3057\u305f").position("top right").hideDelay(3E3))};a.unfollow=function(c){var e=[];e[e.length]=a.user.following.indexOf(c);for(var f=0,q=a.user.following.length;f<q;f++)if(d[a.user.following[f]].parents&&-1!=A(a.user.following[f]).indexOf(c)){if(!confirm("\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u306e\u5b50\u30b0\u30eb\u30fc\u30d7("+d[a.user.following[f]].name+")\u3092\u30d5\u30a9\u30ed\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u30d5\u30a9\u30ed\u30fc\u89e3\u9664\u3059\u308b\u3068\u3053\u3061\u3089\u3082\u89e3\u9664\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b?"))return;
e[e.length]=f}e.sort(function(a,b){return b-a});f=0;for(q=e.length;f<q;f++)a.user.following.splice(e[f],1);b.save()};a.showEventList=function(a){e.id=a;h.showsEventList=!0};a.makeAGroup=function(){f.isEditMode=!0;l("left").close()};a.search=function(){var b=[];if(""==a.search_keyword||!d)return b;for(var c=0,e=d.length;c<e&&!(30<b.length);c++)d[c]&&d[c].name&&-1!==d[c].name.indexOf(a.search_keyword)&&(b[b.length]=c);a.searchResult=b};a.randomSearch=function(){var b=[];if(5>d.length)Array.prototype.push.apply(b,
d);else for(;5>b.length;){var c=Math.random()*d.length|0;-1===_.indexOf(b,c)&&(b[b.length]=c)}a.searchResult=b};a.hideAll=function(){b.hiddenGroup.length=0;b.hiddenGroup=_.clone(b.following);b.hiddenGroup[b.hiddenGroup.length]=-1;b.hiddenGroup.sort(y);b.save()};a.showAll=function(){b.hiddenGroup=[];b.save()};a.importSetting=function(){m.show({controller:["$scope","$mdDialog",function(a,b){a.text="";a.answer=function(a){b.hide(a)}}],template:'<md-dialog><md-content>\u30b3\u30d4\u30fc\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002<br><input ng-model="text"><md-button ng-click="answer(text)">ok</md-button></md-content></md-dialog>'}).then(function(a){a=
JSON.parse(a);for(var c in a)b[c]=a[c];b.save()})};a.exportSetting=function(){m.show(m.alert().title("").content("\u3053\u308c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u79fb\u884c\u5148\u3067\u8cbc\u308a\u4ed8\u3051\u3066\u304f\u3060\u3055\u3044\u3002"+angular.toJson(b)).ok("ok"))}}]).directive("autoFocus",function(){return{link:function(a,d,b){a.$watch("focus",function(b){!0===a.focus&&d[0].focus()})}}});angular.module("rabbit").controller("eventListCtrl",["$scope","group","user","eventListToEdit","eventForm",
"mode","$log",function(a,d,b,c,e,f,h){a.eventListToEdit=c;a.group=d;a.user=b;h.log("eventListToEdit.id===",c.id);"private"!==c.id&&""!==c.id?(a.habitList=d[c.id].habit,a.eventList=d[c.id].event):(a.habitList=b["private"].habit,a.eventList=b["private"].event);a.mode=f}]);angular.module("rabbit").factory("_",function(){return _}).factory("user",["$rootScope",function(a){if(localStorage&&angular.fromJson(localStorage.getItem("private"))){var d=angular.fromJson(localStorage.getItem("private"));d.isHiddenGroup=
function(a){return-1!==_.indexOf(this.hiddenGroup,a,!0)};d.save=function(){a.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))};d.updated=!0}else d={following:[],"private":{event:[],habit:[],name:"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8"},hiddenGroup:[],isHiddenGroup:function(a){return-1!==_.indexOf(this.hiddenGroup,a,!0)},save:function(){a.$broadcast("updated");localStorage.setItem("private",angular.toJson(this))}};d.save();return d}]).factory("eventForm",function(){return{name:"",
year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),type:"event",rule:""}}).factory("groupForm",function(){return{name:""}}).factory("group",["$http",function(a){return[{id:0,event:[{name:"[mes]\u6625\u5206\u306e\u65e5",year:2E3,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2E3,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2001,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2001,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2002,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2002,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2003,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2003,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2004,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2004,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2005,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2005,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2006,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2006,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2007,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2007,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2008,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2008,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2009,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2009,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2010,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2010,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2011,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2011,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2012,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2012,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2013,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2013,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2014,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2014,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2015,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2015,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2016,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2016,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2017,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2017,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2018,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2018,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2019,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2019,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2020,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2020,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2021,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2021,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2022,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2022,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2023,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2023,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2024,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2024,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2025,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2025,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2026,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2026,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2027,month:2,date:21},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2027,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2028,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2028,month:8,date:22},{name:"[mes]\u6625\u5206\u306e\u65e5",year:2029,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2029,month:8,date:23},{name:"[mes]\u6625\u5206\u306e\u65e5",
year:2030,month:2,date:20},{name:"[mes]\u79cb\u5206\u306e\u65e5",year:2030,month:8,date:23},{name:"[mes]\u5341\u4e94\u591c",year:2E3,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2001,month:9,date:1},{name:"[mes]\u5341\u4e94\u591c",year:2002,month:8,date:21},{name:"[mes]\u5341\u4e94\u591c",year:2003,month:8,date:11},{name:"[mes]\u5341\u4e94\u591c",year:2004,month:8,date:28},{name:"[mes]\u5341\u4e94\u591c",year:2005,month:8,date:18},{name:"[mes]\u5341\u4e94\u591c",year:2006,month:9,date:6},
{name:"[mes]\u5341\u4e94\u591c",year:2007,month:8,date:25},{name:"[mes]\u5341\u4e94\u591c",year:2008,month:8,date:14},{name:"[mes]\u5341\u4e94\u591c",year:2009,month:9,date:3},{name:"[mes]\u5341\u4e94\u591c",year:2010,month:8,date:22},{name:"[mes]\u5341\u4e94\u591c",year:2011,month:8,date:12},{name:"[mes]\u5341\u4e94\u591c",year:2012,month:8,date:30},{name:"[mes]\u5341\u4e94\u591c",year:2013,month:8,date:19},{name:"[mes]\u5341\u4e94\u591c",year:2014,month:8,date:8},{name:"[mes]\u5341\u4e94\u591c",
year:2015,month:8,date:27},{name:"[mes]\u5341\u4e94\u591c",year:2016,month:8,date:15}],habit:[{name:"[mes]\u5143\u65e6",selector:"month:1 date:1"},{name:"[mes]\u6210\u4eba\u306e\u65e5",selector:"month:1 day:2nd-mon"},{name:"[mes]\u662d\u548c\u306e\u65e5",selector:"month:4 date:29"},{name:"[mes]\u5efa\u56fd\u8a18\u5ff5\u65e5",selector:"month:2 date:11"},{name:"[mes]\u61b2\u6cd5\u8a18\u5ff5\u65e5",selector:"month:5 date:3"},{name:"[mes]\u307f\u3069\u308a\u306e\u65e5",selector:"month:5 date:4"},{name:"[mes]\u3053\u3069\u3082\u306e\u65e5",
selector:"month:5 date:5"},{name:"[mes]\u6d77\u306e\u65e5",selector:"month:7 day:3rd-mon"},{name:"[mes]\u656c\u8001\u306e\u65e5",selector:"month:9 day:3rd-mon"},{name:"[mes]\u4f53\u80b2\u306e\u65e5",selector:"month:10 day:2nd-mon"},{name:"[mes]\u6587\u5316\u306e\u65e5",selector:"month:11 date:3"},{name:"[mes]\u52e4\u52b4\u611f\u8b1d\u306e\u65e5",selector:"month:11 date:23"},{name:"[mes]\u5929\u7687\u8a95\u751f\u65e5",selector:"month:12 date:23"}],name:"\u795d\u65e5",updated:!0}]}]).factory("calF",
function(){var a=new Date,d=[];return{year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),calendar:function(a,c){if(d[a-1950]){if(d[a-1950][c])return d[a-1950][c]}else d[a-1950]=[];var e=(new Date(a,c,1)).getDay(),f=[31,28,31,30,31,30,31,31,30,31,30,31][c];1===c&&(0==a%400||0!=a%100&&0==a%4)&&(f=29);var h=[];h.year=a;h.month=c;var l=0;for(;;){h[l]=[];for(var k=1;7>=k;k++)h[l][h[l].length]=0<7*l+k-e?7*l+k-e<=f?7*l+k-e:32:0;if(h[l][h[l].length-1]>=f)break;l++}return d[a-1950][c]=h},today:{year:a.getFullYear(),
month:a.getMonth(),date:a.getDate()},selected:a.getDate(),selectedDay:function(){return null==this.selected?"":"\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split("")[(new Date(this.year,this.month,this.selected)).getDay()]},disableHoverEvent:J}}).factory("eventListToEdit",function(){return{id:""}}).factory("error",["$mdToast",function(a){var d=d||Error;return function(b){a.show(a.simple().content(b).position("top right").hideDelay(3E3));return new d(b)}}]).factory("mode",["eventForm","$mdSidenav",
"user","group",function(a,d,b,c){return{editsEventForm:!1,editsGroupForm:!1,showsEventList:!1,switchToEdit:function(){var e=Array.prototype.slice.call(arguments);if(1===e.length||2===e.length&&!0===e[1]){var f=e[0];a.mode=1===e.length?"edit":"add";f=f.split(":");_.extend(a,{type:f[2],id:1===e.length?f[0]:0});a.selectedGroup="private"!==f[1]?k(f[1]):f[1];"event"===f[2]?(_.map(["year","month","date","name"],function(d){a[d]="private"===f[1]?b["private"].event[f[0]][d]:c[f[1]].event[f[0]][d]}),a.month+=
1):"habit"===f[2]&&("private"===f[1]?(a.rule=b["private"].habit[f[0]].selector,a.name=b["private"].habit[f[0]].name):(a.rule=c[f[1]].habit[f[0]].selector,a.name=c[f[1]].habit[f[0]].name))}else 3===e.length&&_.extend(a,{mode:"add",type:"event",rule:"",id:0,name:"",year:e[0],month:e[1]+1,date:e[2]});this.editsEventForm=!0;d("left").close()}}}]).run(["calF","$timeout",function(a,d){function b(){var c=new Date;c.setDate(c.getDate()+1);c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);
var f=new Date;a.today.year=f.getFullYear();a.today.month=f.getMonth();a.today.date=f.getDate();d(b,c-new Date)}var c=new Date;c.setDate(c.getDate()+1);c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);d(b,c-new Date)}]).factory("db",["group","user","$http","$rootScope",function(a,d,b,c){return{post:function(a,d,h){a=_.clone(a);a.id=d;a.permission=a.permission||[];a.parents=a.parents||"";delete a.updated;for(var k in a)a[k]=angular.toJson(a[k]);a.type=h;c.$broadcast("updated");return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",
a).success(function(a){console.log("updated");console.log(a)}).error(function(a){console.log(a)})},list:function(){return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"list",groupID:d.following.join(",")}).success(function(a){return a}).error(function(a){console.log(a)})},getNameList:function(){return b.post("http://www40.atpages.jp/chatblanc/genderC/database.php",{type:"namelist"}).success(function(a){return a})}}}]);angular.module("rabbit").factory("eventCal",["group","user",
"calF","error","$log",function(a,d,b,c,e){function f(c,b,e){if("private"!==c&&!a[c])return[];var k=[],x=[];"private"===c?(_.each(d.following,function(a){x=x.concat(f(a,b,e))}),k=k.concat(h(d["private"].event,b,e,"private")),x=x.concat(k),k=k.concat(l(d["private"].habit,b,e,"private",x)),d.updated=!1):(a[c].parents&&_.each(a[c].parents,function(a){x=x.concat(f(a,b,e))}),k=k.concat(h(a[c].event,b,e,c)),x=x.concat(k),k=k.concat(l(a[c].habit,b,e,c,x)),a[c].updated=!1);return k}function h(a,c,b,d){var e=
[];if(!a)return e;for(var f=0,k=a.length;f<k;f++)if(a[f].year===c&&a[f].month===b){var h=_.clone(a[f]);h.group=d;h.type="event";h.id=f;e[e.length]=h}return e}function l(d,e,h,l,x){function I(d,e,r){function h(d,e,r){var q=function(){return _.clone(I)},t=b.calendar(e,r),B={sunday:0,sun:0,"\u65e5\u66dc\u65e5":0,monday:1,mon:1,"\u6708\u66dc\u65e5":1,tuesday:2,tue:2,"\u706b\u66dc\u65e5":2,wednesday:3,wed:3,"\u6c34\u66dc\u65e5":3,thursday:4,thu:4,"\u6728\u66dc\u65e5":4,friday:5,fri:5,"\u91d1\u66dc\u65e5":5,
saturday:6,sat:6,"\u571f\u66dc\u65e5":6},E={January:0,Jan:0,"\u7766\u6708":0,February:1,Feb:1,"\u5982\u6708":1,March:2,Mar:2,"\u5f25\u751f":2,April:3,Apr:3,"\u536f\u6708":3,May:4,"\u7690\u6708":4,June:5,Jun:5,"\u6c34\u7121\u6708":5,July:6,Jul:6,"\u6587\u6708":6,August:7,Aug:7,"\u8449\u6708":7,September:8,Sep:8,"\u9577\u6708":8,October:9,Oct:9,"\u795e\u7121\u6708":9,November:10,Nov:10,"\u971c\u6708":10,December:11,Dec:11,"\u5e2b\u8d70":11};if(n[e-1950])if(n[e-1950][r]){if(n[e-1950][r][d])return _.clone(n[e-
1950][r][d])}else n[e-1950][r]={};else n[e-1950]=[],n[e-1950][r]={};var m=d.split(":")[0],g=d.split(":").slice(1).join(":"),p=[],C=[],v=[],A=[],u,w,F,H,G=[];if("not"===m)if(p=q(),"public-holiday"===g||"\u795d\u65e5"===g){t=f(0,e,r);B=0;for(g=t.length;B<g;B++)t[B]=t[B].date;p=_.difference(p,t);n[e-1950][r][d]=_.clone(p)}else if(0===g.indexOf("year")||0===g.indexOf("month")||0===g.indexOf("date")||0===g.indexOf("day"))g=g.replace(/=/,":"),p=_.difference(q(),h(g,e,r));else{var D=g.split("=")[0],y=g.replace(/^.+?=/,
""),y=y.replace(/^"(.+)"$/,"$1");_.each(x,function(a){if(a[D]===y||0===a[D].indexOf("[mes]")&&a[D].slice(5)===y)p=_.without(p,a.date)})}else if("range"===m)if(".."===g.slice(0,2))g="..."===g.slice(0,3)?g.slice(3):g.slice(2),p=q(),g=g.split("/"),g=_.map(g,k),w=new Date(g[0],g[1]-1,g[2]),w.getFullYear()<e||w.getFullYear()==e&&w.getMonth()<r?p=[]:w.getFullYear()==e&&w.getMonth()==r?(p=q(),p=_.filter(p,function(a){return a<=w.getDate()})):p=q();else if(".."===g.slice(-2))g="..."===g.slice(-3)?g.slice(0,
-3):g.slice(0,-2),g=g.split("/"),g=_.map(g,k),u=new Date(g[0],g[1]-1,g[2]),u.getFullYear()>e||u.getFullYear()==e&&u.getMonth()>r?p=[]:u.getFullYear()==e&&u.getMonth()==r?(p=q(),p=_.filter(p,function(a){return a>=u.getDate()})):p=q();else if(-1!==g.indexOf(".."))p=[],g=g.split("..."),1===g.length&&(g=g[0].split("..")),C=[],v=[],A=[],u=g[0],w=g[1],F=w.substr(w.length-4,4),H=w.substr(w.length-5,5),G=[],u=u.split("/"),u=_.map(u,k),3===u.length?(t=new Date(u[0],u[1]-1,u[2]),G.push(t)):2===u.length&&(t=
new Date(e-1,u[0]-1,u[1]),G.push(t,new Date(e,u[0]-1,u[1]))),_.each(G,function(a){a.getFullYear()>e||a.getFullYear()==e&&a.getMonth()>r?C=[]:a.getFullYear()==e&&a.getMonth()==r?(C=q(),C=_.filter(C,function(c){return c>=a.getDate()})):C=q();A.push(C)}),G=_.zip(G,A),_.each(G,function(a){var c=a[0];a=a[1];var b;if("date"===F||"week"===F||"year"===F||"dates"===H||"weeks"===H||"years"===H){var d;d="date"===F||"week"===F||"year"===F?k(w.substring(0,w.length-4)):k(w.substring(0,w.length-5));b=new Date(c.getTime());
"date"===F||"dates"===H?b.setDate(b.getDate()+d):"week"===F||"weeks"===H?b.setDate(b.getDate()+7*d):"year"!==F&&"years"!==H||b.setFullYear(b.getFullYear()+d)}else b=w.split("/"),b=_.map(b,k),3===b.length?b=new Date(b[0],b[1]-1,b[2]):(b=new Date(c.getFullYear(),b[0]-1,b[1]),b.getTime()<c.getTime()&&b.setFullYear(b.getFullYear()+1));b.getFullYear()<e||b.getFullYear()==e&&b.getMonth()<r?v=[]:b.getFullYear()==e&&b.getMonth()==r?(v=q(),v=_.filter(v,function(a){return a<=b.getDate()})):v=q();_.isEmpty(_.intersection(a,
v))||(p=_.intersection(a,v))});else throw c('invalid selector "'+m+":"+g+'" in '+a[l].name+".");else if("date"===m)p[p.length]=k(g);else if("month"===m)if(!E[g]&&k(g)!=r+1||E[g]&&E[g]!=r)p=[];else{if(!E[g]&&k(g)==r+1||E[g]&&E[g]==r)p=q()}else if("day"===m)if(g.match(/^\d/)){for(var g=g.match(/^(\d+)(?:st|nd|rd|th)-?(.+)$/),G=k(g[1]),z=B[g[2]],B=0;""===t[B][z];)B++;p[p.length]=t[B-1+G][z]}else z=B[g],_.some(t,function(a){""!==a[z]&&(p[p.length]=a[z])});else if("year"===m)p="leap-year"===g||"leap_year"===
g||"\u3046\u308b\u3046\u5e74"===g||"\u958f\u5e74"===g?0===e%400||0===e%4&&0!==e%100?q():[]:k(g)!==e?[]:q();else throw c('undefined key "'+m+'".');"day"===m&&(n[e-1950][r][d]=_.clone(p));return p}var q=[],I=_.flatten(b.calendar(e,r));_.each(d,function(a){if(1===a[1])q[q.length]=h(a[0],e,r);else if(0===a[1])if("&&"===a[0])q.push(_.intersection(q.pop(),q.pop()));else if("||"===a[0])q.push(_.union(q.pop(),q.pop()));else throw c("undefined operator "+a[0]);});if(1!=q.length)throw c("unexpected error in execSelectors().");
return q.pop()}if(!d)return[];for(var E=[],t=0,m=d.length;t<m;t++){d[t].type="habit";d[t].group=l;var C=I(z(d[t].selector),e,h);_.each(C,function(a,b){C[b]={year:e,month:h,date:a,name:d[t].name,group:l,id:t,type:"habit"}});E=E.concat(C)}return E}function z(a){function b(a){""!==a[0]&&(c[c.length]=a)}if(A[a])return A[a];for(var c=[],d=!1,e=0,f=0,k=a.length;f<k;f++){var h=a.charAt(f);if(d)'"'===h?d=!1:"\\"===h&&(f+=1);else if('"'===h)d=!0;else if(" "===h){b([a.substring(e,f),1]);var h={" and ":"&&",
" \u304b\u3064 ":"&&"," && ":"&&"," or ":"||"," \u307e\u305f\u306f ":"||"," || ":"||"},l=!1,n;a:for(n in h)if(a.substr(f,n.length)===n){b([h[n],0]);e=f+n.length;f+=n.length;l=!0;break a}l||(b(["&&",0]),e=f+1,f+=1)}else if("("===h||")"===h)b([a.substring(e,f),1]),b([h,"("===h?2:3]),e=f+1}""!==a.substring(e)&&b([a.substring(e),1]);return A[a]=m(c)}function m(a){for(var b=[],d=[],e={"||":0,"&&":1},f=0,h=a.length;f<h;f++)if(1===a[f][1])d[d.length]=a[f].concat();else if(0===a[f][1]){var k=a[f][0];b[b.length-
1]&&e[k]<=e[b[b.length-1][0]]&&(d[d.length]=b.pop());b[b.length]=a[f]}else if(2===a[f][1])b[b.length]=a[f];else if(3===a[f][1]){for(;2!=b[b.length-1][1];)if(d[d.length]=b.pop(),0===b.length)throw c("found mismatched parentheses");b.pop()}for(;0<b.length;){if(2===b[b.length-1][1])throw c("found mismatched parentheses.");d[d.length]=b.pop()}return d}var n=[],A={},v=[],D=-1,y=-1;return{eventCalendar:function(a){var c=[],h=[],k=_.difference(d.following,d.hiddenGroup);if(b.year!==D||b.month!==y)D=b.year,
y=b.month,v=[];else if(k.join(",")!==v[v.length-1]||_.any(k,function(a){return!0===a.updated})||d.updated)e.debug("update caught.rebuild eventCalendar."),v=[];else return v[a]||[];for(var l=0,n=k.length;l<n;l++)c[c.length]=f(k[l],b.year,b.month);d.isHiddenGroup(-1)||(c[c.length]=f("private",b.year,b.month));l=0;for(n=c.length;l<n;l++)for(var m=0,t=c[l].length;m<t;m++)h[c[l][m].date]||(h[c[l][m].date]=[]),h[c[l][m].date][h[c[l][m].date].length]=c[l][m].id+":"+c[l][m].group+":"+c[l][m].type;v=_.clone(h);
v.push(k.join(","));return v[a]||[]},splitSelector:z}}])})(window);
