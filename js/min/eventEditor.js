angular.module(appName).controller("eventEditor",["$scope","group","user","eventForm","calF","db",function(b,l,h,a,m,n){function k(a){"private"===a?h.save():n.post(b.group[a],a,"update")}var g=[],f=[];b.group=l;b.user=h;b.eventForm=a;b.calF=m;b.ruleWriterFase="";b.ruleInput="";b.eventEditor={rules:"",selectedGroup:""};b.addEvent=function(){var c=b.eventForm.type;if(""!==a.name&&void 0!==a.selectedGroup&&null!==a.selectedGroup){var e=new Date(a.year,a.month-1,a.date);if(e.getFullYear()===parseInt(a.year,
10)&&e.getMonth()===parseInt(a.month,10)-1&&e.getDate()===parseInt(a.date,10)){if("event"==c)var d={year:a.year,month:a.month-1,date:a.date,name:a.name};else"habit"==c&&(d={selector:a.rule,name:a.name});"private"===a.selectedGroup?(b.user["private"][c][b.user["private"][c].length]=d,b.user.updated=!0):null!==a.selectedGroup&&(b.group[a.selectedGroup][c][b.group[a.selectedGroup][c].length]=d,b.group[a.selectedGroup].updated=!0);b.dialog("added an event");a.isEditMode=!1;k(a.selectedGroup)}}};b.saveEvent=
function(){var c=a.type;if(null!==a.year&&null!==a.month&&null!==a.date&&""!==a.name){var e=new Date(a.year,a.month-1,a.date);if(e.getFullYear()===parseInt(a.year,10)&&e.getMonth()===parseInt(a.month,10)-1&&e.getDate()===parseInt(a.date,10)){if("private"===a.selectedGroup)var d=b.user["private"][c][a.id];else null!==a.selectedGroup&&(d=b.group[a.selectedGroup][c][a.id],b.group[a.selectedGroup].updated=!0);"event"==c?(d.year=a.year,d.month=a.month-1,d.date=a.date,d.name=a.name):"habit"==c&&(d.selector=
a.rule,d.name=a.name);a.isEditMode=!1;k(a.selectedGroup)}}};b.cancel=function(){a.isEditMode=!1};b.goFase=function(c,e){g[g.length]=b.ruleWriterFase;f[f.length]=e||c;b.ruleWriterFase=c;a.rule=f.join("")};b.cancelFase=function(){b.ruleWriterFase=g.pop();f.pop();a.rule=f.join("")};b.finishWritingRule=function(){b.ruleWriterFase="";g=[];a.rule=f.join("");f=[]};b.startWritingRule=function(){b.ruleWriterFase="selector";g=[];f=[]}}]);
