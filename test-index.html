<!DOCTYPE html>
<html lang="ja" ng-app="rabbit">
  <head>
    <meta charset="UTF-8">
    <title>Rabbit Plot</title>
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1">
    <script src="js/angular.min.js"></script>
    <script src="js/angular-touch.min.js"></script>
    <script src="js/angular-animate.min.js"></script>
    <script src="js/underscore-min.js"></script>
    <script src="js/mainController.js"></script>
    <script src="js/calendar.js"></script>
    <script src="js/eventCal.js"></script>
    <script src="js/eventEditor.js"></script>
    <script src="js/groupEditor.js"></script>
    <script src="js/detail.js"></script>
    <script src="js/setting.js"></script>
    <script src="js/factory.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="main" ng-controller="mainController" ng-cloak>
      <a href="how-to-use.html">How to use</a>
      <div class="calendar" ng-controller="calendar"><!--{{{-->

        <div class="calendar-header cf">
          <button ng-click="lastYear()" class="left">&lt;&lt;</button>
          <button ng-click="lastMonth()" class="left">&lt;</button>
          {{calF.year}}/{{calF.month+1}}
          <button ng-click="nextYear()" class="right">&gt;&gt;</button>
          <button ng-click="nextMonth()" class="right">&gt;</button>
        </div>
        <div class="row"><span class="date">S</span><span class="date">M</span><span class="date">T</span><span class="date">W</span><span class="date">T</span><span class="date">F</span><span class="date">S</span></div>
        <div class="row" ng-repeat="row in calF.calendar(calF.year,calF.month)">
          <span class="date"
            ng-repeat="date in row track by $index"
            ng-class="date!==''&&dateClass(date)"
            ng-mouseenter="date!==''&&mouseenter(date)"
            ng-mouseleave="date!==''&&mouseleave(date)"
            ng-click="date!==''&&select(date)"
            >{{date}}</span>
        </div>

      </div><!--}}}-->
      <div id="detail" ng-controller="detail"><!--{{{-->
        <div ng-show="calF.selected!==null">{{calF.month+1}}/{{calF.selected}}<span ng-show="calF.selected===calF.today.date&&calF.month===calF.today.month&&calF.year===calF.today.year"> - today</span></div>
        <div ng-show="calF.selected===null"><br></div>
        <ul>
          <li ng-show="eventCalendar(calF.selected).length===0">予定なし</li>
          <li ng-repeat="event in eventCalendar(calF.selected) track by $index">
            <span ng-dblclick="switchToEdit(event)">{{event|format}}</span><button ng-click="switchToEdit(event)">Edit</button>
          </li>
        </ul>

        <button ng-show="calF.selected!==null" ng-click="switchToEdit(calF.year,calF.month,calF.selected)">+</button>
        <br ng-show="calF.selected===null">
        <form ng-controller="eventEditor" id="event-editor" ng-show="eventForm.isEditMode" name="eventEditor"><!--{{{-->
          {{eventForm.mode==='add'?'Add':'Edit'}} events:<br>

          <input type="radio" ng-model="eventForm.type" value="event">
          date:<input type="number" ng-model="eventForm.year" ng-disabled="eventForm.type!='event'"> /
          <input type="number" ng-model="eventForm.month" ng-disabled="eventForm.type!='event'"> /
          <input type="number" ng-model="eventForm.date" ng-disabled="eventForm.type!='event'"><br>

          <input type="radio" ng-model="eventForm.type" value="habit">
          rules:<input type="text" ng-model="eventForm.rule" ng-disabled="eventForm.type!='habit'" name="rules"><button ng-click="showHowToWrite()">書き方</button><br>

          <span ng-show="eventForm.mode==='add'">
            group:<select ng-model="eventForm.selectedGroup" ng-options="id as id!='private'?group[id].name:'private' for id in user.following.concat('private')" name="selectedGroup" required>
              <option value="">選択してください</option>
            </select>
            <span class="error-message" ng-show="eventEditor.selectedGroup.$error.required">必須</span><br>
          </span>

          Name:<input type="text" ng-model="eventForm.name" name="name" required>
          <span class="error-message" ng-show="eventEditor.name.$error.required">必須</span><br>
          <button ng-click="addEvent()" ng-show="eventForm.mode==='add'" ng-disabled="eventEditor.$error.required">add</button>
          <button ng-click="saveEvent()" ng-show="eventForm.mode==='edit'">save</button>
          <button ng-click="cancel()">cancel</button>
        </form><!--}}}-->
      </div><!--}}}-->
      <div id="setting" ng-controller="setting"><!--{{{-->

        <button ng-click="makeAGroup()">Make a group</button><br>
        Following:
        <ul ng-show="user.following.length>0" class="following-list">
          <li class="following cf" ng-class="user.isHiddenGroup(-1)?'hidden-group':'visible-group'">
            private
            <button ng-click="user.isHiddenGroup(-1)?show(-1):hide(-1)">{{user.isHiddenGroup(-1)?'show':'hide'}}</button>
          </li>
          <li ng-repeat="id in user.following" class="following cf" ng-if="group[id]" ng-class="user.isHiddenGroup(id)?'hidden-group':'visible-group'">
            {{group[id].name}}
            <button ng-click="user.isHiddenGroup(id)?show(id):hide(id)">{{user.isHiddenGroup(id)?'show':'hide'}}</button>
            <button ng-click="unfollow(id)">unfollow</button>
          </li>
        </ul>
        <div ng-show="user.following.length==0">No following</div>
        <button ng-click="hideAll()">hide all</button>
        <button ng-click="showAll()">show all</button><br>


        Search:<input type="text" ng-model="search_keyword">
        <button ng-click="search()">search</button>
        <button ng-click="random()">random</button>
        <ul class="search-list">
          <li ng-repeat="id in searchResult">
            {{group[id].name}}
            <button ng-disabled="user.following.indexOf(id)!==-1||followsParent(id)!==true" ng-click="follow(id)">follow</button>
            <span class="error-message" ng-show="followsParent(id)!==true">
              このグループはグループ"{{group[followsParent(id)].name}}"の子グループです。
              {{group[followsParent(id)].name}}をフォローしてください。
              <button ng-click="follow(followsParent(id))">{{group[followsParent(id)].name}}をフォロー</button>
            </span>
          </li>
        </ul>


        <div ng-controller="groupEditor" id="group-editor" ng-show="isGroupEditMode"><!--{{{-->
          Add group:<br>
          Name:<input type="text" ng-model="groupForm.name"><br>

          Parent group:
          <select ng-repeat-start="parentGroup in groupForm.parentGroup track by $index" ng-model="groupForm.parentGroup[$index]" ng-options="id as group[id].name for id in user.following">
            <option value="">選択してください</option>
          </select>
          <button ng-click="groupForm.parentGroup.splice($index,1)" ng-disabled="groupForm.parentGroup.length<=1">x</button>
          <br ng-repeat-end>

          <button ng-click="groupForm.parentGroup.push('')">add parent</button><br>
          <button ng-click="addGroup()" ng-show="groupForm.mode==='add'">add</button>
          <button ng-click="editGroup()" ng-show="groupForm.mode==='edit'">save</button>
        </div><!--}}}-->
      </div><!--}}}-->
      <div id="how-to-write" ng-show="showsHowToWrite===true"><!--{{{-->
        <button ng-click="showHowToWrite()">hide</button><br>
        <h2>例</h2>
        <ul>
          <li><span class="code">date:13 and day:friday</span>13日かつ金曜日の日を指定しています</li>
          <li><span class="code">date:1 and month:1</span>1月かつ1日の日を指定しています</li>
          <li><span class="code">day:monday or day:wednesday or day:friday</span>月曜日、もしくは水曜日、もしくは金曜日の日を指定しています</li>
        </ul>
        <h2>書き方</h2>
        <p>
          rulesには指定したい日にちを指定するルールを書きます。
        </p>
        <p>
          書き方は<span class="code">セレクタ:値</span>という基本形をいくつかつくり、それらを<span class="code">and</span> , <span class="code">or</span> , <span class="code">かつ</span> , <span class="code">または</span> , <span class="code">&amp;&amp;</span> , <span class="code">||</span> , <span class="code"> </span>(半角スペース) , <span class="code">,</span>(コンマ)でつなぐというものです。
        </p>
        <p>
          コンマと半角スペース以外は前後にスペースが必要です。プログラマには馴染み深い<span class="code">&amp;&amp;</span>と<span class="code">||</span>も前後にスペースが必要です。
        </p>
        <p>
          <span class="code">,</span>=<span class="code">and</span>=<span class="code">かつ</span>=<span class="code">&amp;&amp;</span>=論理積、<span class="code"> </span>は<span class="code">or</span>=<span class="code">または</span>=<span class="code">||</span>=論理和を表します。
          例えば13日の金曜日を表現する時は<span class="code">date:13,day:friday</span>となります(他にも<span class="code">day:fri,date:13</span>や<span class="code">day:fri and date:13</span>など様々に書き表せます)。
        </p>
        <h2>セレクタ一覧</h2>
        <p>
          セレクタは順序を問いません。セレクタ一覧は以下のとおりです
        </p>
        <dl>
          <dt>date</dt>
          <dd>
          例:<span class="code">date:13th</span><br>日付を指定します。序数詞はつけてもつけなくてもかまいません。
          </dd>
          <dt>month</dt>
          <dd>
          例:<span class="code">month:1,date:1</span><br>月を指定します。数値の他に、英語名での指定も可能です(例:April、Apr)。ただし、英語名では、頭は大文字で他は小文字でなくてはなりません。ちなみに睦月など和名も使えます。
          </dd>
          <dt>day</dt>
          <dd>
          例:<span class="code">day:2nd-wednesday</span><br>曜日の指定です。ただ単に曜日を指定した場合、毎週何曜日という指定になります。序数詞をつけた場合、第何何曜日というように指定されます。序数詞と曜日の間はハイフンで区切るか、区切らずに並べてください。曜日の指定は、英語名(全小文字)、英語名短縮バージョン(全小文字、3文字)、日本語(曜日までつける)のいずれかとなります。
          </dd>
          <dt>not</dt>
          <dd>
          例:<span class="code">not:public-holiday or not:name="元旦"</span><br>否定セレクタです。記法は次の2通りです(いまのところ)。not:public-holidayとすると祝日の日は除き、not:name="event"とすると"event"という名前のイベントがある日を除きます。
          </dd>
          <dt>from</dd>
          <dd>
          例:<span class="code">from:0/1/1</span><br>「ある日にちから」という指定ができます。例えば、2000年1月1日生まれの人の誕生日を登録する時、<span class="code">date:1 and month:1</span>とセレクタを書きます。しかし、これだと1999年1月1日もその人の誕生日として登録されてしまいます。そんなときsinceを使えば正しく登録できます。
          </dd>
          <dt>to</dd>
          <dd>
          例:<span class="code">from:2011/7/8 and to:2011/9/30</span><br>「ある日にちまで」という指定ができます。ちなみに例のセレクタで指しているのは近畿広域圏で輪るピングドラムが放送されていた時期です。
          </dd>
        </dl>
      </div><!--}}}-->
      <div id="dialog" class="animate-show-hide" ng-show="showsDialog">{{dialogMessage}}</div>
    </div>
  </body>
</html>
